// prototype.js
var Prototype={Version:'1.6.0_pre1',Browser:{IE: ! !(window.attachEvent&& !window.opera),Opera: ! !window.opera,WebKit:navigator.userAgent.indexOf('AppleWebKit/')> -1,Gecko:navigator.userAgent.indexOf('Gecko')> -1&&navigator.userAgent.indexOf('KHTML')== -1,MobileSafari: ! !navigator.userAgent.match(/iPhone.*Mobile.*Safari/)},BrowserFeatures:{XPath: ! !document.evaluate,ElementExtensions: ! !window.HTMLElement,SpecificElementExtensions:document.createElement('div').__proto__!==document.createElement('form').__proto__},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;var Class={create:function(parent,methods){if(arguments.length==1&& !Object.isFunction(parent))methods=parent,parent=null;var method=function(){if(!Class.extending)this.initialize.apply(this,arguments);};method.superclass=parent;method.subclasses=[];if(Object.isFunction(parent)){Class.extending=true;method.prototype=new parent();method.prototype.constructor=method;parent.subclasses.push(method);delete Class.extending;}if(methods)Class.extend(method,methods);return method;},extend:function(destination,source){for(var name in source)Class.inherit(destination,source,name);return destination;},inherit:function(destination,source,name){var prototype=destination.prototype,ancestor=prototype[name],descendant=source[name];if(ancestor&&Object.isFunction(descendant)&&descendant.argumentNames().first()=="$super"){var method=descendant,descendant=ancestor.wrap(method);Object.extend(descendant,{valueOf:function(){return method},toString:function(){return method.toString()}});}prototype[name]=descendant;if(destination.subclasses&&destination.subclasses.length>0){for(var i=0,subclass;subclass=destination.subclasses[i];i++){Class.extending=true;Object.extend(subclass.prototype,new destination());subclass.prototype.constructor=subclass;delete Class.extending;Class.inherit(subclass,destination.prototype,name);}}},mixin:function(destination,source){return Object.extend(destination,source);}};var Abstract={};Object.extend=function(destination,source){for(var property in source){destination[property]=source[property];}return destination;};Object.extend(Object,{inspect:function(object){try{if(object===undefined)return 'undefined';if(object===null)return 'null';return object.inspect?object.inspect():object.toString();}catch(e){if(e instanceof RangeError)return '...';throw e;}},toJSON:function(object){var type=typeof object;switch(type){case 'undefined':case 'function':case 'unknown':return;case 'boolean':return object.toString();}if(object===null)return 'null';if(object.toJSON)return object.toJSON();if(Object.isElement(object))return;var results=[];for(var property in object){var value=Object.toJSON(object[property]);if(value!==undefined)results.push(property.toJSON()+': '+value);}return '{'+results.join(', ')+'}';},toHTML:function(object){return object&&object.toHTML?object.toHTML():String.interpret(object);},keys:function(object){var keys=[];for(var property in object)keys.push(property);return keys;},values:function(object){var values=[];for(var property in object)values.push(object[property]);return values;},clone:function(object){return Object.extend({},object);},isElement:function(object){return object&&object.nodeType==1;},isArray:function(object){return object&&object.constructor===Array;},isFunction:function(object){return typeof object=="function";},isString:function(object){return typeof object=="string";},isNumber:function(object){return typeof object=="number";},isUndefined:function(object){return typeof object=="undefined";}});Object.extend(Function.prototype,{argumentNames:function(){var names=this.toString().match(/^[\s\(]*function\s*\((.*?)\)/)[1].split(",").invoke("strip");return names.length==1&& !names[0]?[]:names;},bind:function(){if(arguments.length<2&&arguments[0]===undefined)return this;var __method=this,args=$A(arguments),object=args.shift();return function(){return __method.apply(object,args.concat($A(arguments)));}},bindAsEventListener:function(){var __method=this,args=$A(arguments),object=args.shift();return function(event){return __method.apply(object,[event||window.event].concat(args));}},curry:function(){if(!arguments.length)return this;var __method=this,args=$A(arguments);return function(){return __method.apply(this,args.concat($A(arguments)));}},delay:function(){var __method=this,args=$A(arguments),timeout=args.shift()*1000;return window.setTimeout(function(){return __method.apply(__method,args);},timeout);},wrap:function(wrapper){var __method=this;return function(){return wrapper.apply(this,[__method.bind(this)].concat($A(arguments)));}},methodize:function(){if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){return __method.apply(null,[this].concat($A(arguments)));};}});Function.prototype.defer=Function.prototype.delay.curry(0.01);Date.prototype.toJSON=function(){return '"'+this.getFullYear()+'-'+(this.getMonth()+1).toPaddedString(2)+'-'+this.getDate().toPaddedString(2)+'T'+this.getHours().toPaddedString(2)+':'+this.getMinutes().toPaddedString(2)+':'+this.getSeconds().toPaddedString(2)+'"';};var Try={these:function(){var returnValue;for(var i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break;}catch(e){}}return returnValue;}};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback;this.frequency=frequency;this.currentlyExecuting=false;this.registerCallback();},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000);},stop:function(){if(!this.timer)return;clearInterval(this.timer);this.timer=null;},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.callback(this);}finally{this.currentlyExecuting=false;}}}});Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,{gsub:function(pattern,replacement){var result='',source=this,match;replacement=arguments.callee.prepareReplacement(replacement);while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}else{result+=source,source='';}}return result;},sub:function(pattern,replacement,count){replacement=this.gsub.prepareReplacement(replacement);count=count===undefined?1:count;return this.gsub(pattern,function(match){if(--count<0)return match[0];return replacement(match);});},scan:function(pattern,iterator){this.gsub(pattern,iterator);return String(this);},truncate:function(length,truncation){length=length||30;truncation=truncation===undefined?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);},strip:function(){return this.replace(/^\s+/,'').replace(/\s+$/,'');},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,'');},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');},extractScripts:function(){var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)});},escapeHTML:function(){var self=arguments.callee;self.text.data=this;return self.div.innerHTML;},unescapeHTML:function(){var div=new Element('div');div.innerHTML=this.stripTags();return div.childNodes[0]?(div.childNodes.length>1?$A(div.childNodes).inject('',function(memo,node){return memo+node.nodeValue}):div.childNodes[0].nodeValue):'';},toQueryParams:function(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}else hash[key]=value;}return hash;});},toArray:function(){return this.split('');},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1);},times:function(count){var result='';for(var i=0;i<count;i++)result+=this;return result;},camelize:function(){var parts=this.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=this.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++)camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);return camelized;},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();},underscore:function(){return this.gsub(/::/,'/').gsub(/([A-Z]+)([A-Z][a-z])/,'#{1}_#{2}').gsub(/([a-z\d])([A-Z])/,'#{1}_#{2}').gsub(/-/,'_').toLowerCase();},dasherize:function(){return this.gsub(/_/,'-');},inspect:function(useDoubleQuotes){var escapedString=this.gsub(/[\x00-\x1f\\]/,function(match){var character=String.specialChar[match[0]];return character?character:'\\u00'+match[0].charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return '"'+escapedString.replace(/"/g,'\\"')+'"';return "'"+escapedString.replace(/'/g,'\\\'')+"'";},toJSON:function(){return this.inspect(true);},unfilterJSON:function(filter){return this.sub(filter||Prototype.JSONFilter,'#{1}');},isJSON:function(){var str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}throw new SyntaxError('Badly formed JSON string: '+this.inspect());},include:function(pattern){return this.indexOf(pattern)> -1;},startsWith:function(pattern){return this.indexOf(pattern)===0;},endsWith:function(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;},empty:function(){return this=='';},blank:function(){return/ ^\s*$/.test(this);},interpolate:function(object,pattern){return new Template(this,pattern).evaluate(object);}});if(Prototype.Browser.WebKit||Prototype.Browser.IE)Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},unescapeHTML:function(){return this.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>');}});String.prototype.gsub.prepareReplacement=function(replacement){if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement('div'),text:document.createTextNode('')});with(String.prototype.escapeHTML)div.appendChild(text);var Template=Class.create();Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;Template.prototype={initialize:function(template,pattern){this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object){if(Object.isFunction(object.toTemplateReplacements))object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match){if(object==null)return '';var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3];var pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/,match=pattern.exec(expr);if(match==null)return '';while(match!=null){var comp=match[1].startsWith('[')?match[2].gsub('\\\\]',']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}return before+String.interpret(ctx);}.bind(this));}};var $break={};var Enumerable={each:function(iterator,context){var index=0;iterator=iterator.bind(context);try{this._each(function(value){iterator(value,index++);});}catch(e){if(e!=$break)throw e;}return this;},eachSlice:function(number,iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var index= -number,slices=[],array=this.toArray();while((index+=number)<array.length)slices.push(array.slice(index,index+number));return slices.collect(iterator,context);},all:function(iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var result=true;this.each(function(value,index){result=result&& ! !iterator(value,index);if(!result)throw $break;});return result;},any:function(iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var result=false;this.each(function(value,index){if(result= ! !iterator(value,index))throw $break;});return result;},collect:function(iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var results=[];this.each(function(value,index){results.push(iterator(value,index));});return results;},detect:function(iterator,context){iterator=iterator.bind(context);var result;this.each(function(value,index){if(iterator(value,index)){result=value;throw $break;}});return result;},findAll:function(iterator,context){iterator=iterator.bind(context);var results=[];this.each(function(value,index){if(iterator(value,index))results.push(value);});return results;},grep:function(filter,iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var results=[];if(Object.isString(filter))filter=new RegExp(filter);this.each(function(value,index){if(filter.match(value))results.push(iterator(value,index));});return results;},include:function(object){if(Object.isFunction(this.indexOf))return this.indexOf(object)!= -1;var found=false;this.each(function(value){if(value===object){found=true;throw $break;}});return found;},inGroupsOf:function(number,fillWith){fillWith=fillWith===undefined?null:fillWith;return this.eachSlice(number,function(slice){while(slice.length<number)slice.push(fillWith);return slice;});},inject:function(memo,iterator,context){iterator=iterator.bind(context);this.each(function(value,index){memo=iterator(memo,value,index);});return memo;},invoke:function(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});},max:function(iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var result;this.each(function(value,index){value=iterator(value,index);if(result==undefined||value>=result)result=value;});return result;},min:function(iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var result;this.each(function(value,index){value=iterator(value,index);if(result==undefined||value<result)result=value;});return result;},partition:function(iterator,context){iterator=iterator?iterator.bind(context):Prototype.K;var trues=[],falses=[];this.each(function(value,index){(iterator(value,index)?trues:falses).push(value);});return[trues,falses];},pluck:function(property){var results=[];this.each(function(value){results.push(value[property]);});return results;},reject:function(iterator,context){iterator=iterator.bind(context);var results=[];this.each(function(value,index){if(!iterator(value,index))results.push(value);});return results;},sortBy:function(iterator,context){iterator=iterator.bind(context);return this.map(function(value,index){return{value:value,criteria:iterator(value,index)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b? -1:a>b?1:0;}).pluck('value');},toArray:function(){return this.map();},zip:function(){var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});},size:function(){return this.toArray().length;},inspect:function(){return '#<Enumerable:'+this.toArray().inspect()+'>';}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(iterable){if(!iterable)return[];if(iterable.toArray)return iterable.toArray();else{var results=[];for(var i=0,length=iterable.length;i<length;i++)results.push(iterable[i]);return results;}}if(Prototype.Browser.WebKit){function $A(iterable){if(!iterable)return[];if(!(Object.isFunction(iterable)&&iterable=='[object NodeList]')&&iterable.toArray){return iterable.toArray();}else{var results=[];for(var i=0,length=iterable.length;i<length;i++)results.push(iterable[i]);return results;}}}Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse)Array.prototype._reverse=Array.prototype.reverse;Object.extend(Array.prototype,{_each:function(iterator){for(var i=0,length=this.length;i<length;i++)iterator(this[i]);},clear:function(){this.length=0;return this;},first:function(){return this[0];},last:function(){return this[this.length-1];},compact:function(){return this.select(function(value){return value!=null;});},flatten:function(){return this.inject([],function(array,value){return array.concat(Object.isArray(value)?value.flatten():[value]);});},without:function(){var values=$A(arguments);return this.select(function(value){return!values.include(value);});},reverse:function(inline){return(inline!==false?this:this.toArray())._reverse();},reduce:function(){return this.length>1?this:this[0];},uniq:function(sorted){return this.inject([],function(array,value,index){if(0==index||(sorted?array.last()!=value: !array.include(value)))array.push(value);return array;});},intersect:function(array){return this.uniq().findAll(function(item){return array.include(item);});},clone:function(){return[].concat(this);},size:function(){return this.length;},inspect:function(){return '['+this.map(Object.inspect).join(', ')+']';},toJSON:function(){var results=[];this.each(function(object){var value=Object.toJSON(object);if(value!==undefined)results.push(value);});return '['+results.join(', ')+']';}});if(Object.isFunction(Array.prototype.forEach))Array.prototype._each=Array.prototype.forEach;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(item,i){i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)if(this[i]===item)return i;return-1;};if(!Array.prototype.lastIndexOf)Array.prototype.lastIndexOf=function(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;};Array.prototype.toArray=Array.prototype.clone;function $w(string){string=string.strip();return string?string.split(/\s+/):[];}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var array=[];for(var i=0,length=this.length;i<length;i++)array.push(this[i]);for(var i=0,length=arguments.length;i<length;i++){if(Object.isArray(arguments[i])){for(var j=0,arrayLength=arguments[i].length;j<arrayLength;j++)array.push(arguments[i][j]);}else{array.push(arguments[i]);}}return array;};}Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16);},succ:function(){return this+1;},times:function(iterator){$R(0,this,true).each(iterator);return this;},toPaddedString:function(length,radix){var string=this.toString(radix||10);return '0'.times(length-string.length)+string;},toJSON:function(){return isFinite(this)?this.toString():'null';}});$w('abs round ceil floor').each(function(method){Number.prototype[method]=Math[method].methodize();});var Hash=function(object){if(object instanceof Hash)this.merge(object);else Object.extend(this,object||{});};Object.extend(Hash,{toQueryString:function(obj){var parts=[];parts.add=arguments.callee.addPair;this.prototype._each.call(obj,function(pair){if(!pair.key)return;var value=pair.value;if(value&&typeof value=='object'){if(Object.isArray(value))value.each(function(value){parts.add(pair.key,value);});return;}parts.add(pair.key,value);});return parts.join('&');},toJSON:function(object){var results=[];this.prototype._each.call(object,function(pair){var value=Object.toJSON(pair.value);if(value!==undefined)results.push(pair.key.toJSON()+': '+value);});return '{'+results.join(', ')+'}';}});Hash.toQueryString.addPair=function(key,value,prefix){key=encodeURIComponent(key);if(value===undefined)this.push(key);else this.push(key+'='+(value==null?'':encodeURIComponent(value)));};Object.extend(Hash.prototype,Enumerable);Object.extend(Hash.prototype,{_each:function(iterator){for(var key in this){var value=this[key];if(value&&value==Hash.prototype[key])continue;var pair=[key,value];pair.key=key;pair.value=value;iterator(pair);}},keys:function(){return this.pluck('key');},values:function(){return this.pluck('value');},index:function(value){var match=this.detect(function(pair){return pair.value===value;});return match&&match.key;},merge:function(hash){return $H(hash).inject(this,function(mergedHash,pair){mergedHash[pair.key]=pair.value;return mergedHash;});},remove:function(){var result;for(var i=0,length=arguments.length;i<length;i++){var value=this[arguments[i]];if(value!==undefined){if(result===undefined)result=value;else{if(!Object.isArray(result))result=[result];result.push(value);}}delete this[arguments[i]];}return result;},toQueryString:function(){return Hash.toQueryString(this);},inspect:function(){return '#<Hash:{'+this.map(function(pair){return pair.map(Object.inspect).join(': ');}).join(', ')+'}>';},toJSON:function(){return Hash.toJSON(this);}});function $H(object){if(object instanceof Hash)return object;return new Hash(object);};if(function(){var i=0,Test=function(value){this.key=value};Test.prototype.key='foo';for(var property in new Test('bar'))i++;return i>1;}())Hash.prototype._each=function(iterator){var cache=[];for(var key in this){var value=this[key];if((value&&value==Hash.prototype[key])||cache.include(key))continue;cache.push(key);var pair=[key,value];pair.key=key;pair.value=value;iterator(pair);}};ObjectRange=Class.create();Object.extend(ObjectRange.prototype,Enumerable);Object.extend(ObjectRange.prototype,{initialize:function(start,end,exclusive){this.start=start;this.end=end;this.exclusive=exclusive;},_each:function(iterator){var value=this.start;while(this.include(value)){iterator(value);value=value.succ();}},include:function(value){if(value<this.start)return false;if(this.exclusive)return value<this.end;return value<=this.end;}});var $R=function(start,end,exclusive){return new ObjectRange(start,end,exclusive);};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')})||false;},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator);},register:function(responder){if(!this.include(responder))this.responders.push(responder);},unregister:function(responder){this.responders=this.responders.without(responder);},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json]);}catch(e){}}});}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++;},onComplete:function(){Ajax.activeRequestCount--;}});Ajax.Base=function(){};Ajax.Base.prototype={setOptions:function(options){this.options={method:'post',asynchronous:true,contentType:'application/x-www-form-urlencoded',encoding:'UTF-8',parameters:'',evalJSON:true,evalJS:true};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();}};Ajax.Request=Class.create();Ajax.Request.Events=['Uninitialized','Loading','Loaded','Interactive','Complete'];Ajax.Request.prototype=Object.extend(new Ajax.Base(),{_complete:false,initialize:function(url,options){this.transport=Ajax.getTransport();this.setOptions(options);this.request(url);},request:function(url){this.url=url;this.method=this.options.method;var params=Object.clone(this.options.parameters);if(!['get','post'].include(this.method)){params['_method']=this.method;this.method='post';}this.parameters=params;if(params=Hash.toQueryString(params)){if(this.method=='get')this.url+=(this.url.include('?')?'&':'?')+params;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))params+='&_=';}try{var response=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(response);Ajax.Responders.dispatch('onCreate',this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous)this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=='post'?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)this.onStateChange();}catch(e){this.dispatchException(e);}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&& !((readyState==4)&&this._complete))this.respondToReadyState(this.transport.readyState);},setRequestHeaders:function(){var headers={'X-Requested-With':'XMLHttpRequest','X-Prototype-Version':Prototype.Version,'Accept':'text/javascript, text/html, application/xml, text/xml, */*'};if(this.method=='post'){headers['Content-type']=this.options.contentType+(this.options.encoding?'; charset='+this.options.encoding:'');if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)headers['Connection']='close';}if(typeof this.options.requestHeaders=='object'){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push))for(var i=0,length=extras.length;i<length;i+=2)headers[extras[i]]=extras[i+1];else $H(extras).each(function(pair){headers[pair.key]=pair.value});}for(var name in headers)this.transport.setRequestHeader(name,headers[name]);},success:function(){var status=this.getStatus();return!status||(status>=200&&status<300);},getStatus:function(){try{return this.transport.status||0;}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=='Complete'){try{this._complete=true;(this.options['on'+response.status]||this.options['on'+(this.success()?'Success':'Failure')]||Prototype.emptyFunction)(response,response.headerJSON);}catch(e){this.dispatchException(e);}var contentType=response.getHeader('Content-type');if(this.options.evalJS=='force'||(this.options.evalJS&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))this.evalResponse();}try{(this.options['on'+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch('on'+state,this,response,response.headerJSON);}catch(e){this.dispatchException(e);}if(state=='Complete'){this.transport.onreadystatechange=Prototype.emptyFunction;}},getHeader:function(name){try{return this.transport.getResponseHeader(name);}catch(e){return null}},evalResponse:function(){try{return eval((this.transport.responseText||'').unfilterJSON());}catch(e){this.dispatchException(e);}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch('onException',this,exception);}});Ajax.Response=Class.create();Ajax.Response.prototype={initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&& !Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this.getHeaderJSON();}if(readyState==4){var xml=transport.responseXML;this.responseXML=xml===undefined?null:xml;this.responseJSON=this.getResponseJSON();}},status:0,statusText:'',getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||'';}catch(e){return ''}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders();}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name);},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders();},getHeaderJSON:function(){var json=this.getHeader('X-JSON');try{return json?json.evalJSON(this.request.options.sanitizeJSON):null;}catch(e){this.request.dispatchException(e);}},getResponseJSON:function(){var options=this.request.options;try{if(options.evalJSON=='force'||(options.evalJSON&&(this.getHeader('Content-type')||'').include('application/json')))return this.transport.responseText.evalJSON(options.sanitizeJSON);return null;}catch(e){this.request.dispatchException(e);}}};Ajax.Updater=Class.create();Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{initialize:function(container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};this.transport=Ajax.getTransport();this.setOptions(options);var onComplete=this.options.onComplete||Prototype.emptyFunction;this.options.onComplete=(function(response,param){this.updateContent(response.responseText);onComplete(response,param);}).bind(this);this.request(url);},updateContent:function(responseText){var receiver=this.container[this.success()?'success':'failure'],options=this.options;if(!options.evalScripts)responseText=responseText.stripScripts();if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion);}else options.insertion(receiver,responseText);}else receiver.update(responseText);}if(this.success()){if(this.onComplete)this.onComplete.bind(this).defer();}}});Ajax.PeriodicalUpdater=Class.create();Ajax.PeriodicalUpdater.prototype=Object.extend(new Ajax.Base(),{initialize:function(container,url,options){this.setOptions(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start();},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent();},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments);},updateComplete:function(responseText){if(this.options.decay){this.decay=(responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=responseText;}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options);}});function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++)elements.push($(arguments[i]));return elements;}if(Object.isString(element))element=document.getElementById(element);return Element.extend(element);}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++)results.push(query.snapshotItem(i));return results;};}if(!window.Node)var Node={};Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});(function(){var element=this.Element;this.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(Prototype.Browser.IE&&attributes.name){tagName='<'+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes);}if(!cache[tagName])cache[tagName]=Element.extend(document.createElement(tagName));return Element.writeAttribute(cache[tagName].cloneNode(false),attributes);};Object.extend(this.Element,element||{});}).call(window);Element.cache={};Element.Methods={visible:function(element){return $(element).style.display!='none';},toggle:function(element){element=$(element);Element[Element.visible(element)?'hide':'show'](element);return element;},hide:function(element){$(element).style.display='none';return element;},show:function(element){$(element).style.display='';return element;},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element;},update:function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content))return element.update().insert(content);content=Object.toHTML(content);element.innerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;},replace:function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();else if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);content.evalScripts.bind(content).defer();content=range.createContextualFragment(content.stripScripts());}element.parentNode.replaceChild(content,element);return element;},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML)))insertions={bottom:insertions};var content,t,range;for(position in insertions){content=insertions[position];position=position.toLowerCase();t=Element._insertionTranslations[position];if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){t.insert(element,content);continue;}content=Object.toHTML(content);range=element.ownerDocument.createRange();t.initializeRange(element,range);t.insert(element,range.createContextualFragment(content.stripScripts()));content.evalScripts.bind(content).defer();}return element;},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper))$(wrapper).writeAttribute(attributes||{});else if(Object.isString(wrapper))wrapper=new Element(wrapper,attributes);else wrapper=new Element('div',wrapper);if(element.parentNode)element.parentNode.replaceChild(wrapper,element);wrapper.appendChild(element);return element;},inspect:function(element){element=$(element);var result='<'+element.tagName.toLowerCase();$H({'id':'id','className':'class'}).each(function(pair){var property=pair.first(),attribute=pair.last();var value=(element[property]||'').toString();if(value)result+=' '+attribute+'='+value.inspect(true);});return result+'>';},recursivelyCollect:function(element,property){element=$(element);var elements=[];while(element=element[property])if(element.nodeType==1)elements.push(Element.extend(element));return elements;},ancestors:function(element){return $(element).recursivelyCollect('parentNode');},descendants:function(element){return $A($(element).getElementsByTagName('*')).each(Element.extend);},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1)element=element.nextSibling;return $(element);},immediateDescendants:function(element){if(!(element=$(element).firstChild))return[];while(element&&element.nodeType!=1)element=element.nextSibling;if(element)return[element].concat($(element).nextSiblings());return[];},previousSiblings:function(element){return $(element).recursivelyCollect('previousSibling');},nextSiblings:function(element){return $(element).recursivelyCollect('nextSibling');},siblings:function(element){element=$(element);return element.previousSiblings().reverse().concat(element.nextSiblings());},match:function(element,selector){if(Object.isString(selector))selector=new Selector(selector);return selector.match($(element));},up:function(element,expression,index){element=$(element);if(arguments.length==1)return $(element.parentNode);var ancestors=element.ancestors();return expression?Selector.findElement(ancestors,expression,index):ancestors[index||0];},down:function(element,expression,index){element=$(element);if(arguments.length==1)return element.firstDescendant();var descendants=element.descendants();return expression?Selector.findElement(descendants,expression,index):descendants[index||0];},previous:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.previousElementSibling(element));var previousSiblings=element.previousSiblings();return expression?Selector.findElement(previousSiblings,expression,index):previousSiblings[index||0];},next:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.nextElementSibling(element));var nextSiblings=element.nextSiblings();return expression?Selector.findElement(nextSiblings,expression,index):nextSiblings[index||0];},select:function(){var args=$A(arguments),element=$(args.shift());return Selector.findChildElements(element,args);},adjacent:function(){var args=$A(arguments),element=$(args.shift());return Selector.findChildElements(element.parentNode,args).without(element);},identify:function(element){element=$(element);var id=element.readAttribute('id'),self=arguments.callee;if(id)return id;do{id='anonymous_element_'+self.counter++}while($(id));element.writeAttribute('id',id);return id;},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name])return t.values[name](element,name);if(t.names[name])name=t.names[name];}return element.getAttribute(name);},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=='object')attributes=name;else attributes[name]=value===undefined?true:value;for(var attr in attributes){var name=t.names[attr]||attr,value=attributes[attr];if(t.values[attr])name=t.values[attr](element,value);if(value===false||value===null)element.removeAttribute(name);else if(value===true)element.setAttribute(name,name);else element.setAttribute(name,value);}return element;},getHeight:function(element){return $(element).getDimensions().height;},getWidth:function(element){return $(element).getDimensions().width;},classNames:function(element){return new Element.ClassNames(element);},hasClassName:function(element,className){if(!(element=$(element)))return;var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||elementClassName.match(new RegExp("(^|\\s)"+className+"(\\s|$)"))));},addClassName:function(element,className){if(!(element=$(element)))return;if(!element.hasClassName(className))element.className+=(element.className?' ':'')+className;return element;},removeClassName:function(element,className){if(!(element=$(element)))return;element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)"),' ').strip();return element;},toggleClassName:function(element,className){if(!(element=$(element)))return;return element[element.hasClassName(className)?'removeClassName':'addClassName'](className);},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&& !/\S/.test(node.nodeValue))element.removeChild(node);node=nextNode;}return element;},empty:function(element){return $(element).innerHTML.blank();},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);while(element=element.parentNode)if(element==ancestor)return true;return false;},scrollTo:function(element){element=$(element);var pos=element.cumulativeOffset();window.scrollTo(pos[0],pos[1]);return element;},getStyle:function(element,style){element=$(element);style=style=='float'?'cssFloat':style.camelize();var value=element.style[style];if(!value){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null;}if(style=='opacity')return value?parseFloat(value):1.0;return value=='auto'?null:value;},getOpacity:function(element){return $(element).getStyle('opacity');},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=';'+styles;return styles.include('opacity')?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}for(var property in styles)if(property=='opacity')element.setOpacity(styles[property]);else elementStyle[(property=='float'||property=='cssFloat')?(elementStyle.styleFloat===undefined?'cssFloat':'styleFloat'):property]=styles[property];return element;},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;return element;},getDimensions:function(element){element=$(element);var display=$(element).getStyle('display');if(display!='none'&&display!=null)return{width:element.offsetWidth,height:element.offsetHeight};var els=element.style;var originalVisibility=els.visibility;var originalPosition=els.position;var originalDisplay=els.display;els.visibility='hidden';els.position='absolute';els.display='block';var originalWidth=element.clientWidth;var originalHeight=element.clientHeight;els.display=originalDisplay;els.position=originalPosition;els.visibility=originalVisibility;return{width:originalWidth,height:originalHeight};},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,'position');if(pos=='static'|| !pos){element._madePositioned=true;element.style.position='relative';if(window.opera){element.style.top=0;element.style.left=0;}}return element;},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right='';}return element;},makeClipping:function(element){element=$(element);if(element._overflow)return element;element._overflow=element.style.overflow||'auto';if((Element.getStyle(element,'overflow')||'visible')!='hidden')element.style.overflow='hidden';return element;},undoClipping:function(element){element=$(element);if(!element._overflow)return element;element.style.overflow=element._overflow=='auto'?'':element._overflow;element._overflow=null;return element;},cumulativeOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);},positionedOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(element.tagName=='BODY')break;var p=Element.getStyle(element,'position');if(p=='relative'||p=='absolute')break;}}while(element);return Element._returnOffset(valueL,valueT);},absolutize:function(element){element=$(element);if(element.getStyle('position')=='absolute')return;var offsets=element.positionedOffset();var top=offsets[1];var left=offsets[0];var width=element.clientWidth;var height=element.clientHeight;element._originalLeft=left-parseFloat(element.style.left||0);element._originalTop=top-parseFloat(element.style.top||0);element._originalWidth=element.style.width;element._originalHeight=element.style.height;element.style.position='absolute';element.style.top=top+'px';element.style.left=left+'px';element.style.width=width+'px';element.style.height=height+'px';return element;},relativize:function(element){element=$(element);if(element.getStyle('position')=='relative')return;element.style.position='relative';var top=parseFloat(element.style.top||0)-(element._originalTop||0);var left=parseFloat(element.style.left||0)-(element._originalLeft||0);element.style.top=top+'px';element.style.left=left+'px';element.style.height=element._originalHeight;element.style.width=element._originalWidth;return element;},cumulativeScrollOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode;}while(element);return Element._returnOffset(valueL,valueT);},getOffsetParent:function(element){if(element.offsetParent)return $(element.offsetParent);if(element==document.body)return $(element);while((element=element.parentNode)&&element!=document.body)if(Element.getStyle(element,'position')!='static')return $(element);return $(document.body);},viewportOffset:function(forElement){var valueT=0,valueL=0;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body&&Element.getStyle(element,'position')=='absolute')break;}while(element=element.offsetParent);element=forElement;do{if(!Prototype.Browser.Opera||element.tagName=='BODY'){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0;}}while(element=element.parentNode);return Element._returnOffset(valueL,valueT);},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=source.viewportOffset();element=$(element);var delta=[0,0];var parent=null;if(Element.getStyle(element,'position')=='absolute'){parent=element.getOffsetParent();delta=parent.viewportOffset();}if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop;}if(options.setLeft)element.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';if(options.setTop)element.style.top=(p[1]-delta[1]+options.offsetTop)+'px';if(options.setWidth)element.style.width=source.offsetWidth+'px';if(options.setHeight)element.style.height=source.offsetHeight+'px';return element;}};Element.Methods.identify.counter=1;if(!document.getElementsByClassName)document.getElementsByClassName=function(instanceMethods){function iter(name){return name.blank()?null:"[contains(concat(' ', @class, ' '), ' "+name+" ')]";};instanceMethods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(element,className){className=className.toString().strip();var cond=/\s/.test(className)?$w(className).map(iter).join(''):iter(className);return cond?document._getElementsByXPath('.//*'+cond,element):[];}:function(element,className){className=className.toString().strip();var elements=[],classNames=(/\s/.test(className)?$w(className):null);if(!classNames&& !className)return elements;var nodes=$(element).getElementsByTagName('*');className=' '+className+' ';for(var i=0,child,cn;child=nodes[i];i++){if(child.className&&(cn=' '+child.className+' ')&&(cn.include(className)||(classNames&&classNames.all(function(name){return!name.toString().blank()&&cn.include(' '+name+' ');}))))elements.push(Element.extend(child));}return elements;};return function(className,parentElement){return $(parentElement||document.body).getElementsByClassName(className);};}(Element.Methods);Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:'class',htmlFor:'for'},values:{}}};if(!document.createRange||Prototype.Browser.Opera){Element.Methods.insert=function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML)))insertions={bottom:insertions};var t=Element._insertionTranslations,content,position,pos,tagName;for(position in insertions){content=insertions[position];position=position.toLowerCase();pos=t[position];if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){pos.insert(element,content);continue;}content=Object.toHTML(content);tagName=((position=='before'||position=='after')?element.parentNode:element).tagName.toUpperCase();if(t.tags[tagName]){var fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=='top'||position=='after')fragments.reverse();fragments.each(pos.insert.curry(element));}else element.insertAdjacentHTML(pos.adjacency,content.stripScripts());content.evalScripts.bind(content).defer();}return element;};}if(Prototype.Browser.Opera){Element.Methods._getStyle=Element.Methods.getStyle;Element.Methods.getStyle=function(element,style){switch(style){case 'left':case 'top':case 'right':case 'bottom':if(Element._getStyle(element,'position')=='static')return null;default:return Element._getStyle(element,style);}};Element.Methods._readAttribute=Element.Methods.readAttribute;Element.Methods.readAttribute=function(element,attribute){if(attribute=='title')return element.title;return Element._readAttribute(element,attribute);};}else if(Prototype.Browser.IE){Element.Methods.getStyle=function(element,style){element=$(element);style=(style=='float'||style=='cssFloat')?'styleFloat':style.camelize();var value=element.style[style];if(!value&&element.currentStyle)value=element.currentStyle[style];if(style=='opacity'){if(value=(element.getStyle('filter')||'').match(/alpha\(opacity=(.*)\)/))if(value[1])return parseFloat(value[1])/100;return 1.0;}if(value=='auto'){if((style=='width'||style=='height')&&(element.getStyle('display')!='none'))return element['offset'+style.capitalize()]+'px';return null;}return value;};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,'');};element=$(element);var filter=element.getStyle('filter'),style=element.style;if(value==1||value===''){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute('filter');return element;}else if(value<0.00001)value=0;style.filter=stripAlpha(filter)+'alpha(opacity='+(value*100)+')';return element;};Element._attributeTranslations={read:{names:{'class':'className','for':'htmlFor'},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute,2);},_getEv:function(element,attribute){var attribute=element.getAttribute(attribute);return attribute?attribute.toString().slice(23,-2):null;},_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null;},style:function(element){return element.style.cssText.toLowerCase();},title:function(element){return element.title;}}}};Element._attributeTranslations.write={names:Object.extend({colspan:'colSpan',rowspan:'rowSpan',valign:'vAlign',datetime:'dateTime',accesskey:'accessKey',tabindex:'tabIndex',enctype:'encType',maxlength:'maxLength',readonly:'readOnly',longdesc:'longDesc'},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked= ! !value;},style:function(element,value){element.style.cssText=value?value:'';}}};(function(v){Object.extend(v,{href:v._getAttr,src:v._getAttr,type:v._getAttr,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv});})(Element._attributeTranslations.read.values);}else if(Prototype.Browser.Gecko){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==='')?'':(value<0.00001)?0:value;return element;};}else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;if(value==1)if(element.tagName=='IMG'&&element.width){element.width++;element.width--;}else try{var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}return element;};Element.Methods.cumulativeOffset=function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body)if(Element.getStyle(element,'position')=='absolute')break;element=element.offsetParent;}while(element);return[valueL,valueT];};}if(Prototype.Browser.IE||Prototype.Browser.Opera){Element.Methods.update=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content))return element.update().insert(content);content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName in Element._insertionTranslations.tags){$A(element.childNodes).each(function(node){element.removeChild(node)});Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)});}else element.innerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}if(document.createElement('div').outerHTML){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element;}content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next();var fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling)fragments.each(function(node){parent.insertBefore(node,nextSibling)});else fragments.each(function(node){parent.appendChild(node)});}else element.outerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result;};Element._getContentFromAnonymousElement=function(tagName,html){var div=new Element('div'),t=Element._insertionTranslations.tags[tagName];div.innerHTML=t[0]+html+t[1];t[2].times(function(){div=div.firstChild});return $A(div.childNodes);};Element._insertionTranslations={before:{adjacency:'beforeBegin',insert:function(element,node){element.parentNode.insertBefore(node,element);},initializeRange:function(element,range){range.setStartBefore(element);}},top:{adjacency:'afterBegin',insert:function(element,node){element.insertBefore(node,element.firstChild);},initializeRange:function(element,range){range.selectNodeContents(element);range.collapse(true);}},bottom:{adjacency:'beforeEnd',insert:function(element,node){element.appendChild(node);}},after:{adjacency:'afterEnd',insert:function(element,node){element.parentNode.insertBefore(node,element.nextSibling);},initializeRange:function(element,range){range.setStartAfter(element);}},tags:{TABLE:['<table>','</table>',1],TBODY:['<table><tbody>','</tbody></table>',2],TR:['<table><tbody><tr>','</tr></tbody></table>',3],TD:['<table><tbody><tr><td>','</td></tr></tbody></table>',4],SELECT:['<select>','</select>',1]}};(function(){this.bottom.initializeRange=this.top.initializeRange;Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD});}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(element,attribute){var t=Element._attributeTranslations.read,node;attribute=t.names[attribute]||attribute;node=$(element).getAttributeNode(attribute);return node&&node.specified;}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement('div').__proto__){window.HTMLElement={};window.HTMLElement.prototype=document.createElement('div').__proto__;Prototype.BrowserFeatures.ElementExtensions=true;}Element.extend=(function(){if(Prototype.BrowserFeatures.SpecificElementExtensions)return Prototype.K;var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||element._extendedByPrototype||element.nodeType!=1||element==window)return element;var methods=Object.clone(Methods),tagName=element.tagName,property,value;if(ByTag[tagName])Object.extend(methods,ByTag[tagName]);for(property in methods){value=methods[property];if(Object.isFunction(value)&& !(property in element))element[property]=value.methodize();}element._extendedByPrototype=Prototype.emptyFunction;return element;},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated);}}});extend.refresh();return extend;})();Element.hasAttribute=function(element,attribute){if(element.hasAttribute)return element.hasAttribute(attribute);return Element.Methods.Simulated.hasAttribute(element,attribute);};Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)});}if(arguments.length==2){var tagName=methods;methods=arguments[1];}if(!tagName)Object.extend(Element.Methods,methods||{});else{if(Object.isArray(tagName))tagName.each(extend);else extend(tagName);}function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName])Element.Methods.ByTag[tagName]={};Object.extend(Element.Methods.ByTag[tagName],methods);};function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value))continue;if(!onlyIfAbsent|| !(property in destination))destination[property]=value.methodize();}};function findDOMClass(tagName){var klass;var trans={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(trans[tagName])klass='HTML'+trans[tagName]+'Element';if(window[klass])return window[klass];klass='HTML'+tagName+'Element';if(window[klass])return window[klass];klass='HTML'+tagName.capitalize()+'Element';if(window[klass])return window[klass];window[klass]={};window[klass].prototype=document.createElement(tagName).__proto__;return window[klass];};if(F.ElementExtensions){copy(Element.Methods,HTMLElement.prototype);copy(Element.Methods.Simulated,HTMLElement.prototype,true);}if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass))continue;copy(T[tag],klass.prototype);}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh)Element.extend.refresh();Element.cache={};};document.viewport={getDimensions:function(){var dimensions={};$w('width height').each(function(d){var D=d.capitalize();dimensions[d]=self['inner'+D]||(document.documentElement['client'+D]||document.body['client'+D]);});return dimensions;},getWidth:function(){return this.getDimensions().width;},getHeight:function(){return this.getDimensions().height;},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop);}};var Selector=Class.create();Selector.prototype={initialize:function(expression){this.expression=expression.strip();this.compileMatcher();},compileMatcher:function(){if(Prototype.BrowserFeatures.XPath&& !(/\[[\w-]*?:/).test(this.expression))return this.compileXPathMatcher();var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return;}this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],'');break;}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join('\n'));Selector._cache[this.expression]=this.matcher;},compileXPathMatcher:function(){var e=this.expression,ps=Selector.patterns,x=Selector.xpath,le,m;if(Selector._cache[e]){this.xpath=Selector._cache[e];return;}this.matcher=['.//*'];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){if(m=e.match(ps[i])){this.matcher.push(Object.isFunction(x[i])?x[i](m):new Template(x[i]).evaluate(m));e=e.replace(m[0],'');break;}}}this.xpath=this.matcher.join('');Selector._cache[this.expression]=this.xpath;},findElements:function(root){root=root||document;if(this.xpath)return document._getElementsByXPath(this.xpath,root);return this.matcher(root);},match:function(element){this.tokens=[];var e=this.expression,ps=Selector.patterns,as=Selector.assertions;var le,p,m;while(e&&le!==e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){if(as[i]){this.tokens.push([i,Object.clone(m)]);e=e.replace(m[0],'');}else{return this.findElements(document).include(element);}}}}var match=true,name,matches;for(var i=0,token;token=this.tokens[i];i++){name=token[0],matches=token[1];if(!Selector.assertions[name](element,matches)){match=false;break;}}return match;},toString:function(){return this.expression;},inspect:function(){return "#<Selector:"+this.expression.inspect()+">";}};Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:'/following-sibling::*',tagName:function(m){if(m[1]=='*')return '';return "[local-name()='"+m[1].toLowerCase()+"' or local-name()='"+m[1].toUpperCase()+"']";},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:"[@#{1}]",attr:function(m){m[3]=m[5]||m[6];return new Template(Selector.xpath.operators[m[2]]).evaluate(m);},pseudo:function(m){var h=Selector.xpath.pseudos[m[1]];if(!h)return '';if(Object.isFunction(h))return h(m);return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);},operators:{'=':"[@#{1}='#{3}']",'!=':"[@#{1}!='#{3}']",'^=':"[starts-with(@#{1}, '#{3}')]",'$=':"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']",'*=':"[contains(@#{1}, '#{3}')]",'~=':"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]",'|=':"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{'first-child':'[not(preceding-sibling::*)]','last-child':'[not(following-sibling::*)]','only-child':'[not(preceding-sibling::* or following-sibling::*)]','empty':"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]",'checked':"[@checked]",'disabled':"[@disabled]",'enabled':"[not(@disabled)]",'not':function(m){var e=m[6],p=Selector.patterns,x=Selector.xpath,le,m,v;var exclusion=[];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in p){if(m=e.match(p[i])){v=Object.isFunction(x[i])?x[i](m):new Template(x[i]).evaluate(m);exclusion.push("("+v.substring(1,v.length-1)+")");e=e.replace(m[0],'');break;}}}return "[not("+exclusion.join(" and ")+")]";},'nth-child':function(m){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",m);},'nth-last-child':function(m){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",m);},'nth-of-type':function(m){return Selector.xpath.pseudos.nth("position() ",m);},'nth-last-of-type':function(m){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",m);},'first-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-of-type'](m);},'last-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-last-of-type'](m);},'only-of-type':function(m){var p=Selector.xpath.pseudos;return p['first-of-type'](m)+p['last-of-type'](m);},nth:function(fragment,m){var mm,formula=m[6],predicate;if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';if(mm=formula.match(/^(\d+)$/))return '['+fragment+"= "+mm[1]+']';if(mm=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(mm[1]=="-")mm[1]= -1;var a=mm[1]?Number(mm[1]):1;var b=mm[2]?Number(mm[2]):0;predicate="[((#{fragment} - #{b}) mod #{a} = 0) and "+"((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(predicate).evaluate({fragment:fragment,a:a,b:b});}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);   c = false;',className:'n = h.className(n, r, "#{1}", c); c = false;',id:'n = h.id(n, r, "#{1}", c);        c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}"); c = false;',attr:function(m){m[3]=(m[5]||m[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}"); c = false;').evaluate(m);},pseudo:function(m){if(m[6])m[6]=m[6].replace(/"/g,'\\"');return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(m);},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|\s|(?=:))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(element,matches){return matches[1].toUpperCase()==element.tagName.toUpperCase();},className:function(element,matches){return Element.hasClassName(element,matches[1]);},id:function(element,matches){return element.id===matches[1];},attrPresence:function(element,matches){return Element.hasAttribute(element,matches[1]);},attr:function(element,matches){var nodeValue=Element.readAttribute(element,matches[1]);return Selector.operators[matches[2]](nodeValue,matches[3]);}},handlers:{concat:function(a,b){for(var i=0,node;node=b[i];i++)a.push(node);return a;},mark:function(nodes){for(var i=0,node;node=nodes[i];i++)node._counted=true;return nodes;},unmark:function(nodes){for(var i=0,node;node=nodes[i];i++)node._counted=undefined;return nodes;},index:function(parentNode,reverse,ofType){parentNode._counted=true;if(reverse){for(var nodes=parentNode.childNodes,i=nodes.length-1,j=1;i>=0;i--){node=nodes[i];if(node.nodeType==1&&(!ofType||node._counted))node.nodeIndex=j++;}}else{for(var i=0,j=1,nodes=parentNode.childNodes;node=nodes[i];i++)if(node.nodeType==1&&(!ofType||node._counted))node.nodeIndex=j++;}},unique:function(nodes){if(nodes.length==0)return nodes;var results=[],n;for(var i=0,l=nodes.length;i<l;i++)if(!(n=nodes[i])._counted){n._counted=true;results.push(Element.extend(n));}return Selector.handlers.unmark(results);},descendant:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)h.concat(results,node.getElementsByTagName('*'));return results;},child:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++){for(var j=0,children=[],child;child=node.childNodes[j];j++)if(child.nodeType==1&&child.tagName!='!')results.push(child);}return results;},adjacent:function(nodes){for(var i=0,results=[],node;node=nodes[i];i++){var next=this.nextElementSibling(node);if(next)results.push(next);}return results;},laterSibling:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)h.concat(results,Element.nextSiblings(node));return results;},nextElementSibling:function(node){while(node=node.nextSibling)if(node.nodeType==1)return node;return null;},previousElementSibling:function(node){while(node=node.previousSibling)if(node.nodeType==1)return node;return null;},tagName:function(nodes,root,tagName,combinator){tagName=tagName.toUpperCase();var results=[],h=Selector.handlers;if(nodes){if(combinator){if(combinator=="descendant"){for(var i=0,node;node=nodes[i];i++)h.concat(results,node.getElementsByTagName(tagName));return results;}else nodes=this[combinator](nodes);if(tagName=="*")return nodes;}for(var i=0,node;node=nodes[i];i++)if(node.tagName.toUpperCase()==tagName)results.push(node);return results;}else return root.getElementsByTagName(tagName);},id:function(nodes,root,id,combinator){var targetNode=$(id),h=Selector.handlers;if(!targetNode)return[];if(!nodes&&root==document)return[targetNode];if(nodes){if(combinator){if(combinator=='child'){for(var i=0,node;node=nodes[i];i++)if(targetNode.parentNode==node)return[targetNode];}else if(combinator=='descendant'){for(var i=0,node;node=nodes[i];i++)if(Element.descendantOf(targetNode,node))return[targetNode];}else if(combinator=='adjacent'){for(var i=0,node;node=nodes[i];i++)if(Selector.handlers.previousElementSibling(targetNode)==node)return[targetNode];}else nodes=h[combinator](nodes);}for(var i=0,node;node=nodes[i];i++)if(node==targetNode)return[targetNode];return[];}return(targetNode&&Element.descendantOf(targetNode,root))?[targetNode]:[];},className:function(nodes,root,className,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);return Selector.handlers.byClassName(nodes,root,className);},byClassName:function(nodes,root,className){if(!nodes)nodes=Selector.handlers.descendant([root]);var needle=' '+className+' ';for(var i=0,results=[],node,nodeClassName;node=nodes[i];i++){nodeClassName=node.className;if(nodeClassName.length==0)continue;if(nodeClassName==className||(' '+nodeClassName+' ').include(needle))results.push(node);}return results;},attrPresence:function(nodes,root,attr){var results=[];for(var i=0,node;node=nodes[i];i++)if(Element.hasAttribute(node,attr))results.push(node);return results;},attr:function(nodes,root,attr,value,operator){if(!nodes)nodes=root.getElementsByTagName("*");var handler=Selector.operators[operator],results=[];for(var i=0,node;node=nodes[i];i++){var nodeValue=Element.readAttribute(node,attr);if(nodeValue===null)continue;if(handler(nodeValue,value))results.push(node);}return results;},pseudo:function(nodes,name,value,root,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);if(!nodes)nodes=root.getElementsByTagName("*");return Selector.pseudos[name](nodes,value,root);}},pseudos:{'first-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.previousElementSibling(node))continue;results.push(node);}return results;},'last-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.nextElementSibling(node))continue;results.push(node);}return results;},'only-child':function(nodes,value,root){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)if(!h.previousElementSibling(node)&& !h.nextElementSibling(node))results.push(node);return results;},'nth-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root);},'nth-last-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true);},'nth-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,false,true);},'nth-last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true,true);},'first-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,false,true);},'last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,true,true);},'only-of-type':function(nodes,formula,root){var p=Selector.pseudos;return p['last-of-type'](p['first-of-type'](nodes,formula,root),formula,root);},getIndices:function(a,b,total){if(a==0)return b>0?[b]:[];return $R(1,total).inject([],function(memo,i){if(0==(i-b)%a&&(i-b)/a>=0)memo.push(i);return memo;});},nth:function(nodes,formula,root,reverse,ofType){if(nodes.length==0)return[];if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';var h=Selector.handlers,results=[],indexed=[],m;h.mark(nodes);for(var i=0,node;node=nodes[i];i++){if(!node.parentNode._counted){h.index(node.parentNode,reverse,ofType);indexed.push(node.parentNode);}}if(formula.match(/^\d+$/)){formula=Number(formula);for(var i=0,node;node=nodes[i];i++)if(node.nodeIndex==formula)results.push(node);}else if(m=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(m[1]=="-")m[1]= -1;var a=m[1]?Number(m[1]):1;var b=m[2]?Number(m[2]):0;var indices=Selector.pseudos.getIndices(a,b,nodes.length);for(var i=0,node,l=indices.length;node=nodes[i];i++){for(var j=0;j<l;j++)if(node.nodeIndex==indices[j])results.push(node);}}h.unmark(nodes);h.unmark(indexed);return results;},'empty':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(node.tagName=='!'||(node.firstChild&& !node.innerHTML.match(/^\s*$/)))continue;results.push(node);}return results;},'not':function(nodes,selector,root){var h=Selector.handlers,selectorType,m;var exclusions=new Selector(selector).findElements(root);h.mark(exclusions);for(var i=0,results=[],node;node=nodes[i];i++)if(!node._counted)results.push(node);h.unmark(exclusions);return results;},'enabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)if(!node.disabled)results.push(node);return results;},'disabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)if(node.disabled)results.push(node);return results;},'checked':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)if(node.checked)results.push(node);return results;}},operators:{'=':function(nv,v){return nv==v;},'!=':function(nv,v){return nv!=v;},'^=':function(nv,v){return nv.startsWith(v);},'$=':function(nv,v){return nv.endsWith(v);},'*=':function(nv,v){return nv.include(v);},'~=':function(nv,v){return(' '+nv+' ').include(' '+v+' ');},'|=':function(nv,v){return('-'+nv.toUpperCase()+'-').include('-'+v.toUpperCase()+'-');}},matchElements:function(elements,expression){var matches=new Selector(expression).findElements(),h=Selector.handlers;h.mark(matches);for(var i=0,results=[],element;element=elements[i];i++)if(element._counted)results.push(element);h.unmark(matches);return results;},findElement:function(elements,expression,index){if(Object.isNumber(expression)){index=expression;expression=false;}return Selector.matchElements(elements,expression||'*')[index||0];},findChildElements:function(element,expressions){var exprs=expressions.join(','),expressions=[];exprs.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(m){expressions.push(m[1].strip());});var results=[],h=Selector.handlers;for(var i=0,l=expressions.length,selector;i<l;i++){selector=new Selector(expressions[i].strip());h.concat(results,selector.findElements(element));}return(l>1)?h.unique(results):results;}});function $$(){return Selector.findChildElements(document,$A(arguments));}var Form={reset:function(form){$(form).reset();return form;},serializeElements:function(elements,options){if(typeof options!='object')options={hash: ! !options};else if(options.hash===undefined)options.hash=true;var key,value,submitted=false,submit=options.submit;var data=elements.inject({},function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&(element.type!='submit'||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){if(key in result){if(!Object.isArray(result[key]))result[key]=[result[key]];result[key].push(value);}else result[key]=value;}}return result;});return options.hash?data:Hash.toQueryString(data);}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options);},getElements:function(form){return $A($(form).getElementsByTagName('*')).inject([],function(elements,child){if(Form.Element.Serializers[child.tagName.toLowerCase()])elements.push(Element.extend(child));return elements;});},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName('input');if(!typeName&& !name)return $A(inputs).map(Element.extend);for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name))continue;matchingInputs.push(Element.extend(input));}return matchingInputs;},disable:function(form){form=$(form);Form.getElements(form).invoke('disable');return form;},enable:function(form){form=$(form);Form.getElements(form).invoke('enable');return form;},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return 'hidden'!=element.type&& !element.disabled;});var firstByIndex=elements.findAll(function(element){return element.hasAttribute('tabIndex')&&element.tabIndex>=0;}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return['input','select','textarea'].include(element.tagName.toLowerCase());});},focusFirstElement:function(form){form=$(form);form.findFirstElement().activate();return form;},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute('action')||'';if(action.blank())action=window.location.href;options.parameters=form.serialize(true);if(params){if(Object.isString(params))params=params.toQueryParams();Object.extend(options.parameters,params);}if(form.hasAttribute('method')&& !options.method)options.method=form.method;return new Ajax.Request(action,options);}};Form.Element={focus:function(element){$(element).focus();return element;},select:function(element){$(element).select();return element;}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Hash.toQueryString(pair);}}return '';},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element);},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element;},clear:function(element){$(element).value='';return element;},present:function(element){return $(element).value!='';},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!='input'|| !['button','reset','submit'].include(element.type)))element.select();}catch(e){}return element;},disable:function(element){element=$(element);element.blur();element.disabled=true;return element;},enable:function(element){element=$(element);element.disabled=false;return element;}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(element,value){switch(element.type.toLowerCase()){case 'checkbox':case 'radio':return Form.Element.Serializers.inputSelector(element,value);default:return Form.Element.Serializers.textarea(element,value);}},inputSelector:function(element,value){if(value===undefined)return element.checked?element.value:null;else element.checked= ! !value;},textarea:function(element,value){if(value===undefined)return element.value;else element.value=value;},select:function(element,index){if(index===undefined)return this[element.type=='select-one'?'selectOne':'selectMany'](element);else{var opt,value,single= !Object.isArray(index);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];value=this.optionValue(opt);if(single){if(value==index){opt.selected=true;return;}}else opt.selected=index.include(value);}}},selectOne:function(element){var index=element.selectedIndex;return index>=0?this.optionValue(element.options[index]):null;},selectMany:function(element){var values,length=element.length;if(!length)return null;for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected)values.push(this.optionValue(opt));}return values;},optionValue:function(opt){return Element.extend(opt).hasAttribute('value')?opt.value:opt.text;}};Abstract.TimedObserver=function(){};Abstract.TimedObserver.prototype={initialize:function(element,frequency,callback){this.frequency=frequency;this.element=$(element);this.callback=callback;this.lastValue=this.getValue();this.registerCallback();},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),this.frequency*1000);},onTimerEvent:function(){var value=this.getValue();var changed=(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value));if(changed){this.callback(this.element,value);this.lastValue=value;}}};Form.Element.Observer=Class.create();Form.Element.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.Element.getValue(this.element);}});Form.Observer=Class.create();Form.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.serialize(this.element);}});Abstract.EventObserver=function(){};Abstract.EventObserver.prototype={initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=='form')this.registerFormCallbacks();else this.registerCallback(this.element);},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value;}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback.bind(this));},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case 'checkbox':case 'radio':Event.observe(element,'click',this.onElementEvent.bind(this));break;default:Event.observe(element,'change',this.onElementEvent.bind(this));break;}}}};Form.Element.EventObserver=Class.create();Form.Element.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.Element.getValue(this.element);}});Form.EventObserver=Class.create();Form.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.serialize(this.element);}});if(!window.Event)var Event={};Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,DOMEvents:['click','dblclick','mousedown','mouseup','mouseover','mousemove','mouseout','keypress','keydown','keyup','load','unload','abort','error','resize','scroll','select','change','submit','reset','focus','blur','DOMFocusIn','DOMFocusOut','DOMActivate','DOMSubtreeModified','DOMNodeInserted','NodeInsertedIntoDocument','DOMAttrModified','DOMCharacterDataModified'],cache:{},relatedTarget:function(event){var element;switch(event.type){case 'mouseover':element=event.fromElement;break;case 'mouseout':element=event.toElement;break;default:return null;}return Element.extend(element);}});Event.Methods={element:function(event){var node=event.target;if(!node)node=event.srcElement;return Element.extend(node.nodeType==Node.TEXT_NODE?node.parentNode:node);},findElement:function(event,expression){var element=Event.element(event);return element.match(expression)?element:element.up(expression);},isLeftClick:function(event){return(((event.which)&&(event.which==1))||((event.button)&&(event.button==1)));},pointer:function(event){return{x:event.pageX||(event.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)),y:event.pageY||(event.clientY+(document.documentElement.scrollTop||document.body.scrollTop))};},pointerX:function(event){return Event.pointer(event).x},pointerY:function(event){return Event.pointer(event).y},stop:function(event){if(event.preventDefault){event.preventDefault();event.stopPropagation();}else{event.returnValue=false;event.cancelBubble=true;}}};Event.extend=(function(){var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m;});if(Prototype.Browser.IE){Object.extend(methods,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return "[object Event]"}});return function(event){if(!event)return false;if(event._extendedByPrototype)return event;event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement,relatedTarget:Event.relatedTarget(event),pageX:pointer.x,pageY:pointer.y});return Object.extend(event,methods);};}else{Event.prototype=Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(Event.prototype,methods);return Prototype.K;}})();Object.extend(Event,(function(){var cache=Event.cache;function getEventID(element){if(element._eventID)return element._eventID;arguments.callee.id=arguments.callee.id||1;return element._eventID= ++arguments.callee.id;};function getDOMEventName(eventName){if(!Event.DOMEvents.include(eventName))return "dataavailable";return{keypress:"keydown"}[eventName]||eventName;};function getCacheForID(id){return cache[id]=cache[id]||{};};function getWrappersForEventName(id,eventName){var c=getCacheForID(id);return c[eventName]=c[eventName]||[];};function createWrapper(id,eventName,handler){var c=getWrappersForEventName(id,eventName);if(c.pluck("handler").include(handler))return false;var wrapper=function(event){if(event.eventName&&event.eventName!=eventName)return false;Event.extend(event);handler.call(event.target,event);};wrapper.handler=handler;c.push(wrapper);return wrapper;};function findWrapper(id,eventName,handler){var c=getWrappersForEventName(id,eventName);return c.find(function(wrapper){return wrapper.handler==handler});};function destroyWrapper(id,eventName,handler){var c=getCacheForID(id);if(!c[eventName])return false;c[eventName]=c[eventName].without(findWrapper(id,eventName,handler));};function destroyCache(){for(var id in cache)for(var eventName in cache[id])cache[id][eventName]=null;};if(window.attachEvent){window.attachEvent("onunload",destroyCache);}return{observe:function(element,eventName,handler){element=$(element);var id=getEventID(element),name=getDOMEventName(eventName);var wrapper=createWrapper(id,eventName,handler);if(!wrapper)return false;if(element.addEventListener){element.addEventListener(name,wrapper,false);}else{element.attachEvent("on"+name,wrapper);}},stopObserving:function(element,eventName,handler){element=$(element);var id=getEventID(element),name=getDOMEventName(eventName);if(!handler&&eventName){return getWrappersForEventName(id,eventName).each(function(wrapper){element.stopObserving(eventName,wrapper.handler);})&&false;}else if(!eventName){return Object.keys(getCacheForID(id)).each(function(eventName){element.stopObserving(eventName);})&&false;}var wrapper=findWrapper(id,eventName,handler);if(!wrapper)return false;if(element.removeEventListener){element.removeEventListener(name,wrapper,false);}else{element.detachEvent("on"+name,wrapper);}destroyWrapper(id,eventName,handler);},fire:function(element,eventName,memo){element=$(element);if(element==document&&document.createEvent&& !element.dispatchEvent)element=document.documentElement;if(document.createEvent){var event=document.createEvent("HTMLEvents");event.initEvent("dataavailable",true,true);}else{var event=document.createEventObject();event.eventType="ondataavailable";}event.eventName=eventName;event.memo=memo||{};if(document.createEvent){element.dispatchEvent(event);}else{element.fireEvent(event.eventType,event);}return element;}};})());Object.extend(Event,Event.Methods);Element.addMethods({fire:function(){Event.fire.apply(Event,arguments);return $A(arguments).first();},observe:function(){Event.observe.apply(Event,arguments);return $A(arguments).first();},stopObserving:function(){Event.stopObserving.apply(Event,arguments);return $A(arguments).first();}});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize()});(function(){var timer,fired=false;function fireContentLoadedEvent(){if(fired)return;if(timer)window.clearInterval(timer);document.fire("contentloaded");fired=true;};if(document.addEventListener){if(Prototype.Browser.WebKit){timer=window.setInterval(function(){if(/loaded|complete/.test(document.readyState))fireContentLoadedEvent();},0);Event.observe(window,"load",fireContentLoadedEvent);}else{document.addEventListener("DOMContentLoaded",fireContentLoadedEvent,false);}}else{var dummy=location.protocol=="https:"?"https://javascript:void(0)":"javascript:void(0)";document.write("<script id=__onDOMContentLoaded defer src='"+dummy+"'><\/script>");$("__onDOMContentLoaded").onreadystatechange=function(){if(this.readyState=="complete"){this.onreadystatechange=null;fireContentLoadedEvent();}};}})();var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content});},Top:function(element,content){return Element.insert(element,{top:content});},Bottom:function(element,content){return Element.insert(element,{bottom:content});},After:function(element,content){return Element.insert(element,{after:content});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(element,x,y){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(element,x,y);this.xcomp=x;this.ycomp=y;this.offset=Element.cumulativeOffset(element);return(y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth);},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);this.xcomp=x+offsetcache[0]-this.deltaX;this.ycomp=y+offsetcache[1]-this.deltaY;this.offset=Element.cumulativeOffset(element);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth);},overlap:function(mode,element){if(!mode)return 0;if(mode=='vertical')return((this.offset[1]+element.offsetHeight)-this.ycomp)/element.offsetHeight;if(mode=='horizontal')return((this.offset[0]+element.offsetWidth)-this.xcomp)/element.offsetWidth;},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){Position.prepare();return Element.absolutize(element);},relativize:function(element){Position.prepare();return Element.relativize(element);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){options=options||{};return Element.clonePosition(target,source,options);}};Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(element){this.element=$(element);},_each:function(iterator){this.element.className.split(/\s+/).select(function(name){return name.length>0;})._each(iterator);},set:function(className){this.element.className=className;},add:function(classNameToAdd){if(this.include(classNameToAdd))return;this.set($A(this).concat(classNameToAdd).join(' '));},remove:function(classNameToRemove){if(!this.include(classNameToRemove))return;this.set($A(this).without(classNameToRemove).join(' '));},toString:function(){return $A(this).join(' ');}};Object.extend(Element.ClassNames.prototype,Enumerable);Element.addMethods();

// smw_logger.js
var Logger=Class.create();Logger.prototype={initialize:function(){},log:function(logmsg,type,func){var logmsg=(logmsg==null)?"":logmsg;var type=(type==null)?"":type;var time=new Date();var timestamp=time.toGMTString();var userid=(wgUserName==null)?"":wgUserName;var location=(wgPageName==null)?"":wgPageName;var func=(func==null)?"":func;sajax_do_call('smwLog',[logmsg,type,timestamp,userid,location,func],this.logcallback.bind(this));},logcallback:function(param){if(param.status!=200){alert('logging failed: '+param.statusText);}}};var logger=new Logger();

// generalTools.js
function BrowserDetectLite(){var ua=navigator.userAgent.toLowerCase();this.isGecko=(ua.indexOf('gecko')!= -1);this.isMozilla=(this.isGecko&&ua.indexOf("gecko/")+14==ua.length);this.isNS=((this.isGecko)?(ua.indexOf('netscape')!= -1):((ua.indexOf('mozilla')!= -1)&&(ua.indexOf('spoofer')== -1)&&(ua.indexOf('compatible')== -1)&&(ua.indexOf('opera')== -1)&&(ua.indexOf('webtv')== -1)&&(ua.indexOf('hotjava')== -1)));this.isIE=((ua.indexOf("msie")!= -1)&&(ua.indexOf("opera")== -1)&&(ua.indexOf("webtv")== -1));this.isOpera=(ua.indexOf("opera")!= -1);this.isSafari=(ua.indexOf("safari")!= -1);this.isKonqueror=(ua.indexOf("konqueror")!= -1);this.isIcab=(ua.indexOf("icab")!= -1);this.isAol=(ua.indexOf("aol")!= -1);this.isWebtv=(ua.indexOf("webtv")!= -1);this.isGeckoOrOpera=this.isGecko||this.isOpera;};var OB_bd=new BrowserDetectLite();GeneralBrowserTools=new Object();GeneralBrowserTools.getCookie=function(name){var value=null;if(document.cookie!=""){var kk=document.cookie.indexOf(name+"=");if(kk>=0){kk=kk+name.length+1;var ll=document.cookie.indexOf(";",kk);if(ll<0)ll=document.cookie.length;value=document.cookie.substring(kk,ll);value=unescape(value);}}return value;};GeneralBrowserTools.setCookieObject=function(key,object){var json=Object.toJSON(object);document.cookie=key+"="+json;};GeneralBrowserTools.getCookieObject=function(key){var json=GeneralBrowserTools.getCookie(key);return json!=null?json.evalJSON(false):null;};GeneralBrowserTools.selectAllCheckBoxes=function(formid){var form=$(formid);var checkboxes=form.getInputs('checkbox');checkboxes.each(function(cb){cb.checked= !cb.checked});};GeneralBrowserTools.getSelectedText=function(textArea){if(OB_bd.isGecko){var selStart=textArea.selectionStart;var selEnd=textArea.selectionEnd;var text=textArea.value.substring(selStart,selEnd);}else if(OB_bd.isIE){var text=document.selection.createRange().text;}return text;};GeneralBrowserTools.isTextSelected=function(inputBox){if(OB_bd.isGecko){if(inputBox.selectionStart!=inputBox.selectionEnd){return true;}}else if(OB_bd.isIE){if(document.selection.createRange().text.length>0){return true;}}return false;};GeneralBrowserTools.purge=function(d){var a=d.attributes,i,l,n;if(a){l=a.length;for(i=0;i<l;i+=1){n=a[i].name;if(typeof d[n]==='function'){d[n]=null;}}}a=d.childNodes;if(a){l=a.length;for(i=0;i<l;i+=1){GeneralBrowserTools.purge(d.childNodes[i]);}}};GeneralBrowserTools.getURLParameter=function(paramName){var queryParams=location.href.toQueryParams();return queryParams[paramName];};GeneralBrowserTools.navigateToPage=function(ns,name){var articlePath=wgArticlePath.replace(/\$1/,ns!=null?ns+":"+name:name);window.open(wgServer+articlePath,"");};GeneralBrowserTools.toggleHighlighting=function(oldNode,newNode){if(oldNode){Element.removeClassName(oldNode,"selectedItem");}Element.addClassName(newNode,"selectedItem");return newNode;};GeneralBrowserTools.repasteMarkup=function(attribute){if(Prototype.BrowserFeatures.XPath){var nodesWithID=document.evaluate("//*[@"+attribute+"=\"true\"]",document,null,XPathResult.ANY_TYPE,null);var node=nodesWithID.iterateNext();var nodes=new Array();var i=0;while(node!=null){nodes[i]=node;node=nodesWithID.iterateNext();i++;}nodes.each(function(n){var textContent=n.textContent;n.innerHTML=textContent;});}};GeneralXMLTools=new Object();GeneralXMLTools.createTreeViewDocument=function(){if(OB_bd.isGeckoOrOpera){var parser=new DOMParser();var xmlDoc=parser.parseFromString("<result/>","text/xml");}else if(OB_bd.isIE){var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML("<result/>");}return xmlDoc;};GeneralXMLTools.createDocumentFromString=function(xmlText){if(OB_bd.isGeckoOrOpera){var parser=new DOMParser();var xmlDoc=parser.parseFromString(xmlText,"text/xml");}else if(OB_bd.isIE){var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xmlText);}return xmlDoc;};GeneralXMLTools.addBranch=function(xmlDoc,branch){var currentNode=xmlDoc;for(var i=branch.length-3;i>=0;i--){currentNode=GeneralXMLTools.addNodeIfNecessary(branch[i],currentNode);}if(!currentNode.hasChildNodes()){currentNode.removeAttribute("expanded");}};GeneralXMLTools.addNodeIfNecessary=function(nodeToAdd,parentNode){var a1=nodeToAdd.getAttribute("title");for(var i=0;i<parentNode.childNodes.length;i++){if(parentNode.childNodes[i].getAttribute("title")==a1){return parentNode.childNodes[i];}}var appendedChild=GeneralXMLTools.importNode(parentNode,nodeToAdd,false);return appendedChild;};GeneralXMLTools.importNode=function(parentNode,child,deep){var appendedChild;if(OB_bd.isGeckoOrOpera){appendedChild=parentNode.appendChild(document.importNode(child,deep));}else if(OB_bd.isIE){appendedChild=parentNode.appendChild(child.cloneNode(deep));}return appendedChild;};GeneralXMLTools.getNodeById=function(node,id){if(Prototype.BrowserFeatures.XPath){var nodeWithID=document.evaluate("//*[@id=\""+id+"\"]",node,null,XPathResult.ANY_TYPE,null);return nodeWithID.iterateNext();}else if(OB_bd.isIE){return node.selectSingleNode("//*[@id=\""+id+"\"]");}else{var children=node.childNodes;var result;if(children.length==0){return null;}for(var i=0,n=children.length;i<n;i++){if(children[i].getAttribute("id")){if(children[i].getAttribute("id")==id){return children[i];}}result=GeneralXMLTools.getNodeById(children[i],id);if(result!=null){return result;}}return result;}};GeneralXMLTools.importSubtree=function(nodeToImport,subTree){for(var i=0;i<subTree.childNodes.length;i++){GeneralXMLTools.importNode(nodeToImport,subTree.childNodes[i],true);}};GeneralXMLTools.removeAllChildNodes=function(node){if(node.firstChild){child=node.firstChild;do{nextSibling=child.nextSibling;GeneralBrowserTools.purge(child);node.removeChild(child);child=nextSibling;}while(child!=null);}};GeneralXMLTools.getAllParents=function(node){var parentNodes=new Array();var count=0;do{parentNodes[count]=node;node=node.parentNode;count++;}while(node!=null);return parentNodes;};GeneralTools=new Object();GeneralTools.getEvent=function(event){return event?event:window.event;};GeneralTools.getImgDirectory=function(source){return source.substring(0,source.lastIndexOf('/')+1);};GeneralTools.splitSearchTerm=function(searchTerm){var filterParts=searchTerm.split(" ");return filterParts.without('');};GeneralTools.matchArrayOfRegExp=function(term,regexArray){var doesMatch=true;for(var j=0,m=regexArray.length;j<m;j++){if(regexArray[j].exec(term)==null){doesMatch=false;break;}}return doesMatch;};var OBPendingIndicator=Class.create();OBPendingIndicator.prototype={initialize:function(container){this.container=container;this.pendingIndicator=document.createElement("img");Element.addClassName(this.pendingIndicator,"obpendingElement");this.pendingIndicator.setAttribute("src",wgServer+wgScriptPath+"/extensions/SMWHalo/skins/OntologyBrowser/images/ajax-loader.gif");this.contentElement=null;},show:function(container){if($("content")==null){return;}if(this.contentElement==null){this.contentElement=$("content");this.contentElement.appendChild(this.pendingIndicator);}if(!container){this.pendingIndicator.style.left=(Position.cumulativeOffset(this.container)[0]-Position.realOffset(this.container)[0])+"px";this.pendingIndicator.style.top=(Position.cumulativeOffset(this.container)[1]-Position.realOffset(this.container)[1]+this.container.scrollTop)+"px";}else{this.pendingIndicator.style.left=(Position.cumulativeOffset($(container))[0]-Position.realOffset($(container))[0])+"px";this.pendingIndicator.style.top=(Position.cumulativeOffset($(container))[1]-Position.realOffset($(container))[1]+$(container).scrollTop)+"px";}this.pendingIndicator.style.display="block";this.pendingIndicator.style.visibility="visible";},hide:function(){Element.hide(this.pendingIndicator);}}

// SMW_Language.js
var Language=Class.create();Language.prototype={initialize:function(){},getMessage:function(id){var msg=wgLanguageStrings[id];if(!msg){msg=id;}msg=msg.replace(/\$n/g,wgCanonicalNamespace);msg=msg.replace(/\$p/g,wgPageName);msg=msg.replace(/\$t/g,wgTitle);msg=msg.replace(/\$u/g,wgUserName);msg=msg.replace(/\$s/g,wgServer);return msg;}};var gLanguage=new Language();

// STB_Framework.js
var ToolbarFramework=Class.create();var HELPCONTAINER=9;var FACTCONTAINER=0;var EDITCONTAINER=1;var TYPECONTAINER=2;var CATEGORYCONTAINER=3;var ATTRIBUTECONTAINER=4;var RELATIONCONTAINER=5;var PROPERTIESCONTAINER=6;var CBSRCHCONTAINER=7;var COMBINEDSEARCHCONTAINER=8;var DBGCONTAINER=10;ToolbarFramework.prototype={stbconstructor:function(){if(this.isToolbarAvailable()){this.getCookieTab();if(this.cookiePrefTab!=null){for(var i=0;i<this.cookiePrefTab.length;i++){if(this.cookiePrefTab[i]==1){this.curtabShown=i;}}}else{this.curtabShown=0;}this.var_onto.innerHTML+="<div id=\"tabcontainer\"></div>";this.var_onto.innerHTML+="<div id=\"activetabcontainer\"></div>";this.var_onto.innerHTML+="<div id=\"semtoolbar\"></div>";this.var_stb=$("semtoolbar");if(this.var_stb){for(var i=0;i<=10;i++){this.var_stb.innerHTML+="<div id=\"stb_cont"+i+"-headline\"></div>";this.var_stb.innerHTML+="<div id=\"stb_cont"+i+"-content\"></div>";$("stb_cont"+i+"-headline").hide();$("stb_cont"+i+"-content").hide();}}}},isToolbarAvailable:function(){if($("ontomenuanchor")!=null){this.var_onto=$("ontomenuanchor");return true;}return false;},initialize:function(){this.contarray=new Array();this.tabarray=new Array();this.tabnames=new Array("Tools","Links to Other Pages","Facts about this Article");},createDivContainer:function(contnum,tabnr){if(this.tabarray[tabnr]==null){if(this.curtabShown==tabnr){this.tabarray[tabnr]=1;}else{this.tabarray[tabnr]=0;}if(this.tabarray.length>1){this.createTabHeader();}}this.contarray[contnum]=new DivContainer();this.contarray[contnum].createContainer(contnum,tabnr);if(contnum==HELPCONTAINER){if(this.cookieHelpTab!=null){this.contarray[contnum].setVisibility(this.cookieHelpTab);}else{this.contarray[contnum].setVisibility(0);}}else{this.contarray[contnum].setVisibility(1);}return this.contarray[contnum];},showSemanticToolbarContainer:function(container){if(container!=null){if(this.contarray[container].getTab()==this.curtabShown){if(this.contarray[container].headline!=null){$("stb_cont"+container+"-headline").show();document.getElementById("stb_cont"+container+"-link").className='minusplus';}if(this.contarray[container].isVisible()){$("stb_cont"+container+"-content").show();}else{$("stb_cont"+container+"-content").hide();document.getElementById("stb_cont"+container+"-link").className='plusminus';}}}else{for(var i=0;i<this.contarray.length;i++){if(this.contarray[i]&&this.contarray[i].getTab()==this.curtabShown){if(this.contarray[i].headline!=null){$("stb_cont"+i+"-headline").show();document.getElementById("stb_cont"+i+"-link").className='minusplus';}if(this.contarray[i].isVisible()){$("stb_cont"+i+"-content").show();}else{$("stb_cont"+i+"-content").hide();document.getElementById("stb_cont"+i+"-link").className='plusminus';}}}}},contentChanged:function(contnum){this.showSemanticToolbarContainer(contnum);this.resizeToolbar();},notify:function(container){},getDivContainer:function(){},createTabHeader:function(){var tabHeader="";if(this.tabarray.length>1){for(var i=0;i<(this.tabarray.length);i++){if(this.curtabShown!=i){tabHeader+="<div id=\"expandable\" style=\"cursor:pointer;cursor:hand;\" onclick=stb_control.switchTab("+i+")><img src=\""+wgScriptPath+"/skins/ontoskin/plus.gif\" onmouseover=\"(src='"+wgScriptPath+"/skins/ontoskin/plus-act.gif')\" onmouseout=\"(src='"+wgScriptPath+"/skins/ontoskin/plus.gif')\"></div><div id=\"tab_"+i+"\" style=\"cursor:pointer;cursor:hand;\" onclick=stb_control.switchTab("+i+")>"+this.tabnames[i]+"</div>";}else{$("activetabcontainer").update("<div id=\"expandable\"><img src=\""+wgScriptPath+"/skins/ontoskin/minus.gif\"></div><div id=\"tab_"+i+"\">"+this.tabnames[i]+"</div>");}}}$("tabcontainer").update(tabHeader);},switchTab:function(tabnr){this.hideSemanticToolbarContainerTab(tabnr);this.tabarray[this.curtabShown]=0;this.tabarray[tabnr]=1;this.curtabShown=tabnr;this.createTabHeader();this.showSemanticToolbarContainer();this.resizeToolbar();this.setCookie(this.tabarray);},hideSemanticToolbarContainerTab:function(tabnr){if(tabnr!=null){for(var i=0;i<this.contarray.length;i++){if(this.contarray[i]&&this.contarray[i].getTab()==this.curtabShown){$("stb_cont"+i+"-headline").hide();$("stb_cont"+i+"-content").hide();}}}},resizeToolbar:function(){var maxUsableHeight=this.getWindowHeight()-150;if($('activetabcontainer')){maxUsableHeight-=($('tabcontainer').scrollHeight+10+$('activetabcontainer').scrollHeight);}this.countNumOfDisplayedContainers();var neededHeight=this.calculateNeededHeightOfContainers();if(this.contarray[HELPCONTAINER]!=null&&this.contarray[HELPCONTAINER].isVisible()){maxUsableHeight-=this.contarray[HELPCONTAINER].getNeededHeight();}if(neededHeight>=maxUsableHeight){var j=this.numOfVisibleContainers;maxUsableHeight-=j*22;if((this.numOfContainers-1)==0){if(neededHeight>maxUsableHeight){for(var i=0;i<this.contarray.length;i++){if(this.contarray[i]&&this.contarray[i].getTab()==this.curtabShown&&this.contarray[i].getContainerNr()!=HELPCONTAINER){this.contarray[i].setContentStyle({maxHeight:maxUsableHeight+'px'});}}}}else{for(var i=0;i<this.contarray.length;i++){if(this.contarray[i]&&this.contarray[i].getTab()==this.curtabShown&&this.contarray[i].getContainerNr()!=HELPCONTAINER&&this.contarray[i].isVisible()){if(this.contarray[i].getNeededHeight()<maxUsableHeight/this.numOfVisibleContainers){this.contarray[i].setContentStyle({maxHeight:this.contarray[i].getNeededHeight()+'px'});maxUsableHeight-=this.contarray[i].getNeededHeight();}else{this.contarray[i].setContentStyle({maxHeight:maxUsableHeight/(this.numOfVisibleContainers)+'px'});}}}}}else{for(var i=0;i<this.contarray.length;i++){if(this.contarray[i]&&this.contarray[i].getTab()==this.curtabShown&&this.contarray[i].getContainerNr()!=HELPCONTAINER){this.contarray[i].setContentStyle({maxHeight:''});}}}},calculateNeededHeightOfContainers:function(){var j=0;for(var i=0;i<this.contarray.length;i++){if(this.contarray[i]&&this.contarray[i].getTab()==this.curtabShown&&this.contarray[i].isVisible()){j+=this.contarray[i].getNeededHeight();}}return j;},countNumOfDisplayedContainers:function(){var j=0;var d=0;if(this.contarray){for(var i=0;i<this.contarray.length;i++){if(this.contarray[i]&&this.contarray[i].getTab()==this.curtabShown){j++;if(this.contarray[i].isVisible()){d++;}}}}this.numOfContainers=j;this.numOfVisibleContainers=d;},getWindowHeight:function(){if(window.innerHeight){return window.innerHeight;}else{if(window.document.documentElement&&window.document.documentElement.clientHeight){return window.document.documentElement.clientHeight;}else{if(document.body&&document.body.offsetHeight){return win.document.body.offsetHeight;}return 0;}}},getCookieTab:function(){var cookie=document.cookie;var length=cookie.length-1;if(cookie.charAt(length)!=";")cookie+=";";var a=cookie.split(";");for(var i=0;i<a.length;i++){var cookiename=this.trim(a[i].substring(0,a[i].search('=')));var cookievalue=a[i].substring(a[i].search('=')+1,a[i].length);if(cookiename=="stbpreftab"){var cookievalue=cookievalue.split(",");var retval=new Array();for(var j=0;j<cookievalue.length;j++){retval[j]=parseInt(cookievalue[j]);}this.cookiePrefTab=retval;}else if(cookiename=="stbprefhelp"){this.cookieHelpTab=parseInt(cookievalue);}}},trim:function(string){return string.replace(/(^\s+|\s+$)/g,"");},setCookie:function(curtabpos){var a=new Date();a=new Date(a.getTime()+1000*60*60*24*365);var implode='';var first=true;for(var i=0;i<curtabpos.length;i++){if(first==true)first=false;else implode+=",";implode+=curtabpos[i];}document.cookie='stbpreftab='+implode+'; expires='+a.toGMTString()+';';},setHelpCookie:function(helpshown){var a=new Date();a=new Date(a.getTime()+1000*60*60*24*365);document.cookie='stbprefhelp='+helpshown+'; expires='+a.toGMTString()+';';}};var stb_control=new ToolbarFramework();Event.observe(window,'load',stb_control.stbconstructor.bindAsEventListener(stb_control));Event.observe(window,'resize',stb_control.resizeToolbar.bindAsEventListener(stb_control));

// STB_Divcontainer.js
var DivContainer=Class.create();DivContainer.prototype={initialize:function(){this.visibility=true;},createContainer:function(contnum,tabnr){this.contnum=contnum;this.tabnr=tabnr;},contentChanged:function(){stb_control.contentChanged(this.getContainerNr());},setTab:function(tabnr){this.tabnr=tabnr;},getTab:function(){return this.tabnr;},setContainerNr:function(contnum){this.contnum=contnum;},getContainerNr:function(){return this.contnum;},setVisibility:function(visibility){this.visibility=visibility;},isVisible:function(){return this.visibility;},setHeadline:function(headline){this.headline=headline;$("stb_cont"+this.getContainerNr()+"-headline").update("<div style=\"cursor:pointer;cursor:hand;\" onclick=\"stb_control.contarray["+this.getContainerNr()+"].switchVisibility()\"><a id=\"stb_cont"+this.getContainerNr()+"-link\" class=\"minusplus\" href=\"javascript:void(0)\">&nbsp;</a>"+headline);},setContent:function(content){this.content=content;$("stb_cont"+this.getContainerNr()+"-content").update(content);},setContentStyle:function(style){$("stb_cont"+this.getContainerNr()+"-content").setStyle(style);},switchVisibility:function(container){if(this.isVisible()){if(this.getContainerNr()==HELPCONTAINER){stb_control.setHelpCookie(0);}this.setVisibility(0);}else{if(this.getContainerNr()==HELPCONTAINER){stb_control.setHelpCookie(1);}this.setVisibility(1);}stb_control.contentChanged(this.getContainerNr());},getVisibleHeight:function(){return $('stb_cont'+this.getContainerNr()+"-content").offsetHeight;},getNeededHeight:function(){return $('stb_cont'+this.getContainerNr()+"-content").scrollHeight;}} 

// wick.js
 var SMW_CATEGORY_NS=14;var SMW_PROPERTY_NS=102;var SMW_INSTANCE_NS=0;var SMW_TEMPLATE_NS=10;var SMW_TYPE_NS=104;var SMW_AC_MANUAL_TRIGGERING_TIME=500;var SMW_AC_AUTO_TRIGGERING_TIME=800;var SMW_AJAX_AC=1;function autoCompletionsOptions(request){autoCompleter.autoTriggering=request.responseText.indexOf('auto')!= -1;document.cookie="AC_mode="+request.responseText;};var AutoCompleter=Class.create();AutoCompleter.prototype={initialize:function(){this.currentInputBox;this.typeHint;this.userInputToMatch=null;this.userContext=null;this.collection=[];this.ignorePending=false;this.articleRegEx=/((([\w\d])+\:)?([\w\d][\w\d\.\(\)\-\s]*)|(([\w\d])+\:))$/;this.timer=null;this.autoTriggering=false;this.allInputs=null;this.textAreas=null;this.siw=null;this.mousePressed=false;this.AC_idCounter=0;this.AC_yDiff=0;this.AC_xDiff=0;this.AC_userDefinedY=0;this.AC_userDefinedX=0;this.notMoved=false;},freezeEvent:function(e){if(e.preventDefault)e.preventDefault();e.returnValue=false;e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();return false;},isWithinNode:function(e,i,c,t,obj){var answer=false;var te=e;while(te&& !answer){if((te.id&&(te.id==i))||(te.className&&(te.className==i+"Class"))||(!t&&c&&te.className&&(te.className==c))||(!t&&c&&te.className&&(te.className.indexOf(c)!= -1))||(t&&te.tagName&&(te.tagName.toLowerCase()==t))||(obj&&(te==obj))){answer=te;}else{te=te.parentNode;}}return te;},getEventElement:function(e){return(e.srcElement?e.srcElement:(e.target?e.target:e.currentTarget));},findElementPosX:function(obj){var curleft=0;if(obj.offsetParent){while(obj.offsetParent){curleft+=obj.offsetLeft;obj=obj.offsetParent;}}else if(obj.x)curleft+=obj.x;return curleft;},findElementPosY:function(obj){var curtop=0;if(obj.offsetParent){while(obj.offsetParent){curtop+=obj.offsetTop;obj=obj.offsetParent;}}else if(obj.y)curtop+=obj.y;return curtop;},handleKeyPress:function(event){var e=GeneralTools.getEvent(event);var eL=this.getEventElement(e);var upEl=eL.className.indexOf("wickEnabled")>=0?eL:undefined;var kc=e["keyCode"];var isFloaterVisible=(this.siw&&this.siw.floater.style.visibility=='visible');if(isFloaterVisible&&this.siw&&((kc==13)||(kc==9))){this.siw.selectingSomething=true;if(OB_bd.isSafari)this.siw.inputBox.blur();this.siw.inputBox.focus();this.hideSmartInputFloater();}else if(upEl&&(kc!=38)&&(kc!=40)&&(kc!=37)&&(kc!=39)&&(kc!=13)&&(kc!=27)){if(!this.siw||(this.siw&& !this.siw.selectingSomething)){if((e["ctrlKey"]&&(kc==32))||isFloaterVisible){if(OB_bd.isIE&& !isFloaterVisible&& !e["altKey"]){var userInput=this.getUserInputToMatch();var selection_range=document.selection.createRange();selection_range.moveStart("character",-userInput.length-1);selection_range.text=userInput.substr(0,userInput.length-1);selection_range.collapse(false);}if(!this.siw)this.siw=new SmartInputWindow();this.siw.inputBox=upEl;this.currentInputBox=upEl;this.typeHint=this.siw.inputBox.getAttribute("typeHint");this.userInputToMatch=this.getUserInputToMatch();if(this.userInputToMatch.length>=0){this.userContext=this.getUserContext();if(this.timer){window.clearTimeout(this.timer);}this.timer=window.setTimeout("autoCompleter.timedAC(autoCompleter.userInputToMatch, autoCompleter.userContext, autoCompleter.currentInputBox, autoCompleter.typeHint)",SMW_AC_MANUAL_TRIGGERING_TIME);}else{//-->
this.hideSmartInputFloater();return;}}else if(this.autoTriggering){if(kc==17||kc==18)return;if(!this.siw)this.siw=new SmartInputWindow();this.siw.inputBox=upEl;this.currentInputBox=upEl;this.typeHint=this.siw.inputBox.getAttribute("typeHint");if(GeneralBrowserTools.isTextSelected(this.siw.inputBox)){this.hideSmartInputFloater();return;}this.userContext=this.getUserContext();if((this.userContext.match(/^\[\[/)||this.userContext.match(/^\{\{/)||this.siw.inputBox.tagName!='TEXTAREA')){this.userInputToMatch=this.getUserInputToMatch();if(this.userInputToMatch.length>=1){if(this.timer){window.clearTimeout(this.timer);}this.timer=window.setTimeout("autoCompleter.timedAC(autoCompleter.userInputToMatch, autoCompleter.userContext, autoCompleter.currentInputBox, autoCompleter.typeHint)",SMW_AC_AUTO_TRIGGERING_TIME);}else{//-->
this.hideSmartInputFloater();return;}}else{//-->
this.siw.inputBox.focus();this.hideSmartInputFloater();return;}}}}else if(kc==27){this.hideSmartInputFloater();this.freezeEvent(e);}else if(this.siw&&this.siw.inputBox){if(eL!=null&&eL.tagName=='HTML'&&isFloaterVisible){this.siw.inputBox.focus();}}},timedAC:function(userInputToMatch,userContext,inputBox,typeHint){function userInputToMatchResult(request){this.hidePendingAJAXIndicator();if(this.ignorePending){return;}if(request.status!=200){this.hideSmartInputFloater();return;}if(request.responseText.indexOf('noResult')!= -1){this.hideSmartInputFloater();return;}var result=request.responseText;this.collection=this.getMatchItems(request.responseText);if(this.collection.length>0){AC_matchCache.addLookup(userContext+userInputToMatch,this.collection,typeHint);}this.processSmartInput(inputBox,userInputToMatch);};this.notMoved=true;this.ignorePending=false;var cacheResult=AC_matchCache.getLookup(userContext+userInputToMatch,typeHint);if(cacheResult==null){if(userInputToMatch==null)return;this.showPendingAJAXIndicator(inputBox);sajax_do_call('smwfAutoCompletionDispatcher',[wgTitle,userInputToMatch,userContext,typeHint],userInputToMatchResult.bind(this),SMW_AJAX_AC);}else{this.collection=cacheResult;this.processSmartInput(inputBox,userInputToMatch);}},handleKeyDown:function(event){var e=GeneralTools.getEvent(event);var eL=this.getEventElement(e);if(this.siw&&(kc=e["keyCode"])){if(kc==40&&this.siw.floater.style.visibility=='visible'){this.siw.selectingSomething=true;this.freezeEvent(e);this.selectNextSmartInputMatchItem();}else if(kc==38&&this.siw.floater.style.visibility=='visible'){this.siw.selectingSomething=true;this.freezeEvent(e);this.selectPreviousSmartInputMatchItem();}else if(((kc==13)||(kc==9))&&this.siw.floater.style.visibility=='visible'){this.siw.selectingSomething=true;this.activateCurrentSmartInputMatch();this.hideSmartInputFloater();this.freezeEvent(e);}else if(kc==27){ajaxRequestManager.stopCalls(SMW_AJAX_AC,this.hidePendingAJAXIndicator);this.hideSmartInputFloater();this.freezeEvent(e);}else{this.siw.selectingSomething=false;}}},handleFocus:function(event){},handleBlur:function(event){var e=GeneralTools.getEvent(event);var eL=this.getEventElement(e);if(blurEl=this.isWithinNode(eL,null,"wickEnabled",null,null)){if(this.siw&& !this.siw.selectingSomething)this.hideSmartInputFloater();}if(this.timer){window.clearTimeout(this.timer);}ajaxRequestManager.stopCalls(SMW_AJAX_AC,this.hidePendingAJAXIndicator);},handleClick:function(event){var e2=GeneralTools.getEvent(event);var eL2=this.getEventElement(e2);this.mousePressed=false;if(this.siw&&this.siw.selectingSomething){this.selectFromMouseClick();}},handleMouseOver:function(event){if(this.notMoved)return;var e=GeneralTools.getEvent(event);var eL=this.getEventElement(e);if(this.siw&&(mEl=this.isWithinNode(eL,null,"matchedSmartInputItem",null,null))){this.siw.selectingSomething=true;this.selectFromMouseOver(mEl);}else if(this.isWithinNode(eL,null,"siwCredit",null,null)){this.siw.selectingSomething=true;}else if(this.siw){this.siw.selectingSomething=false;}},handleMouseDown:function(event){var e=GeneralTools.getEvent(event);var eL=this.getEventElement(e);var elementClicked=Event.element(event);if(this.siw&&elementClicked&&(Element.hasClassName(elementClicked,"MWFloaterContentHeader")||(Element.hasClassName(elementClicked.parentNode,"MWFloaterContentHeader")))){this.mousePressed=true;var x=this.findElementPosX(this.siw.inputBox);var y=this.findElementPosY(this.siw.inputBox);this.AC_yDiff=(e.pageY-y)-parseInt(this.siw.floater.style.top);this.AC_xDiff=(e.pageX-x)-parseInt(this.siw.floater.style.left);}},handleMouseMove:function(event){this.notMoved=false;if(OB_bd.isIE)return;var e=GeneralTools.getEvent(event);var eL=this.getEventElement(e);if(this.mousePressed&&this.siw){var x=this.findElementPosX(this.siw.inputBox);var y=this.findElementPosY(this.siw.inputBox);this.siw.floater.style.top=(e.pageY-y-this.AC_yDiff)+"px";this.siw.floater.style.left=(e.pageX-x-this.AC_xDiff)+"px";this.AC_userDefinedY=(e.pageY-y-this.AC_yDiff);this.AC_userDefinedX=(e.pageX-x-this.AC_xDiff);document.cookie="this.AC_userDefinedX="+this.AC_userDefinedX;document.cookie="this.AC_userDefinedY="+this.AC_userDefinedY;}},showSmartInputFloater:function(){if(!this.siw.floater.style.display||(this.siw.floater.style.display=="none")){if(!this.siw.customFloater){var x=this.findElementPosX(this.siw.inputBox);var y=this.findElementPosY(this.siw.inputBox)+this.siw.inputBox.offsetHeight;if(!OB_bd.isGecko&& !OB_bd.isIE)x+=8;if(!OB_bd.isGecko&& !OB_bd.isIE)y+=10;var posStyle=this.currentInputBox!=null?this.currentInputBox.getAttribute("position"):null;if(posStyle==null||posStyle=='absolute'){Element.setStyle(this.siw.floater,{position:'absolute'});x=x-Position.page($("globalWrapper"))[0]-Position.realOffset($("globalWrapper"))[0];y=y-Position.page($("globalWrapper"))[1]-Position.realOffset($("globalWrapper"))[1];}else if(posStyle=='fixed'){Element.setStyle(this.siw.floater,{position:'fixed'});}var alignment=this.currentInputBox!=null?this.currentInputBox.getAttribute("alignfloater"):null;if(alignment==null||alignment=='left'){this.siw.floater.style.left=x+"px";this.siw.floater.style.top=y+"px";}else{var globalWrapperWidth=$("globalWrapper");this.siw.floater.style.right=(globalWrapperWidth.offsetWidth-x-this.currentInputBox.offsetWidth)+"px";this.siw.floater.style.top=y+"px";}}else{if(!this.siw.inputBox)return;var advancedEditor=$('edit_area_toggle_checkbox_wpTextbox1')?$('edit_area_toggle_checkbox_wpTextbox1').checked:false;if(OB_bd.isIE&&this.siw.inputBox.tagName=='TEXTAREA'){var posY=this.findElementPosY(advancedEditor?$('frame_wpTextbox1'):this.siw.inputBox);var posX=this.findElementPosX(advancedEditor?$('frame_wpTextbox1'):this.siw.inputBox);this.siw.inputBox.focus();var textScrollTop=this.siw.inputBox.scrollTop;var documentScrollPos=document.documentElement.scrollTop;var selection_range=document.selection.createRange().duplicate();selection_range.collapse(true);this.siw.floater.style.left=selection_range.boundingLeft+(advancedEditor?0: -posX);this.siw.floater.style.top=selection_range.boundingTop+documentScrollPos+textScrollTop-20+(advancedEditor?posY:0);this.siw.floater.style.height=25*Math.min(this.collection.length,this.siw.MAX_MATCHES)+20;}if(OB_bd.isGecko&&this.siw.inputBox.tagName=='TEXTAREA'){var x=GeneralBrowserTools.getCookie("this.AC_userDefinedX");var y=GeneralBrowserTools.getCookie("this.AC_userDefinedY");if(x!=null&&y!=null){this.siw.floater.style.left=x+"px";this.siw.floater.style.top=y+"px";}else{if(advancedEditor){var iFrameOfAdvEditor=document.getElementById('frame_wpTextbox1');this.siw.floater.style.left=(parseInt(iFrameOfAdvEditor.style.width)-360)+"px";this.siw.floater.style.top=(parseInt(iFrameOfAdvEditor.style.height)-160)+"px";}else{this.siw.floater.style.left=(this.siw.inputBox.offsetWidth-360)+"px";this.siw.floater.style.top=(this.siw.inputBox.offsetHeight-160)+"px";}}}}this.siw.floater.style.display="block";this.siw.floater.style.visibility="visible";}},showPendingAJAXIndicator:function(inputBox){var pending=$("pendingAjaxIndicator");if(!this.siw)this.siw=new SmartInputWindow();var advancedEditor=$('edit_area_toggle_checkbox_wpTextbox1')?$('edit_area_toggle_checkbox_wpTextbox1').checked:false;var iFrameOfAdvEditor=document.getElementById('frame_wpTextbox1');if(OB_bd.isIE&&inputBox.tagName=='TEXTAREA'){var posY=this.findElementPosY(inputBox);var posX=this.findElementPosX(inputBox);inputBox.focus();var textScrollTop=inputBox.scrollTop;var documentScrollPos=document.documentElement.scrollTop;var selection_range=document.selection.createRange().duplicate();selection_range.collapse(true);pending.style.left=selection_range.boundingLeft-posX;pending.style.top=selection_range.boundingTop+documentScrollPos+textScrollTop-20;}if(OB_bd.isGecko&&inputBox.tagName=='TEXTAREA'){var x=GeneralBrowserTools.getCookie("this.AC_userDefinedX");var y=GeneralBrowserTools.getCookie("this.AC_userDefinedY");if(x!=null&&y!=null){var posY=this.findElementPosY(advancedEditor?iFrameOfAdvEditor:inputBox);var posX=this.findElementPosX(advancedEditor?iFrameOfAdvEditor:inputBox);pending.style.left=(parseInt(x)+posX)+"px";pending.style.top=(parseInt(y)+posY)+"px";}else{if(advancedEditor){pending.style.left=(this.findElementPosX(iFrameOfAdvEditor)+parseInt(iFrameOfAdvEditor.style.width)-360)+"px";pending.style.top=(this.findElementPosY(iFrameOfAdvEditor)+parseInt(iFrameOfAdvEditor.style.height)-160)+"px";}else{pending.style.left=(this.findElementPosX(inputBox)+inputBox.offsetWidth-360)+"px";pending.style.top=(this.findElementPosY(inputBox)+inputBox.offsetHeight-160)+"px";}}}pending.style.display="block";pending.style.visibility="visible";},hidePendingAJAXIndicator:function(){var pending=$("pendingAjaxIndicator");pending.style.display="none";pending.style.visibility="hidden";},hideSmartInputFloater:function(){if(this.siw){this.siw.floater.style.display="none";this.siw.floater.style.visibility="hidden";this.siw=null;}},processSmartInput:function(inputBox,userInput){if(!this.siw)return;var classData=inputBox.className.split(" ");var siwDirectives=null;for(i=0;(!siwDirectives&&classData[i]);i++){if(classData[i].indexOf("wickEnabled")!= -1)siwDirectives=classData[i];}if(siwDirectives&&(siwDirectives.indexOf(":")!= -1)){this.siw.customFloater=true;var newFloaterId=siwDirectives.split(":")[1];this.siw.floater=document.getElementById(newFloaterId);this.siw.floaterContent=this.siw.floater.getElementsByTagName("div")[OB_bd.isGecko?1:0];}this.setSmartInputData(userInput);var content1=this.getSmartInputBoxContent();if(content1){this.modifySmartInputBoxContent(content1);this.showSmartInputFloater();if(OB_bd.isIE){this.siw.floater.style.height=25*Math.min(this.collection.length,this.siw.MAX_MATCHES)+20;this.siw.floater.firstChild.style.height=25*Math.min(this.collection.length,this.siw.MAX_MATCHES)+20;}}else this.hideSmartInputFloater();},simplify:function(s){var nopipe=s.indexOf("|")!= -1?s.substring(0,s.indexOf("|")).strip():s;return nopipe.replace(/^[ \s\f\t\n\r]+/,'').replace(/[ \s\f\t\n\r]+$/,'');},getUserInputToMatch:function(){if(!this.siw)return "";if(this.siw.inputBox.tagName=='TEXTAREA'){var textBeforeCursor=this.getTextBeforeCursor();var userInputToMatch=textBeforeCursor.match(this.articleRegEx);return userInputToMatch?userInputToMatch[0].replace(/\s/,"_").replace(/category\:/i,""):"";}else{a=this.siw.inputBox.value;fields=this.siw.inputBox.value.split(";");if(fields.length>0)a=fields[fields.length-1];return a.strip();}},getUserContext:function(){if(this.siw!=null&&this.siw.inputBox!=null&&this.siw.inputBox.tagName=='TEXTAREA'){var textBeforeCursor=this.getTextBeforeCursor();var userContextStart=Math.max(textBeforeCursor.lastIndexOf("[["),textBeforeCursor.lastIndexOf("{{"));var closingSemTag=Math.max(textBeforeCursor.lastIndexOf("]]"),textBeforeCursor.lastIndexOf("}}"));if(userContextStart!= -1&&userContextStart>closingSemTag){var userInputToMatch=this.getUserInputToMatch();if(userInputToMatch!=null){var lengthOfContext=textBeforeCursor.length-userInputToMatch.length;return textBeforeCursor.substring(userContextStart,lengthOfContext);}}return "";}else{return "";}},getTextBeforeCursor:function(){if(OB_bd.isIE){var selection_range=document.selection.createRange();var selection_rangeWhole=document.selection.createRange();selection_rangeWhole.moveToElementText(this.siw.inputBox);selection_range.setEndPoint("StartToStart",selection_rangeWhole);return selection_range.text;}else if(OB_bd.isGecko){var start=this.siw.inputBox.selectionStart;return this.siw.inputBox.value.substring(0,start);}return "";},getTextAfterCursor:function(){if(OB_bd.isIE){var selection_range=document.selection.createRange();var selection_rangeWhole=document.selection.createRange();selection_rangeWhole.moveToElementText(this.siw.inputBox);selection_range.setEndPoint("EndToEnd",selection_rangeWhole);return selection_range.text;}else if(OB_bd.isGecko){var start=this.siw.inputBox.selectionStart;return this.siw.inputBox.value.substring(start);}return "";},getUserInputBase:function(){var s=this.siw.inputBox.value;var lastComma=s.lastIndexOf(";");return s.substr(0,lastComma+1);},highlightMatches:function(userInput){var userInput=this.simplify(userInput);userInput=userInput.replace(/\s/,"_");if(this.siw)this.siw.matchCollection=new Array();var pointerToCollectionToUse=this.collection;var re1m=new RegExp("([ \"\>\<\-]*)("+userInput+")","i");var re2m=new RegExp("([ \"\>\<\-]+)("+userInput+")","i");var re1=new RegExp("([ \"\}\{\-]*)("+userInput+")","gi");var re2=new RegExp("([ \"\}\{\-]+)("+userInput+")","gi");for(i=0,j=0;(i<pointerToCollectionToUse.length);i++){var displayMatches=(j<this.siw.MAX_MATCHES);var entry=pointerToCollectionToUse[i];var mEntry=this.simplify(entry.getText());if((mEntry.indexOf(userInput)==0)){userInput=userInput.replace(/\>/gi,'\\}').replace(/\< ?/gi,'\\{');re=new RegExp("("+userInput+")","i");if(displayMatches){this.siw.matchCollection[j]=new SmartInputMatch(entry.getText(),mEntry.replace(/\>/gi,'}').replace(/\< ?/gi,'{').replace(re,"<b>$1</b>"),entry.getType());}j++;}else if(mEntry.match(re1m)||mEntry.match(re2m)){if(displayMatches){this.siw.matchCollection[j]=new SmartInputMatch(entry.getText(),mEntry.replace(/\>/gi,'}').replace(/\</gi,'{').replace(re1,"$1<b>$2</b>").replace(re2,"$1<b>$2</b>").replace(/_/g,' '),entry.getType());}j++;}}},setSmartInputData:function(orgUserInput){if(this.siw){var userInput=orgUserInput.toLowerCase().replace(/[\r\n\t\f\s]+/gi,' ').replace(/^ +/gi,'').replace(/ +$/gi,'').replace(/ +/gi,' ').replace(/\\/gi,'').replace(/\[/gi,'').replace(/\(/gi,'\\(').replace(/\./gi,'\.').replace(/\?/gi,'').replace(/\)/gi,'\\)');if(userInput!=null&&(userInput!='"')){this.highlightMatches(userInput);}else{this.siw.matchCollection=null;}}},getSmartInputBoxContent:function(){var a=null;if(this.siw&&this.siw.matchCollection&&(this.siw.matchCollection.length>0)){a='';for(i=0;i<this.siw.matchCollection.length;i++){selectedString=this.siw.matchCollection[i].isSelected?' selectedSmartInputItem':'';var id=("selected"+i);a+='<p id="'+id+'" class="matchedSmartInputItem'+selectedString+'">'+this.siw.matchCollection[i].getImageTag()+"\t"+this.siw.matchCollection[i].value.replace(/\{ */gi,"&lt;").replace(/\} */gi,"&gt;")+'</p>';}}return a;},modifySmartInputBoxContent:function(content){this.siw.floaterContent.innerHTML='<div id="smartInputResults">'+content+(this.siw.showCredit?('<p class="siwCredit">Powered By: <a target="PhrawgBlog" href="http://chrisholland.blogspot.com/?from=smartinput&ref='+escape(location.href)+'">Chris Holland</a></p>'):'')+'</div>';this.siw.matchListDisplay=document.getElementById("smartInputResults");if(OB_bd.isGecko){this.scrollToSelectedItem();}},scrollToSelectedItem:function(){for(i=0;i<this.siw.matchCollection.length;i++){if(this.siw.matchCollection[i].isSelected){var selElement=document.getElementById("selected"+i);selElement.scrollIntoView(false);return;}}},selectFromMouseOver:function(o){var currentIndex=this.getCurrentlySelectedSmartInputItem();if(currentIndex!=null)this.deSelectSmartInputMatchItem(currentIndex);var newIndex=this.getIndexFromElement(o);this.selectSmartInputMatchItem(newIndex);this.modifySmartInputBoxContent(this.getSmartInputBoxContent());},selectFromMouseClick:function(){this.activateCurrentSmartInputMatch();this.siw.inputBox.focus();this.siw.inputBox.blur();this.hideSmartInputFloater();},getIndexFromElement:function(o){var index=0;while(o=o.previousSibling){index++;}return index;},getCurrentlySelectedSmartInputItem:function(){var answer=null;if(!this.siw.matchCollection)return;for(i=0;((i<this.siw.matchCollection.length)&& !answer);i++){if(this.siw.matchCollection[i].isSelected)answer=i;}return answer;},selectSmartInputMatchItem:function(index){if(!this.siw.matchCollection)return;this.siw.matchCollection[index].isSelected=true;},deSelectSmartInputMatchItem:function(index){if(!this.siw.matchCollection)return;this.siw.matchCollection[index].isSelected=false;},selectNextSmartInputMatchItem:function(){if(!this.siw.matchCollection)return;currentIndex=this.getCurrentlySelectedSmartInputItem();if(currentIndex!=null){this.deSelectSmartInputMatchItem(currentIndex);if((currentIndex+1)<this.siw.matchCollection.length)this.selectSmartInputMatchItem(currentIndex+1);else this.selectSmartInputMatchItem(0);}else{this.selectSmartInputMatchItem(0);}this.modifySmartInputBoxContent(this.getSmartInputBoxContent());},selectPreviousSmartInputMatchItem:function(){if(!this.siw.matchCollection)return;var currentIndex=this.getCurrentlySelectedSmartInputItem();if(currentIndex!=null){this.deSelectSmartInputMatchItem(currentIndex);if((currentIndex-1)>=0)this.selectSmartInputMatchItem(currentIndex-1);else this.selectSmartInputMatchItem(this.siw.matchCollection.length-1);}else{this.selectSmartInputMatchItem(this.siw.matchCollection.length-1);}this.modifySmartInputBoxContent(this.getSmartInputBoxContent());},activateCurrentSmartInputMatch:function(){var baseValue=this.getUserInputBase();if((selIndex=this.getCurrentlySelectedSmartInputItem())!=null){addedValue=this.siw.matchCollection[selIndex].cleanValue;this.insertTerm(addedValue,baseValue,this.siw.matchCollection[selIndex].getType());this.ignorePending=true;}},insertTerm:function(addedValue,baseValue,type){addedValue=addedValue.replace(/_/g," ");var userContext=this.getUserContext();if(this.siw.customFloater){if((userContext.match(/:=/)||userContext.match(/::/)||userContext.match(/category:/i))&& !this.getTextAfterCursor().match(/^\s*\]\]|^\s*\||^\s*;/)){addedValue+="]]";}else if(type==SMW_PROPERTY_NS){addedValue+=":=";}else if(type==SMW_INSTANCE_NS){addedValue+="]]";}else if(addedValue.match(/category/i)){addedValue+=":";}}if(OB_bd.isIE&&this.siw.inputBox.tagName=='TEXTAREA'){this.siw.inputBox.focus();var userInput=this.getUserInputToMatch();var selection_range=document.selection.createRange();selection_range.moveStart("character",-userInput.length);selection_range.text=addedValue;selection_range.collapse(false);}else if(OB_bd.isGecko&&this.siw.inputBox.tagName=='TEXTAREA'){var userInput=this.getUserInputToMatch();var scrollTop=this.siw.inputBox.scrollTop;var start=this.siw.inputBox.selectionStart;var pre=this.siw.inputBox.value.substring(0,start-userInput.length);var suf=this.siw.inputBox.value.substring(start);theString=pre+addedValue+suf;this.siw.inputBox.value=theString;this.siw.inputBox.selectionStart=start+addedValue.length-userInput.length;this.siw.inputBox.selectionEnd=start+addedValue.length-userInput.length;this.siw.inputBox.scrollTop=scrollTop;}else{var pasteNS=this.currentInputBox!=null?this.currentInputBox.getAttribute("pasteNS"):null;theString=(baseValue?baseValue:"")+addedValue;if(pasteNS!=null){switch(type){case SMW_PROPERTY_NS:theString=gLanguage.getMessage('PROPERTY')+theString;break;case SMW_CATEGORY_NS:theString=gLanguage.getMessage('CATEGORY')+theString;break;case SMW_TEMPLATE_NS:theString=gLanguage.getMessage('TEMPLATE')+theString;break;case SMW_TYPE_NS:theString=gLanguage.getMessage('TYPE')+theString;break;}}this.siw.inputBox.value=theString;}},registerSmartInputListeners:function(){var inputs=document.getElementsByTagName("input");var texts=Array();texts[0]=document.getElementById("wpTextbox1");AC_matchCache=new MatchCache();this.registerAllInputs();this.textAreas=new Array();var y=0;if(texts){while(texts[y]){this.textAreas.push(texts[y]);this.createEmbeddingContainer(texts[y]);y++;}}var contentElement=document.getElementById("globalWrapper");contentElement.appendChild(this.createFloater());var pending=this.createPendingAJAXIndicator();contentElement.appendChild(pending);this.siw=null;Event.observe(document,"keydown",this.handleKeyDown.bindAsEventListener(this),false);Event.observe(document,"keyup",this.handleKeyPress.bindAsEventListener(this),false);Event.observe(document,"mouseup",this.handleClick.bindAsEventListener(this),false);Event.observe(document,"mousemove",this.handleMouseMove.bindAsEventListener(this),false);if(OB_bd.isGecko){Event.observe(document,"mousedown",this.handleMouseDown.bindAsEventListener(this),false);}Event.observe(document,"mouseover",this.handleMouseOver.bindAsEventListener(this),false);},registerAllInputs:function(){var inputs=document.getElementsByTagName("input");this.allInputs=new Array();var x=0;var z=0;var c=null;if(inputs){while(inputs[x]){if((c=inputs[x].className)&&(c.indexOf("wickEnabled")!= -1)){this.allInputs[z]=new Array();this.allInputs[z][0]=inputs[x];z++;}x++;}}for(i=0;i<this.allInputs.length;i++){if((c=this.allInputs[i][0].className)&&(c.indexOf("wickEnabled")!= -1)){this.allInputs[i][0].setAttribute("autocomplete","OFF");this.allInputs[i][1]=this.handleBlur.bindAsEventListener(this);Event.observe(this.allInputs[i][0],"blur",this.allInputs[i][1]);}}},deregisterAllInputs:function(){if(this.allInputs!=null){for(i=0;i<this.allInputs.length;i++){Event.stopObserving(this.allInputs[i][0],"blur",this.allInputs[i][1]);}}},registerTextArea:function(textAreaID,iFrame){if(iFrame&&textAreaID){var textArea=iFrame.document.getElementById(textAreaID);if(textArea){if(this.textAreas.indexOf(textArea)!= -1){return;}this.textAreas.push(textArea);var iFrameDocument=iFrame.document;Event.observe(iFrameDocument,"keydown",this.handleKeyDown.bindAsEventListener(this),false);Event.observe(iFrameDocument,"keyup",this.handleKeyPress.bindAsEventListener(this),false);Event.observe(iFrameDocument,"mouseup",this.handleClick.bindAsEventListener(this),false);if(OB_bd.isGecko){Event.observe(iFrameDocument,"mousedown",this.handleMouseDown.bindAsEventListener(this),false);Event.observe(iFrameDocument,"mousemove",this.handleMouseMove.bindAsEventListener(this),false);}Event.observe(iFrameDocument,"mouseover",this.handleMouseOver.bindAsEventListener(this),false);}}},createEmbeddingContainer:function(textarea){var container=document.createElement("div");container.setAttribute("style","position:relative;text-align:left");var mwFloater=document.createElement("div");mwFloater.setAttribute("id","MWFloater"+this.AC_idCounter);Element.addClassName(mwFloater,"MWFloater");var mwContent=document.createElement("div");Element.addClassName(mwContent,"MWFloaterContent");if(OB_bd.isGecko){var mwContentHeader=document.createElement("div");Element.addClassName(mwContentHeader,"MWFloaterContentHeader");var textinHeader=document.createElement("span");textinHeader.setAttribute("style","margin-left:5px;");textinHeader.innerHTML=gLanguage.getMessage('AC_CLICK_TO_DRAG');var cross=document.createElement("img");Element.addClassName(cross,"closeFloater");cross.setAttribute("src",wgServer+wgScriptPath+"/extensions/SMWHalo/skins/Autocompletion/close.gif");cross.setAttribute("onclick","javascript:autoCompleter.hideSmartInputFloater()");cross.setAttribute("style","margin-left:4px;margin-bottom:3px;");mwContentHeader.appendChild(cross);mwContentHeader.appendChild(textinHeader);mwFloater.appendChild(mwContentHeader);}container.appendChild(mwFloater);mwFloater.appendChild(mwContent);var parent=textarea.parentNode;var f=parent.replaceChild(container,textarea);Element.addClassName(f,"wickEnabled:MWFloater"+this.AC_idCounter);container.appendChild(f);var acMessage=document.createElement("span");Element.addClassName(acMessage,"acMessage");acMessage.innerHTML=gLanguage.getMessage('AUTOCOMPLETION_HINT');container.appendChild(acMessage);this.AC_idCounter++;},createFloater:function(){var tableElement=document.createElement("table");var tbodyElement=document.createElement("tbody");tableElement.setAttribute("id","smartInputFloater");Element.addClassName(tableElement,"floater");tableElement.setAttribute("cellpadding","0");tableElement.setAttribute("cellspacing","0");var trElement=document.createElement("tr");var tdElement=document.createElement("td");tdElement.setAttribute("id","smartInputFloaterContent");tdElement.setAttribute("nowrap","nowrap");trElement.appendChild(tdElement);tbodyElement.appendChild(trElement);tableElement.appendChild(tbodyElement);return tableElement;},createPendingAJAXIndicator:function(){var pending=document.createElement("img");Element.addClassName(pending,"pendingElement");pending.setAttribute("src",wgServer+wgScriptPath+"/extensions/SMWHalo/skins/Autocompletion/pending.gif");pending.setAttribute("id","pendingAjaxIndicator");return pending;},getMatchItems:function(xml){var list=GeneralXMLTools.createDocumentFromString(xml);var children=list.firstChild.childNodes;var collection=new Array();for(var i=0,n=children.length;i<n;i++){collection[i]=new MatchItem(children[i].firstChild.nodeValue,parseInt(children[i].getAttribute("type")));}return collection;}};function MatchItem(text,type){var _text=text;var _type=type;this.getText=function(){return _text;};this.getType=function(){return _type;}};function SmartInputWindow(){this.customFloater=false;this.floater=document.getElementById("smartInputFloater");this.floaterContent=document.getElementById("smartInputFloaterContent");this.selectedSmartInputItem=null;this.MAX_MATCHES=15;this.showCredit=false;};function SmartInputMatch(cleanValue,value,type){this.cleanValue=cleanValue;this.value=value;this.isSelected=false;var _type=type;this.getImageTag=function(){if(_type==SMW_INSTANCE_NS){return "<img src=\""+wgServer+wgScriptPath+"/extensions/SMWHalo/skins/instance.gif\">";}else if(_type==SMW_CATEGORY_NS){return "<img src=\""+wgServer+wgScriptPath+"/extensions/SMWHalo/skins/concept.gif\">";}else if(_type==SMW_PROPERTY_NS){return "<img src=\""+wgServer+wgScriptPath+"/extensions/SMWHalo/skins/property.gif\">";}else if(_type==SMW_TEMPLATE_NS){return "<img src=\""+wgServer+wgScriptPath+"/extensions/SMWHalo/skins/template.gif\">";}else if(_type==SMW_TYPE_NS){return "<img src=\""+wgServer+wgScriptPath+"/extensions/SMWHalo/skins/template.gif\">";}return "";};this.getType=function(){return _type;}};function MatchCache(){var generalCache=$H({});var typeFilteredCache=$H({14:$H({}),102:$H({}),100:$H({}),0:$H({}),10:$H({})});var nextToReplace=0;var MAX_CACHE=10;this.addLookup=function(matchText,matches,typeHint){if(matchText==""||matchText==null)return;if(typeHint==null){if(generalCache.keys().length==MAX_CACHE){generalCache.remove(generalCache.keys()[nextToReplace]);nextToReplace++;if(nextToReplace==MAX_CACHE){nextToReplace=0;}}generalCache[matchText]=matches;}else{var cache=typeFilteredCache[parseInt(typeHint)];if(!cache)return;if(cache.keys().length==MAX_CACHE){cache.remove(cache.keys()[nextToReplace]);nextToReplace++;if(nextToReplace==MAX_CACHE){nextToReplace=0;}}cache[matchText]=matches;}};this.getLookup=function(matchText,typeHint){if(typeHint==null){if(generalCache[matchText]){return generalCache[matchText];}}else{var cache=typeFilteredCache[parseInt(typeHint)];if(!cache)return null;return cache[matchText];}return null;}};autoCompleter=new AutoCompleter();Event.observe(window,'load',autoCompleter.registerSmartInputListeners.bind(autoCompleter));var AC_mode=GeneralBrowserTools.getCookie("AC_mode");if(AC_mode==null){sajax_do_call('smwfAutoCompletionOptions',[],autoCompletionsOptions);}else{autoCompleter.autoTriggering=(AC_mode=='auto');}

// SMW_Help.js
Event.observe(window,'load',smw_help_callme);var initHelp=function(){var ns=wgNamespaceNumber==0?"Main":wgCanonicalNamespace;if(wgNamespaceNumber== -1&&wgCanonicalSpecialPageName=="Search"){ns="Search";}sajax_do_call('smwfGetHelp',[ns,wgAction],displayHelp);};function smw_help_callme(){if((wgAction=="edit"||wgCanonicalSpecialPageName=="Search")&&stb_control.isToolbarAvailable()){helpcontainer=stb_control.createDivContainer(HELPCONTAINER,0);helpcontainer.setHeadline('<img src="'+wgScriptPath+'/extensions/SMWHalo/skins/help.gif"/> Help');initHelp();}};function displayHelp(request){if(request.responseText!=''){helpcontainer.setContent(request.responseText);}else{helpcontainer.setHeadline=' ';}helpcontainer.contentChanged();};function askQuestion(){$('questionLoaderIcon').show();var ns=wgNamespaceNumber==0?"Main":wgCanonicalNamespace;if(wgNamespaceNumber== -1&&wgCanonicalSpecialPageName=="Search"){ns="Search";}sajax_do_call('smwfAskQuestion',[ns,wgAction,$('question').value],hideQuestionForm);};function hideQuestionForm(request){$('questionLoaderIcon').hide();$('askHelp').hide();alert(request.responseText);};function submitenter(myfield,e){var keycode;if(window.event){keycode=window.event.keyCode;}else if(e){keycode=e.which;}else{return true;}if(keycode==13){askQuestion();return false;}else{return true;}}

// SMW_Links.js
Event.observe(window,'load',smw_links_callme);var createLinkList=function(){sajax_do_call('getLinks',[wgArticleId],addLinks);};function smw_links_callme(){if(wgAction=="edit"&&stb_control.isToolbarAvailable()){editcontainer=stb_control.createDivContainer(EDITCONTAINER,1);createLinkList();}};function addLinks(request){if(request.responseText!=''){editcontainer.setContent(request.responseText);editcontainer.contentChanged();}};function filter(term,_id,cellNr){var suche=term.value.toLowerCase();var table=document.getElementById(_id);var ele;for(var r=0;r<table.rows.length;r++){ele=table.rows[r].cells[cellNr].innerHTML.replace(/<[^>]+>/g,"");if(ele.toLowerCase().indexOf(suche)>=0)table.rows[r].style.display='';else table.rows[r].style.display='none';}};function update(){$("linkfilter").value="";filter($("linkfilter"),"linktable",0);}

// Annotation.js
var WtpAnnotation=Class.create();WtpAnnotation.prototype={initialize:function(annotation,start,end,wtp,prefix){this.WtpAnnotation(annotation,start,end,wtp);},WtpAnnotation:function(annotation,start,end,wtp,prefix){this.annotation=annotation;this.start=start;this.end=end;this.wikiTextParser=wtp;this.prefix=prefix?prefix:"";this.name=null;this.representation=null;},getAnnotation:function(){return this.annotation;},getName:function(){return this.name;},getRepresentation:function(){if(this.representation==null){return "";}else{return this.representation;}},getStart:function(){return this.start;},getEnd:function(){return this.end;},getPrefix:function(){return this.prefix;},select:function(){this.wikiTextParser.setSelection(this.start,this.end);},replaceAnnotation:function(newAnnotation){this.wikiTextParser.replaceAnnotation(this,newAnnotation);var oldLen=this.annotation.length;var newLen=newAnnotation.length;this.end+=newLen-oldLen;this.annotation=newAnnotation;},move:function(offset,start){if(this.start>start){this.start+=offset;this.end+=offset;}},remove:function(replacementText){this.replaceAnnotation(replacementText);this.wikiTextParser.removeAnnotation(this);}};var WtpRelation=Class.create();WtpRelation.prototype=Object.extend(new WtpAnnotation(),{initialize:function(annotation,start,end,wtp,prefix,relationName,relationValue,representation){this.WtpAnnotation(annotation,start,end,wtp,prefix);this.WtpRelation(relationName,relationValue,representation);},WtpRelation:function(relationName,relationValue,representation){this.name=relationName;this.value=relationValue;this.representation=representation;this.splitValues=this.value.split(";");this.arity=this.splitValues.length+1;},getValue:function(){return this.value;},getSplitValues:function(){return this.splitValues;},getArity:function(){return this.arity;},rename:function(newRelationName){var newAnnotation="[["+this.prefix+newRelationName+":="+this.value;if(this.representation){newAnnotation+="|"+this.representation;}newAnnotation+="]]";this.name=newRelationName;this.replaceAnnotation(newAnnotation);},changeValue:function(newValue){var newAnnotation="[["+this.prefix+this.name+":="+newValue;if(this.representation){newAnnotation+="|"+this.representation;}newAnnotation+="]]";this.value=newValue;this.replaceAnnotation(newAnnotation);},changeRepresentation:function(newRepresentation){var newAnnotation="[["+this.prefix+this.name+":="+this.value;if(newRepresentation&&newRepresentation!=""){newAnnotation+="|"+newRepresentation;}newAnnotation+="]]";this.representation=newRepresentation;this.replaceAnnotation(newAnnotation);},inspect:function(){var content="Annotation: "+this.annotation+"<br />"+"Name : "+this.name+"<br />"+"Value: "+this.value+"<br />"+"Rep. : "+this.representation+"<br />"+"Start: "+this.start+"<br />"+"End  : "+this.end+"<br />";return content;}});var WtpCategory=Class.create();WtpCategory.prototype=Object.extend(new WtpAnnotation(),{initialize:function(annotation,start,end,wtp,prefix,categoryName,representation){this.WtpAnnotation(annotation,start,end,wtp,prefix);this.WtpCategory(categoryName,representation);},WtpCategory:function(categoryName,representation){this.name=categoryName;this.representation=representation;},changeCategory:function(newCategoryName){var newAnnotation="[["+this.prefix+gLanguage.getMessage('CATEGORY')+newCategoryName;if(this.representation){newAnnotation+="|"+this.representation;}newAnnotation+="]]";this.name=newCategoryName;this.replaceAnnotation(newAnnotation);},changeRepresentation:function(newRepresentation){var newAnnotation="[["+this.prefix+gLanguage.getMessage('CATEGORY')+this.name;if(newRepresentation&&newRepresentation!=""){newAnnotation+="|"+newRepresentation;}newAnnotation+="]]";this.representation=newRepresentation;this.replaceAnnotation(newAnnotation);},inspect:function(){var content="Annotation: "+this.annotation+"<br />"+"Name : "+this.name+"<br />"+"Rep. : "+this.representation+"<br />"+"Start: "+this.start+"<br />"+"End  : "+this.end+"<br />";return content;}});var WtpLink=Class.create();WtpLink.prototype=Object.extend(new WtpAnnotation(),{initialize:function(annotation,start,end,wtp,prefix,link,representation){this.WtpAnnotation(annotation,start,end,wtp,prefix);this.WtpLink(link,representation);},WtpLink:function(link,representation){this.name=link;this.representation=representation;},changeLink:function(newLink){var newAnnotation="[["+this.prefix+newLink;if(this.representation){newAnnotation+="|"+this.representation;}newAnnotation+="]]";this.name=newLink;this.replaceAnnotation(newAnnotation);},changeRepresentation:function(newRepresentation){var newAnnotation="[["+this.prefix+this.name;if(newRepresentation&&newRepresentation!=""){newAnnotation+="|"+newRepresentation;}newAnnotation+="]]";this.representation=newRepresentation;this.replaceAnnotation(newAnnotation);},inspect:function(){var content="Annotation: "+this.annotation+"<br />"+"Name : "+this.name+"<br />"+"Rep. : "+this.representation+"<br />"+"Start: "+this.start+"<br />"+"End  : "+this.end+"<br />";return content;}}); 

// WikiTextParser.js
var WTP_NO_ERROR=0;var WTP_UNMATCHED_BRACKETS=1;var WikiTextParser=Class.create();var gEditInterface=null;WikiTextParser.prototype={initialize:function(){var txtarea;if(document.editform){txtarea=document.editform.wpTextbox1;}else{var areas=document.getElementsByTagName('textarea');txtarea=areas[0];}this.textarea=txtarea;if(gEditInterface==null){gEditInterface=new SMWEditInterface();}this.editInterface=gEditInterface;this.text=this.editInterface.getValue();this.relations=null;this.categories=null;this.links=null;this.error=WTP_NO_ERROR;},getError:function(){return this.error;},getWikiText:function(){return this.text;},getRelation:function(name){if(this.relations==null){this.parseAnnotations();}var matching=new Array();for(var i=0,num=this.relations.length;i<num;++i){var rel=this.relations[i];if(this.equalWikiName(rel.getName(),name)){matching.push(rel);}}return matching.length==0?null:matching;},getRelations:function(){if(this.relations==null){this.parseAnnotations();}return this.relations;},getCategories:function(){if(this.categories==null){this.parseAnnotations();}return this.categories;},getCategory:function(name){if(this.categories==null){this.parseAnnotations();}for(var i=0,num=this.categories.length;i<num;++i){var cat=this.categories[i];if(this.equalWikiName(cat.getName(),name)){return cat;}}return null;},getLinks:function(){if(this.links==null){this.parseAnnotations();}return this.links;},addRelation:function(name,value,representation,append){var anno="[["+name+":="+value;if(representation){anno+="|"+representation;}anno+="]]";this.addAnnotation(anno,append);},addCategory:function(name,append){var anno="[["+gLanguage.getMessage('CATEGORY')+name;anno+="]]";this.addAnnotation(anno,append);},addLink:function(link,representation,append){var anno="[["+link;if(representation){anno+="|"+representation;}anno+="]]";this.addAnnotation(anno,append);},replaceAnnotation:function(annoObj,newAnnotation){var startText=this.text.substring(0,annoObj.getStart());var endText=this.text.substr(annoObj.getEnd());var diffLen=newAnnotation.length-annoObj.getAnnotation().length;this.text=startText+newAnnotation+endText;this.editInterface.setValue(this.text);this.updateAnnotationPositions(annoObj.getStart(),diffLen);},getSelection:function(){return this.editInterface.getSelectedText();},setSelection:function(start,end){this.editInterface.setSelectionRange(start,end);},parseAnnotations:function(){this.relations=new Array();this.categories=new Array();this.links=new Array();this.error=WTP_NO_ERROR;var state=0;var bracketCount=0;var nowikiCount=0;var askCount=0;var currentPos=0;var bracketStart= -1;var parsing=true;while(parsing){switch(state){case 0:var findings=this.findFirstOf(currentPos,["[[","<nowiki>","<ask"]);if(findings[1]==null){parsing=false;break;}currentPos=findings[0]+1;if(findings[1]=="[["){bracketStart=findings[0];bracketCount++;state=1;}else if(findings[1]=="<nowiki>"){bracketStart= -1;nowikiCount++;state=2;}else{bracketStart= -1;askCount++;state=3;}break;case 1:var findings=this.findFirstOf(currentPos,["[[","]]"]);if(findings[1]==null){parsing=false;break;}currentPos=findings[0]+2;if(findings[1]=="[["){bracketCount++;}else{bracketCount--;if(bracketCount==0){var anno=this.createAnnotation(this.text.substring(bracketStart,findings[0]+2),bracketStart,findings[0]+2);if(anno){if(anno instanceof WtpRelation){this.relations.push(anno);}else if(anno instanceof WtpCategory){this.categories.push(anno);}else if(anno instanceof WtpLink){this.links.push(anno);}}state=0;}}break;case 2:var findings=this.findFirstOf(currentPos,["</nowiki>","<nowiki>"]);if(findings[1]==null){parsing=false;break;}currentPos=findings[0]+7;if(findings[1]=="<nowiki>"){nowikiCount++;}else{nowikiCount--;if(nowikiCount==0){state=0;}}break;case 3:var findings=this.findFirstOf(currentPos,["</ask>","<ask"]);if(findings[1]==null){parsing=false;break;}currentPos=findings[0]+4;if(findings[1]=="<ask"){askCount++;}else{askCount--;if(askCount==0){state=0;}}break;}}if(bracketCount!=0){this.error=WTP_UNMATCHED_BRACKETS;}},createAnnotation:function(annotation,start,end){var relRE=/\[\[\s*(:?)([^:]*)(::|:=)([\s\S\n\r]*)\]\]/;var catRE=/\[\[\s*[C|c]ategory:([\s\S\n\r]*)\]\]/;var relation=annotation.match(relRE);if(relation){var relName=relation[2].match(/[\s\n\r]*(.*)[\s\n\r]*/);var valRep=this.getValueAndRepresentation(relation[4]);return new WtpRelation(annotation,start,end,this,relation[1],relName[1],valRep[0],valRep[1]);}var category=annotation.match(catRE);if(category){var catName=category[1].match(/[\s\n\r]*(.*)[\s\n\r]*/);var valRep=this.getValueAndRepresentation(catName[1]);return new WtpCategory(annotation,start,end,this,"",valRep[0],valRep[1]);}var linkName=annotation.match(/\[\[[\s\n\r]*((.|\n)*)[\s\n\r]*\]\]/);var valRep=this.getValueAndRepresentation(linkName[1]);return new WtpLink(annotation,start,end,this,null,valRep[0],valRep[1]);return null;},updateAnnotationPositions:function(start,offset){if(offset==0){return;}var i;for(i=0,len=this.relations.length;i<len;i++){this.relations[i].move(offset,start);}for(i=0,len=this.categories.length;i<len;i++){this.categories[i].move(offset,start);}for(i=0,len=this.links.length;i<len;i++){this.links[i].move(offset,start);}},addAnnotation:function(annotation,append){if(append){this.editInterface.setValue(this.editInterface.getValue()+annotation);}else{this.replaceText(annotation);}this.initialize();},removeAnnotation:function(annotation){var annoArray=null;if(annotation instanceof WtpRelation){annoArray=this.relations;}else if(annotation instanceof WtpCategory){annoArray=this.categories;}else if(annotation instanceof WtpLink){annoArray=this.links;}else{return;}for(var i=0,len=annoArray.length;i<len;i++){if(annoArray[i]==annotation){annoArray.splice(i,1);break;}}},findFirstOf:function(startPos,searchStrings,findIn){var firstPos= -1;var firstMatch=null;for(var i=0,len=searchStrings.length;i<len;++i){var ss=searchStrings[i];var pos=findIn?findIn.indexOf(ss,startPos):this.text.indexOf(ss,startPos);if(pos!= -1&&(pos<firstPos||firstPos== -1)){firstPos=pos;firstMatch=ss;}}return[firstPos,firstMatch];},getValueAndRepresentation:function(valrep){var state=0;var bracketCount=0;var curlyCount=0;var currentPos=0;var parsing=true;while(parsing){switch(state){case 0:var findings=this.findFirstOf(currentPos,["[[","{{","|"],valrep);if(findings[1]==null){parsing=false;break;}currentPos=findings[0]+1;if(findings[1]=="[["){bracketCount++;state=1;}else if(findings[1]=="{{"){curlyCount++;state=2;}else{if(bracketCount==0){var val=valrep.substring(0,findings[0]);var rep=valrep.substring(findings[0]+1);return[val,rep];}}break;case 1:var findings=this.findFirstOf(currentPos,["[[","]]"],valrep);if(findings[1]==null){parsing=false;break;}currentPos=findings[0]+2;if(findings[1]=="[["){bracketCount++;}else{bracketCount--;if(bracketCount==0){state=0;}}break;case 2:var findings=this.findFirstOf(currentPos,["{{","}}"],valrep);if(findings[1]==null){parsing=false;break;}currentPos=findings[0]+2;if(findings[1]=="{{"){curlyCount++;}else{curlyCount--;if(curlyCount==0){state=0;}}break;}}return[valrep,null];},replaceText:function(text){this.editInterface.setSelectedText(text);},equalWikiName:function(name1,name2){if(name1.substring(1)==name2.substring(1)){if(name1.charAt(0).toLowerCase()==name2.charAt(0).toLowerCase()){return true;}}return false;}}; 

// SMW_Ontology.js
var OntologyModifier=Class.create();OntologyModifier.prototype={initialize:function(){this.redirect=false;},existsArticle:function(pageName,callback,title,optparam,domElementID){function ajaxResponseExistsArticle(request){var answer=request.responseText;var regex=/(true|false)/;var parts=answer.match(regex);if(parts==null){var errMag=gLanguage.getMessage('ERR_QUERY_EXISTS_ARTICLE');errMsg=errMsg.replace(/\$-page/g,pageName);alert(errMag);return;}callback(pageName,parts[1]=='true'?true:false,title,optparam,domElementID);};sajax_do_call('smwfExistsArticle',[pageName],ajaxResponseExistsArticle.bind(this));},createArticle:function(title,content,optionalText,creationComment,redirect){this.redirect=redirect;sajax_do_call('smwfCreateArticle',[title,content,optionalText,creationComment],this.ajaxResponseCreateArticle.bind(this));},createAttribute:function(title,initialContent,domain,type){var schema="";if(domain!=null&&domain!=""){schema+="\n[[SMW_SSP_HAS_DOMAIN_HINT::"+gLanguage.getMessage('CATEGORY')+domain+"]]";}if(type!=null&&type!=""){schema+="\n[[SMW_SP_HAS_TYPE::"+gLanguage.getMessage('TYPE')+type+"]]";}this.createArticle(gLanguage.getMessage('PROPERTY')+title,initialContent,schema,"Create a property for category "+domain,true);},createRelation:function(title,initialContent,domain,ranges){var schema="";if(domain!=null&&domain!=""){schema+="\n[[SMW_SSP_HAS_DOMAIN_HINT::"+gLanguage.getMessage('CATEGORY')+domain+"]]";}if(ranges!=null){if(ranges.length==1){if(ranges[0].indexOf(gLanguage.getMessage('TYPE'))==0){schema+="\n[[SMW_SP_HAS_TYPE::"+ranges[0]+"]]";}else{schema+="\n[[SMW_SSP_HAS_RANGE_HINT::"+ranges[0]+"]]";}}else if(ranges.length>1){var rangeStr="\n[[SMW_SP_HAS_TYPE:=";for(var i=0,n=ranges.length;i<n;i++){if(ranges[i].indexOf(gLanguage.getMessage('TYPE'))==0){if(i<n-1)rangeStr+=ranges[i]+";";else rangeStr+=ranges[i];}else{if(i<n-1){rangeStr+=gLanguage.getMessage('TYPE_PAGE')+";";}else{rangeStr+=gLanguage.getMessage('TYPE_PAGE');}schema+="\n[[SMW_SSP_HAS_RANGE_HINT::"+ranges[i]+"]]";}}schema+=rangeStr+"]]";}}this.createArticle(gLanguage.getMessage('PROPERTY')+title,initialContent,schema,gLanguage.getMessage('CREATE_PROP_FOR_CAT').replace(/\$cat/g,domain),true);},createCategory:function(title,initialContent){this.createArticle(gLanguage.getMessage('CATEGORY')+title,initialContent,"",gLanguage.getMessage('CREATE_CATEGORY'),true);},createSubProperty:function(title,initialContent,openNewArticle){if(openNewArticle==undefined){openNewArticle=true;}var schemaProp=this.getSchemaProperties();if(wgNamespaceNumber==102||wgNamespaceNumber==100){this.createArticle(gLanguage.getMessage('PROPERTY')+title,initialContent,schemaProp+"\n[[SMW_SP_SUBPROPERTY_OF::"+wgPageName+"]]",gLanguage.getMessage('CREATE_SUB_PROPERTY'),openNewArticle);}else{alert(gLanguage.getMessage('NOT_A_PROPERTY'))}},createSuperProperty:function(title,initialContent,openNewArticle){if(openNewArticle==undefined){openNewArticle=true;}var schemaProp=this.getSchemaProperties();var wtp=new WikiTextParser();if(wgNamespaceNumber==102||wgNamespaceNumber==100){this.createArticle(gLanguage.getMessage('PROPERTY')+title,initialContent,schemaProp,gLanguage.getMessage('CREATE_SUPER_PROPERTY'),openNewArticle);wtp.addRelation("subproperty of",gLanguage.getMessage('PROPERTY')+title,"",true);}else{alert(gLanguage.getMessage('NOT_A_PROPERTY'));}},createSuperCategory:function(title,initialContent,openNewArticle){if(openNewArticle==undefined){openNewArticle=true;}var wtp=new WikiTextParser();if(wgNamespaceNumber==14){this.createArticle(gLanguage.getMessage('CATEGORY')+title,initialContent,"",gLanguage.getMessage('CREATE_SUPER_CATEGORY'),openNewArticle);wtp.addCategory(title,"",true);}else{alert(gLanguage.getMessage('NOT_A_CATEGORY'))}},createSubCategory:function(title,initialContent){if(wgNamespaceNumber==14){this.createArticle(gLanguage.getMessage('CATEGORY')+title,initialContent,"[["+gLanguage.getMessage('CATEGORY')+wgTitle+"]]",gLanguage.getMessage('CREATE_SUB_CATEGORY'),true);}else{alert(gLanguage.getMessage('NOT_A_CATEGORY'))}},getSchemaProperties:function(){var wtp=new WikiTextParser();var props=new Array();props.push(wtp.getRelation("has type"));props.push(wtp.getRelation("Has domain hint"));props.push(wtp.getRelation("Has range hint"));props.push(wtp.getRelation("Has max cardinality"));props.push(wtp.getRelation("Has min cardinality"));var schemaAnnotations="";for(var typeIdx=0,nt=props.length;typeIdx<nt;++typeIdx){var type=props[typeIdx];if(type!=null){for(var annoIdx=0,na=type.length;annoIdx<na;++annoIdx){var anno=type[annoIdx];schemaAnnotations+=anno.getAnnotation()+"\n";}}}var transitive=wtp.getCategory("Transitive relations");var symmetric=wtp.getCategory("Symmetrical relations");if(transitive){schemaAnnotations+=transitive.getAnnotation()+"\n";}if(symmetric){schemaAnnotations+=symmetric.getAnnotation()+"\n";}return schemaAnnotations;},ajaxResponseCreateArticle:function(request){if(request.status!=200){alert(gLanguage.getMessage('ERROR_CREATING_ARTICLE'));return;}var answer=request.responseText;var regex=/(true|false),(true|false),(.*)/;var parts=answer.match(regex);if(parts==null){alert(gLanguage.getMessage('ERROR_CREATING_ARTICLE'));return;}var success=parts[1];var created=parts[2];var title=parts[3];if(success=="true"){if(this.redirect){window.open("index.php?title="+title,"_blank");}}}} 

// SMW_DataTypes.js
var DataTypes=Class.create();DataTypes.prototype={initialize:function(){this.builtinTypes=null;this.userTypes=null;this.callback=new Array();this.refresh();this.refreshPending=false;},getBuiltinTypes:function(){return this.builtinTypes;},getUserDefinedTypes:function(){return this.userTypes;},refresh:function(callback){if(callback){this.callback.push(callback);}this.userUpdated=false;this.builtinUpdated=false;if(!this.refreshPending){this.refreshPending=true;sajax_do_call('smwfGetUserDatatypes',[],this.ajaxResponseGetDatatypes.bind(this));sajax_do_call('smwfGetBuiltinDatatypes',[],this.ajaxResponseGetDatatypes.bind(this));}},ajaxResponseGetDatatypes:function(request){if(request.status!=200){return;}var types=request.responseText.split(",");if(types[0].indexOf("User defined types")>=0){this.userUpdated=true;this.userTypes=new Array(types.length-1);for(var i=1,len=types.length;i<len;++i){this.userTypes[i-1]=types[i];}}else{this.builtinUpdated=true;this.builtinTypes=new Array(types.length-1);for(var i=1,len=types.length;i<len;++i){this.builtinTypes[i-1]=types[i];}}if(this.userUpdated&&this.builtinUpdated){var userTypes=new Array();for(var u=0;u<this.userTypes.length;u++){var found=false;for(var b=0;b<this.builtinTypes.length;b++){if(this.userTypes[u]==this.builtinTypes[b]){found=true;break;}}if(!found){userTypes.push(this.userTypes[u]);}}this.userTypes=userTypes;for(var i=0;i<this.callback.length;++i){this.callback[i]();}this.callback.clear();this.refreshPending=false;}}};var gDataTypes=new DataTypes(); 

// SMW_GenericToolbarFunctions.js
var GenericToolBar=Class.create();GenericToolBar.prototype={initialize:function(){},createList:function(list,id){var len=list==null?0:list.length;var divlist="";switch(id){case "category":divlist="<div id=\""+id+"-tools\">"+"<a href=\"javascript:catToolBar.newItem()\" class=\"menulink\">"+gLanguage.getMessage('ANNOTATE')+"</a>"+"<a href=\"javascript:catToolBar.newCategory()\" class=\"menulink\">"+gLanguage.getMessage('CREATE')+"</a>";if(wgNamespaceNumber==14){divlist+="<a href=\"javascript:catToolBar.CreateSubSup()\" class=\"menulink\">"+gLanguage.getMessage('SUB_SUPER')+"</a>";}divlist+="</div>";break;case "relation":divlist="<div id=\""+id+"-tools\">"+"<a href=\"javascript:relToolBar.newItem()\" class=\"menulink\">"+gLanguage.getMessage('ANNOTATE')+"</a>"+"<a href=\"javascript:relToolBar.newRelation()\" class=\"menulink\">"+gLanguage.getMessage('CREATE')+"</a>";var attrregex=new RegExp("Attribute:.*");if(wgNamespaceNumber==100||wgNamespaceNumber==102||attrregex.exec(wgPageName)!=null){divlist+="<a href=\"javascript:relToolBar.CreateSubSup()\" class=\"menulink\">"+gLanguage.getMessage('SUB_SUPER')+"</a>";}divlist+="<a href=\"javascript:relToolBar.newPart()\" class=\"menulink\">"+gLanguage.getMessage('MHAS_PART')+"</a>";divlist+="</div>";break;}divlist+="<div id=\""+id+"-itemlist\"><table id=\""+id+"-table\">";var path=wgArticlePath;var dollarPos=path.indexOf('$1');if(dollarPos>0){path=path.substring(0,dollarPos);}for(var i=0;i<len;i++){var rowSpan="";var firstValue="";var multiValue="";var value="";var prefix="";switch(id){case "category":fn="catToolBar.getselectedItem("+i+")";firstValue=list[i].getValue?this.cutdowntosize(list[i].getValue(),7,3):"";prefix=gLanguage.getMessage('CATEGORY');break;case "relation":fn="relToolBar.getselectedItem("+i+")";prefix=gLanguage.getMessage('PROPERTY');var rowSpan='rowspan="'+(list[i].getArity()-1)+'"';var values=list[i].getSplitValues();firstValue=this.cutdowntosize(values[0],7,3);var valueLink;for(var j=1,n=list[i].getArity()-1;j<n;j++){valueLink=this.cutdowntosize(values[j],8,3);multiValue+="<tr>"+"<td class=\""+id+"-col2\">"+valueLink+" </td>"+"</tr>";}break}var shortName=(list[i].getValue?this.cutdowntosize(list[i].getName(),7):this.cutdowntosize(list[i].getName(),16));var elemName;elemName='<a href="'+wgServer+path+prefix+list[i].getName();elemName+='" target="blank">'+shortName+'</a>';divlist+="<tr>"+"<td "+rowSpan+" class=\""+id+"-col1\">"+elemName+" </td>"+"<td class=\""+id+"-col2\">"+firstValue+" </td>"+"<td "+rowSpan+" class=\""+id+"-col3\">"+'<a href=\"javascript:'+fn+'">'+'<img src="'+wgScriptPath+'/extensions/SMWHalo/skins/edit.gif"/></a>'+'</tr>'+multiValue;}divlist+="</table></div>";return divlist;},cutdowntosize:function(word,size){var result;var subparts=new Array();var from;var to;arguments.length==3?maxrows=arguments[2]:maxrows=0;var partscount=parseInt(word.length/size);if((word.length%size)!=0){partscount++;}for(var part=0;part<partscount;part++){from=((part)*size);to=(((part)*size)+(size));if(to>word.length){to=word.length;};if(maxrows!=0&&maxrows==part+1){if((to-from)<size-3){subparts[part]=word.substring(from,to)+"...";}else{subparts[part]=word.substring(from,from+size-3)+"...";}break;}else{subparts[part]=word.substring(from,to);}}result=subparts[0].replace(/\s/g,'&nbsp;');;for(var part=1;part<subparts.length;part++){result+="<br>"+subparts[part].replace(/\s/g,'&nbsp;');}return(result?result:"");},triggerEvent:function(element){if(element){element.focus();element.blur();element.focus();}}};var EventManager=Class.create();EventManager.prototype={initialize:function(){this.eventlist=new Array();},registerEvent:function(element,eventName,handler){var event=new Array(element,eventName,handler);this.eventlist.push(event);Event.observe(element,eventName,handler);},deregisterAllEvents:function(){this.eventlist.each(this.stopEvent);this.eventlist=new Array();},stopEvent:function(item){if(item==null){return;}var obj=$(item[0]);if(!obj){return;}Event.stopObserving(item[0],item[1],item[2])},deregisterEventsFromItem:function(itemID){for(var i=0;i<this.eventlist.length;i++){if(this.eventlist[i]!=null&&this.eventlist[i][0]==itemID){this.stopEvent(this.eventlist[i]);this.eventlist[i]=null;}}}};var EventActions=Class.create();EventActions.prototype={initialize:function(){},eventActions:function(){this.istyping=false;this.registered=false},setIsTyping:function(bool){this.istyping=bool;},getIsTyping:function(){return this.istyping;},isEmpty:function(element){if(element.getValue().strip()!=''&&element.getValue()!=null){return false;}else{return true;}},targetelement:function(event){return(event.srcElement?event.srcElement:(event.target?event.target:event.currentTarget));},timedcallback:function(fnc){if(!this.registered){this.registered=true;var cb=this.callback.bind(this,fnc);setTimeout(cb,500);}},callback:function(fnc){if(this.istyping){this.istyping=false;var cb=this.callback.bind(this,fnc);setTimeout(cb,500);}else{fnc();this.registered=false;this.istyping=false;}}};var STBEventActions=Class.create();STBEventActions.prototype=Object.extend(new EventActions(),{initialize:function(){this.om=new OntologyModifier();this.keyUpEvent=null;this.pendingIndicator=null;},onKeyUp:function(event){this.setIsTyping(true);var key=event.which||event.keyCode;if(key==Event.KEY_RETURN){var elem=$(event.target);if(elem.type=='a'){return true;}var tabIndex=elem.getAttribute("tabIndex");if(!tabIndex){return false;}tabIndex=tabIndex*1+1;var div=elem.up('div');var children=div.descendants();for(var i=0;i<children.length;++i){var child=children[i];var ti=child.getAttribute("tabIndex");if(ti&&ti*1==tabIndex){if(child.disabled==true|| !child.visible()){tabIndex++;}else{child.focus();break;}}}return false;}this.keyUpEvent=event;this.timedcallback(this.delayedKeyUp.bind(this));},onBlur:function(event){var target=$(event.target);var oldValue=target.getAttribute("smwOldValue");if(oldValue&&oldValue==target.value){return;}target.setAttribute("smwOldValue",target.value);if(this.checkIfEmpty(target)==false){this.handleCheck(target);}this.doFinalCheck(target);},onClick:function(event){var target=$(event.target);if(target.type=='radio'){this.doFinalCheck(target);}},onChange:function(event){var target=$(event.target);if(this.checkIfEmpty(target)==false){this.handleCheck(target);}this.handleChange(target);this.doFinalCheck(target);},initialCheck:function(target){var children=target.descendants();var elem;for(var i=0,len=children.length;i<len;++i){elem=children[i];var oldValue=elem.getAttribute("smwOldValue");if(!oldValue||oldValue!=elem.value){if(this.checkIfEmpty(elem)==false){this.handleCheck(elem);}elem.setAttribute("smwOldValue",elem.value);}}this.doFinalCheck(elem);},delayedKeyUp:function(){var target=$(this.keyUpEvent.target);var oldValue=target.getAttribute("smwOldValue");if(oldValue&&oldValue==target.value){return;}target.setAttribute("smwOldValue",target.value);if(this.checkIfEmpty(target)==false){this.handleCheck(target);}this.doFinalCheck(target);},checkIfEmpty:function(target){var value=target.value;if(target.type=='select-one'){value=target.options[target.selectedIndex].text;}var empty=value=="";var cie=target.getAttribute("smwCheckEmpty");if(!cie){return empty;}var actions=this.parseConditional("empty",cie);if(actions){this.performActions(empty?actions[0]:actions[1],target);}return empty;},handleCheck:function(target){var check=target.getAttribute("smwCheckType");if(!check){return;}var type=check;var actions="";var pos=check.indexOf(":");if(pos!= -1){type=check.substring(0,pos);actions=check.substring(pos+1);}type=type.toLowerCase();if(type.indexOf("regex")==0){var regexStr=check.match(/regex\s*=\s*(.*?):\s*valid\s*\?/);if(regexStr){var regex=new RegExp(regexStr[1]);pos=check.search(/:\s*valid\s*\?/);actions=check.substring(pos+1);this.checkWithRegEx(target.value,regex,actions,target);}}else{switch(type){case 'integer':this.checkWithRegEx(target.value,/^\d+$/,actions,target);break;case 'float':this.checkWithRegEx(target.value,/^[+-]?\d+(\.\d+)?([Ee][+-]?\d+)?$/,actions,target);break;case 'category':case 'property':this.handleSchemaCheck(type,check,target);break;}}},handleChange:function(target){var changeActions=target.getAttribute("smwChanged");if(!changeActions){return;}changeActions=changeActions.match(/\s*\((.*?)\)\s*$/);if(changeActions){this.performActions(changeActions[1],target);}},doFinalCheck:function(target){var parentDiv=target.up('div');if(!parentDiv){return;}var allValidCndtl=parentDiv.getAttribute("smwAllValid");if(allValidCndtl){var children=parentDiv.descendants();var allValid=true;for(var i=0,len=children.length;i<len;++i){var elem=children[i];var valid=elem.getAttribute("smwValid");if(valid){if(valid=="false"){allValid=false;break;}else if(valid!="true"){valid=eval(valid+'("'+elem.id+'")');if(!valid){allValid=false;break;}}}}var c=this.parseConditional("allValid",allValidCndtl);this.performActions(allValid?c[0]:c[1],parentDiv);}},checkWithRegEx:function(value,regex,conditional,target){var valid=value.match(regex);var c=this.parseConditional("valid",conditional);this.performActions(valid?c[0]:c[1],target);},handleSchemaCheck:function(type,check,target){var value=target.value;var checkName;switch(type){case 'category':checkName=gLanguage.getMessage('CATEGORY')+value;break;case 'property':checkName=gLanguage.getMessage('PROPERTY')+value;break;}if(checkName){this.showPendingIndicator(target);this.om.existsArticle(checkName,this.ajaxCbSchemaCheck.bind(this),value,[type,check],target.id);}},ajaxCbSchemaCheck:function(pageName,exists,title,param,elementID){this.hidePendingIndicator();var check=param[1];var pos=check.indexOf(":");if(pos!= -1){var conditional=check.substring(pos+1);var actions=this.parseConditional("exists",conditional);if(actions){this.performActions(exists?actions[0]:actions[1],$(elementID))}}this.doFinalCheck($(elementID));},parseConditional:function(name,conditional){var regex=new RegExp("\\s*"+name+"\\s*\\?\\s*\\(([^)]*)\\)\\s*:\\s*\\(([^)]*)\\)");var parts=conditional.match(regex);if(parts){return[parts[1],parts[2]];}return null;},performActions:function(actions,element){var allActions=actions.split(",");for(var i=0,len=allActions.length;i<len;i++){var actionAndParam=allActions[i].split(":");var act="";var param="";if(actionAndParam.length>0){act=actionAndParam[0].match(/^\s*(.*?)\s*$/);if(act){act=act[1];}}if(actionAndParam.length>1){param=actionAndParam[1].match(/^\s*(.*?)\s*$/);if(param){param=param[1];}}this.performSingleAction(act.toLowerCase(),param,element);}},performSingleAction:function(action,parameter,element){switch(action){case 'color':element.setStyle({background:parameter});break;case 'show':var tbc=smw_ctbHandler.findContainer(parameter);tbc.show(parameter,true);break;case 'hide':var tbc=smw_ctbHandler.findContainer(parameter);tbc.show(parameter,false);break;case 'call':eval(parameter+'("'+element.id+'")');break;case 'showmessage':var msgElem=$(element.id+'-msg');if(msgElem){var msg=gLanguage.getMessage(parameter);var value=element.value;msg=msg.replace(/\$c/g,value);var tbc=smw_ctbHandler.findContainer(msgElem);tbc.replace(msgElem.id,tbc.createText(msgElem.id,msg,'',true));tbc.show(msgElem.id,true);}break;case 'hidemessage':var msgElem=$(element.id+'-msg');if(msgElem){var tbc=smw_ctbHandler.findContainer(msgElem.id);tbc.show(msgElem.id,false);}break;case 'valid':element.setAttribute("smwValid",parameter);break;case 'attribute':var attrValue=parameter.split("=");if(attrValue&&attrValue.length==2){element.setAttribute(attrValue[0],attrValue[1]);}break;}},showPendingIndicator:function(onElement){this.hidePendingIndicator();this.pendingIndicator=new OBPendingIndicator($(onElement));this.pendingIndicator.show();},hidePendingIndicator:function(){if(this.pendingIndicator!=null){this.pendingIndicator.hide();this.pendingIndicator=null;}}});var gSTBEventActions=new STBEventActions();

// SMW_Container.js
var ContainerToolBar=Class.create();ContainerToolBar.prototype={initialize:function(id,tabindex,frameworkcontainer){this.id=id;this.startindex=tabindex;this.lastindex=tabindex;this.cointainerlist=new Array();this.frameworkcontainer=frameworkcontainer;this.sandglass=new OBPendingIndicator();this.eventManager=new EventManager();if(smw_ctbHandler){smw_ctbHandler.addContainer(this.id,this);}},showSandglass:function(element){this.sandglass.hide();this.sandglass.show(element);},hideSandglass:function(){this.sandglass.hide();},createContainerBody:function(attributes){var header='<div id="'+this.id+'-box" '+attributes+'>';var footer='</div>';this.frameworkcontainer.setContent(header+footer);this.frameworkcontainer.contentChanged();},createInput:function(id,description,initialContent,deleteCallback,attributes,visibility){var containercontent='<table class="stb-table stb-input-table '+this.id+'-table '+this.id+'-input-table"'+(visibility?'':'style="display:none;"')+'id="'+this.id+'-table-'+id+'">'+'<tr>'+'<td class="stb-input-col1 '+this.id+'-input-col1">'+description+'</td>'+'<td class="stb-input-col2 '+this.id+'-input-col2">';if(deleteCallback){containercontent+='<input class="wickEnabled stb-delinput '+this.id+'-delinput" '+'id="'+id+'" '+attributes+' type="text" '+' alignfloater="right" '+'value="'+initialContent+'" '+'tabindex="'+this.lastindex++ +'" />'+'<a href="javascript:'+deleteCallback+'">'+'<img src="'+wgScriptPath+'/extensions/SMWHalo/skins/redcross.gif"/>';}else{containercontent+='<input class="wickEnabled stb-input '+this.id+'-input" '+'id="'+id+'" '+attributes+' type="text" '+' alignfloater="right" '+'value="'+initialContent+'" '+'tabindex="'+this.lastindex++ +'" />';}containercontent+='</td>'+'</tr>'+'</table>';return containercontent;},createDropDown:function(id,description,options,deleteCallback,selecteditem,attributes,visibility){var containercontent='<table class="stb-table stb-select-table '+this.id+'-table '+this.id+'-select-table"'+(visibility?'':'style="display:none;"')+'id="'+this.id+'-table-'+id+'">'+'<tr>'+'<td class="stb-select-col1 '+this.id+'-select-col1">'+description+'</td>'+'<td class="stb-select-col2 '+this.id+'-select-col2">';if(deleteCallback){containercontent+='<select class="stb-delselect '+this.id+'-delselect" id="'+id+'"  '+attributes+' tabindex="'+this.lastindex++ +'">';}else{containercontent+='<select class="stb-select '+this.id+'-select" id="'+id+'"  '+attributes+' tabindex="'+this.lastindex++ +'">';}for(var i=0;i<options.length;i++){if(i!=selecteditem){containercontent+='<option>'+options[i]+'</option>'}else{containercontent+='<option selected="selected">'+options[i]+'</option>'}}containercontent+='</select>';if(deleteCallback){containercontent+='<a href="javascript:'+deleteCallback+'"><img src="'+wgScriptPath+'/extensions/SMWHalo/skins/redcross.gif"/>';}containercontent+='</td>'+'</tr>'+'</table>';return containercontent;},createRadio:function(id,description,options,selecteditem,attributes,visibility){var containercontent='<table class="stb-table stb-radio-table '+this.id+'-table '+this.id+'-radio-table"'+(visibility?'':'style="display:none;"')+'id="'+this.id+'-table-'+id+'">'+'<tr>'+'<td class="stb-radio-col1 '+this.id+'-input-radio1">'+description+'</td>'+'</tr><tr>'+'<td class="stb-radio-col2 '+this.id+'-radio-col2">'+'<form class="stb-radio '+this.id+'-radio" id="'+id+'"  '+attributes+' tabindex="'+this.lastindex++ +'">';for(var i=0;i<options.length;i++){if(i!=selecteditem){containercontent+='<input type="radio" name="'+id+'" value="'+options[i]+'">'+options[i]+'<br>'}else{containercontent+='<input type="radio" name="'+id+'" value="'+options[i]+'" checked="checked">'+options[i]+'</br>'}}containercontent+='</form>'+'</td>'+'</tr>'+'</table>';return containercontent;},createCheckBox:function(id,description,options,selecteditems,attributes,visibility){var containercontent='<table class="stb-table stb-checkbox-table '+this.id+'-table '+this.id+'-checkbox-table"'+(visibility?'':'style="display:none;"')+'id="'+this.id+'-table-'+id+'">'+'<tr>'+'<td class="stb-checkbox-col1 '+this.id+'-checkbox-col1">'+description+'</td>'+'</tr><tr>'+'<td class="stb-checkbox-col2 '+this.id+'-checkbox-col2">'+'<form class="stb-checkbox '+this.id+'-checkbox" id="'+id+'"  '+attributes+'">';for(var i=0;i<options.length;i++){if(!this.isInArray(i,selecteditems)){containercontent+='<input type="checkbox" '+'name="'+id+'"'+' tabindex="'+this.lastindex++ +'"'+' value="'+options[i]+'">'+options[i]+'<br>'}else{containercontent+='<input type="checkbox" '+'name="'+id+'"'+' tabindex="'+this.lastindex++ +'" '+' value="'+options[i]+'" checked="checked">'+options[i]+'<br>'}}containercontent+='</form>'+'</td>'+'</tr>'+'</table>';return containercontent;},isInArray:function(item,array){for(var j=0;j<array.length;j++){if(item==array[j])return true;}return false;},createText:function(id,description,attributes,visibility){var imgtag='';var imgregex=/(\([iwe]\))(.*)/;var regexresult;if(regexresult=imgregex.exec(description)){switch(regexresult[1]){case(image='(i)'):imgtag='<img src="'+wgScriptPath+'/extensions/SMWHalo/skins/info.gif"/>';break;case(image='(w)'):imgtag='<img src="'+wgScriptPath+'/extensions/SMWHalo/skins/warning.png"/>';break;case(image='(e)'):imgtag='<img src="'+wgScriptPath+'/extensions/SMWHalo/skins/delete_icon.png"/>';break;default:imgtag='';}description=regexresult[2];}var containercontent='<table class="stb-table stb-text-table '+this.id+'-table '+this.id+'-text-table"'+(visibility?'':'style="display:none;"')+'id="'+this.id+'-table-'+id+'">'+'<tr>'+'<td class="stb-text-col1 '+this.id+'-text-col1">'+imgtag+'&#32<span class="stb-text '+this.id+'-radio" id="'+id+'" id="'+id+'" '+attributes+'>'+description+'</span>'+'</td>'+'</tr>'+'</table>';return containercontent;},createLink:function(id,functions,attributes,visibility){var containercontent='<table class="stb-table stb-link-table '+this.id+'-table '+this.id+'-link-table"'+(visibility?'':'style="display:none;"')+'id="'+this.id+'-table-'+id+'">';switch(functions.length){case 1:var tablelayout=1;break;case 2:var tablelayout=2;break;case 4:var tablelayout=2;break;default:var tablelayout=3;}var i=0;for(var row=0;row*tablelayout<functions.length;row++){containercontent+='<tr class=" ln-tr-'+tablelayout+' '+this.id+'-ln-tr-'+tablelayout+' '+id+'-ln-tr-'+tablelayout+'">';for(var column=0;column<tablelayout;column++){containercontent+='<td class=" ln-td-'+tablelayout+'-'+column+' '+this.id+'-ln-td-'+tablelayout+'-'+column+' '+id+'-ln-td-'+tablelayout+'-'+column+'">';if(i<functions.length){switch(functions[i].length){case 2:containercontent+='<a tabindex="'+this.lastindex++ +'" + href="javascript:'+functions[i][0]+'">'+functions[i][1]+'&#32</a>';break;case 3:containercontent+='<a tabindex="'+this.lastindex++ +'" + id="'+functions[i][2]+'" href="javascript:'+functions[i][0]+'">'+functions[i][1]+'&#32</a>';break;case 5:containercontent+='<a tabindex="'+this.lastindex++ +'" + id="'+functions[i][2]+'" href="javascript:'+functions[i][0]+'">'+functions[i][1]+'&#32</a>';containercontent+='<span id="'+functions[i][4]+'" style="display: none;">'+functions[i][3]+'</span>';break;default:}i++;}containercontent+='</td>';}containercontent+='</tr>';}containercontent+='</table>';return containercontent;},changeID:function(obj,newID){var oldID=obj.id;var table=$(this.id+'-table-'+oldID);if(table){table.id=this.id+'-table-'+newID;}obj.id=newID;},remove:function(element){if(element instanceof Array){for(var i=0;i<element.length;i++){$(this.id+'-table-'+element[i]).remove();this.eventManager.deregisterEventsFromItem(element[i]);}}else{$(this.id+'-table-'+element).remove();this.eventManager.deregisterEventsFromItem(element);}this.rebuildTabindex($(this.id+'-box'));autoCompleter.deregisterAllInputs();autoCompleter.registerAllInputs();},rebuildTabindex:function(rootnode){if(rootnode==null)return;this.lastindex=this.startindex;var elements=rootnode.descendants();elements.each(this.updateTabindex.bind(this));},updateTabindex:function(element){if(element.readAttribute('tabindex')!=null&&element.readAttribute('tabindex')!=0){element.writeAttribute('tabindex',this.lastindex++);}},append:function(content){if(content instanceof Array){for(var i=0;i<content.length;i++){new Insertion.Bottom($(this.id+'-box'),content[i]);}}else{new Insertion.Bottom($(this.id+'-box'),content);}},insert:function(id,content){if(content instanceof Array){for(var i=0;i<content.length;i++){new Insertion.After($(this.id+'-table-'+id),content[i]);}}else{new Insertion.After($(this.id+'-table-'+id),content);}},replace:function(id,content){$(this.id+'-table-'+id).replace(content);},show:function(id,visibility){var obj=$(this.id+'-table-'+id);if(!obj){obj=$(id);}if(obj){if(visibility){obj.show();}else{obj.hide();}}},finishCreation:function(){this.eventManager.deregisterAllEvents();var desc=$(this.id+'-box').descendants();for(var i=0,len=desc.length;i<len;i++){var elem=desc[i];if(elem.type=='text'){this.eventManager.registerEvent(elem,'blur',gSTBEventActions.onBlur.bindAsEventListener(gSTBEventActions));this.eventManager.registerEvent(elem,'keyup',gSTBEventActions.onKeyUp.bindAsEventListener(gSTBEventActions));}else if(elem.type=='radio'){this.eventManager.registerEvent(elem,'click',gSTBEventActions.onClick.bindAsEventListener(gSTBEventActions));this.eventManager.registerEvent(elem,'keyup',gSTBEventActions.onKeyUp.bindAsEventListener(gSTBEventActions));}else if(elem.type=='select-one'){this.eventManager.registerEvent(elem,'change',gSTBEventActions.onChange.bindAsEventListener(gSTBEventActions));this.eventManager.registerEvent(elem,'keyup',gSTBEventActions.onKeyUp.bindAsEventListener(gSTBEventActions));}else if(elem.type=='checkbox'){this.eventManager.registerEvent(elem,'keyup',gSTBEventActions.onKeyUp.bindAsEventListener(gSTBEventActions));}}autoCompleter.deregisterAllInputs();autoCompleter.registerAllInputs();this.frameworkcontainer.contentChanged();this.rebuildTabindex($(this.id+'-box'));},release:function(){this.eventManager.deregisterAllEvents();autoCompleter.deregisterAllInputs();autoCompleter.registerAllInputs();},foo:function(){this.createContainerBody('');this.showSandglass($(this.id+'-box'));this.append(this.createInput(700,'Test','','alert(\'loeschmich\')','',true));this.append(this.createText(701,'Test','',true));this.append(this.createDropDown(702,'Test',['Opt1','Opt2','Opt3'],'alert(\'loeschmich\')',2,'',true));this.insert('702',this.createRadio(703,'Test',['val1','val2','val3'],2,'',true));this.append(this.createCheckBox(704,'Test',['val1','val2','val3','val4'],[1,3],'',true));this.append(this.createLink(705,[['logger.log(\'Testlog\',\'error\',\'log\');','Log']],'',true));this.append(this.createLink(706,[['alert(\'f1\')','function1'],['alert(\'f2\')','function2','fid2']],'',true));this.append(this.createLink(707,[['alert(\'f1\')','function1'],['alert(\'f2\')','function2','fid2'],['alert(\'f3\')','function3','fid3','alt-f3','faltid3']],'',true));this.append(this.createLink(708,[['alert(\'f1\')','function1'],['alert(\'f2\')','function2','fid2'],['alert(\'f3\')','function3','fid3','alt-f3','faltid3'],['alert(\'f4\')','function4']],'',true));this.append(this.createLink(709,[['alert(\'f1\')','function1'],['alert(\'f2\')','function2','fid2'],['alert(\'f3\')','function3','fid3','alt-f3','faltid3'],['alert(\'f4\')','function5'],['alert(\'f5\')','function5']],'',true));this.rebuildTabindex($(this.id+'-box'));this.hideSandglass();this.showSandglass($(this.id+'-box'));ctbHandler=new CTBHandler();ctbHandler.addContainer('category',this);var obj=smw_ctbHandler.findContainer('703');obj.replace('701',obj.createText(701,'(e) Testreplace','',true));this.hideSandglass();}};var CTBHandler=Class.create();CTBHandler.prototype={initialize:function(){this.containerlist=new Array();},addContainer:function(containerid,containerobj){var pos=this.posInArray(containerid);if(pos<0){this.containerlist.push([containerid,containerobj])}else{this.containerlist[pos]=[containerid,containerobj];}},posInArray:function(containerid){for(var j=0;j<this.containerlist.length;j++){if(containerid==this.containerlist[j][0])return j;}return-1;},findContainer:function(elementid){var ancestorlist=$(elementid).ancestors();for(var j=0;j<ancestorlist.length;j++){var elementid=ancestorlist[j].readAttribute('id');var regexsearch=/(.*)-box/g;var regexresult;if(regexresult=regexsearch.exec(elementid)){var pos=this.posInArray(regexresult[1]);if(pos>=0)return this.containerlist[pos][1];}}return false;}};var smw_ctbHandler=new CTBHandler();

// SMW_Category.js
var SMW_CAT_CHECK_CATEGORY='smwCheckType="category: exists '+'? (color: lightgreen, hideMessage, valid:true) '+': (color: orange, showMessage:CATEGORY_DOES_NOT_EXIST, valid:true)" ';var SMW_CAT_CHECK_CATEGORY_IIE='smwCheckType="category:exists '+'? (color: red, showMessage:CATEGORY_ALREADY_EXISTS, valid:false) '+': (color: lightgreen, hideMessage, valid:true)" ';var SMW_CAT_CHECK_EMPTY='smwCheckEmpty="empty'+'? (color:red, showMessage:MUST_NOT_BE_EMPTY, valid:false) '+': (color:white, hideMessage)"';var SMW_CAT_ALL_VALID='smwAllValid="allValid '+'? (show:cat-confirm, hide:cat-invalid) '+': (show:cat-invalid, hide:cat-confirm)"';var SMW_CAT_HINT_CATEGORY='typeHint = "14" ';var SMW_CAT_SUB_SUPER_CHECK_CATEGORY='smwCheckType="category: exists '+'? (color: lightgreen, hideMessage, valid:true, attribute:catExists=true) '+': (color: orange, hideMessage, valid:true, attribute:catExists=false)" ';var SMW_CAT_SUB_SUPER_ALL_VALID='smwAllValid="allValid '+'? (call:catToolBar.createSubSuperLinks) '+': (call:catToolBar.createSubSuperLinks)"';var CategoryToolBar=Class.create();CategoryToolBar.prototype={initialize:function(){this.genTB=new GenericToolBar();this.toolbarContainer=null;this.showList=true;},showToolbar:function(request){this.categorycontainer.setHeadline(gLanguage.getMessage('CATEGORIES'));this.wtp=new WikiTextParser();this.om=new OntologyModifier();this.fillList(true);},callme:function(event){if(wgAction=="edit"&&stb_control.isToolbarAvailable()){this.categorycontainer=stb_control.createDivContainer(CATEGORYCONTAINER,0);this.showToolbar();}},fillList:function(forceShowList){if(forceShowList==true){this.showList=true;}if(!this.showList){return;}this.wtp.initialize();this.categorycontainer.setContent(this.genTB.createList(this.wtp.getCategories(),"category"));this.categorycontainer.contentChanged();},cancel:function(){this.toolbarContainer.hideSandglass();this.fillList(true);},createToolbar:function(attributes){if(this.toolbarContainer){this.toolbarContainer.release();}this.toolbarContainer=new ContainerToolBar('category-content',600,this.categorycontainer);var tb=this.toolbarContainer;tb.createContainerBody(attributes);return tb;},addItem:function(){this.wtp.initialize();var name=$("cat-name").value;this.wtp.addCategory(name,true);this.fillList(true);},newItem:function(){var html;this.showList=false;this.wtp.initialize();var selection=this.wtp.getSelection();var tb=this.createToolbar(SMW_CAT_ALL_VALID);tb.append(tb.createText('cat-help-msg',gLanguage.getMessage('ANNOTATE_CATEGORY'),'',true));tb.append(tb.createInput('cat-name',gLanguage.getMessage('NAME'),'','',SMW_CAT_CHECK_CATEGORY+SMW_CAT_CHECK_EMPTY+SMW_CAT_HINT_CATEGORY,true));tb.append(tb.createText('cat-name-msg',gLanguage.getMessage('ENTER_NAME'),'',true));var links=[['catToolBar.addItem()',gLanguage.getMessage('ADD'),'cat-confirm',gLanguage.getMessage('INVALID_VALUES'),'cat-invalid'],['catToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('cat-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("category-content-box"));setTimeout("$('cat-name').focus();",50);},CreateSubSup:function(){var html;this.showList=false;var tb=this.createToolbar(SMW_CAT_SUB_SUPER_ALL_VALID);tb.append(tb.createText('cat-help-msg',gLanguage.getMessage('DEFINE_SUB_SUPER_CAT'),'',true));tb.append(tb.createInput('cat-subsuper',gLanguage.getMessage('NAME'),'','',SMW_CAT_SUB_SUPER_CHECK_CATEGORY+SMW_CAT_CHECK_EMPTY+SMW_CAT_HINT_CATEGORY,true));tb.append(tb.createText('cat-subsuper-msg',gLanguage.getMessage('ENTER_NAME'),'',true));tb.append(tb.createLink('cat-make-sub-link',[['catToolBar.createSubItem()',gLanguage.getMessage('CREATE_SUB'),'cat-make-sub']],'',false));tb.append(tb.createLink('cat-make-super-link',[['catToolBar.createSuperItem()',gLanguage.getMessage('CREATE_SUPER'),'cat-make-super']],'',false));var links=[['catToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('cat-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("category-content-box"));setTimeout("$('cat-subsuper').focus();",50);},createSubSuperLinks:function(elementID){var exists=$("cat-subsuper").getAttribute("catExists");exists=(exists&&exists=='true');var tb=this.toolbarContainer;var title=$("cat-subsuper").value;if(title==''){$('cat-make-sub').hide();$('cat-make-super').hide();return;}var superContent;var sub;if(!exists){sub=gLanguage.getMessage('CREATE_SUB_CATEGORY');superContent=gLanguage.getMessage('CREATE_SUPER_CATEGORY');}else{sub=gLanguage.getMessage('MAKE_SUB_CATEGORY');superContent=gLanguage.getMessage('MAKE_SUPER_CATEGORY');}sub=sub.replace(/\$-title/g,title);superContent=superContent.replace(/\$-title/g,title);if($('cat-make-sub').innerHTML!=sub){var lnk=tb.createLink('cat-make-sub-link',[['catToolBar.createSuperItem('+(exists?'false':'true')+')',sub,'cat-make-sub']],'',true);tb.replace('cat-make-sub-link',lnk);lnk=tb.createLink('cat-make-super-link',[['catToolBar.createSubItem()',superContent,'cat-make-super']],'',true);tb.replace('cat-make-super-link',lnk);}},createSubItem:function(){var name=$("cat-subsuper").value;if(name==""||name==null){alert(gLanguage.getMessage('INPUT_BOX_EMPTY'));return;}this.om.createSubCategory(name,"");this.fillList(true);},createSuperItem:function(openTargetArticle){if(openTargetArticle==undefined){openTargetArticle=true;}var name=$("cat-subsuper").value;if(name==""||name==null){alert(gLanguage.getMessage('INPUT_BOX_EMPTY'));return;}this.om.createSuperCategory(name,"",openTargetArticle);this.fillList(true);},changeItem:function(selindex){this.wtp.initialize();var name=$("cat-name").value;var annotatedElements=this.wtp.getCategories();if((selindex!=null)&&(selindex>=0)&&(selindex<=annotatedElements.length)){annotatedElements[selindex].changeCategory(name);}this.fillList(true);},deleteItem:function(selindex){this.wtp.initialize();var annotatedElements=this.wtp.getCategories();if((selindex!=null)&&(selindex>=0)&&(selindex<=annotatedElements.length)){var anno=annotatedElements[selindex];anno.remove("");}this.fillList(true);},newCategory:function(){var html;this.showList=false;var tb=this.createToolbar(SMW_CAT_ALL_VALID);tb.append(tb.createText('cat-help-msg',gLanguage.getMessage('CREATE_NEW_CATEGORY'),'',true));tb.append(tb.createInput('cat-name',gLanguage.getMessage('NAME'),'','',SMW_CAT_CHECK_CATEGORY_IIE+SMW_CAT_CHECK_EMPTY,true));tb.append(tb.createText('cat-name-msg',gLanguage.getMessage('ENTER_NAME'),'',true));var links=[['catToolBar.createNewCategory()',gLanguage.getMessage('CREATE'),'cat-confirm',gLanguage.getMessage('INVALID_NAME'),'cat-invalid'],['catToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('cat-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("category-content-box"));setTimeout("$('cat-name').focus();",50);},createNewCategory:function(){var catName=$("cat-name").value;this.om.createCategory(catName,"");this.wtp.initialize();this.wtp.addCategory(catName,true);this.fillList(true);},getselectedItem:function(selindex){this.wtp.initialize();var annotatedElements=this.wtp.getCategories();if(selindex==null||selindex<0||selindex>=annotatedElements.length){return;}this.showList=false;var tb=this.createToolbar(SMW_CAT_ALL_VALID);tb.append(tb.createText('cat-help-msg',gLanguage.getMessage('CHANGE_ANNO_OF_CAT'),'',true));tb.append(tb.createInput('cat-name',gLanguage.getMessage('NAME'),annotatedElements[selindex].getName(),'',SMW_CAT_CHECK_CATEGORY+SMW_CAT_CHECK_EMPTY+SMW_CAT_HINT_CATEGORY,true));tb.append(tb.createText('cat-name-msg',gLanguage.getMessage('ENTER_NAME'),'',true));var links=[['catToolBar.changeItem('+selindex+')',gLanguage.getMessage('CHANGE'),'cat-confirm',gLanguage.getMessage('INVALID_NAME'),'cat-invalid'],['catToolBar.deleteItem('+selindex+')',gLanguage.getMessage('DELETE')],['catToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('cat-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("category-content-box"));annotatedElements[selindex].select();setTimeout("$('cat-name').focus();",50);}};var catToolBar=new CategoryToolBar();Event.observe(window,'load',catToolBar.callme.bindAsEventListener(catToolBar)); 

// SMW_Relation.js
var RelationToolBar=Class.create();var SMW_REL_CHECK_PROPERTY='smwCheckType="property: exists '+'? (color: lightgreen, hideMessage, valid:true) '+': (color: orange, showMessage:PROPERTY_DOES_NOT_EXIST, valid:true)" ';var SMW_REL_CHECK_PROPERTY_UPDATE_SCHEMA='smwCheckType="property: exists '+'? (color: lightgreen, hideMessage, valid:true, call:relToolBar.updateSchema) '+': (color: orange, showMessage:PROPERTY_DOES_NOT_EXIST, valid:true)" ';var SMW_REL_SUB_SUPER_CHECK_PROPERTY='smwCheckType="property: exists '+'? (color: lightgreen, hideMessage, valid:true, attribute:propExists=true) '+': (color: orange, hideMessage, valid:true, attribute:propExists=false)" ';var SMW_REL_CHECK_PROPERTY_IIE='smwCheckType="property: exists '+'? (color: red, showMessage:PROPERTY_ALREADY_EXISTS, valid:false) '+': (color: lightgreen, hideMessage, valid:true)" ';var SMW_REL_CHECK_CATEGORY='smwCheckType="category: exists '+'? (color: lightgreen, hideMessage, valid:true) '+': (color: orange, showMessage:CATEGORY_DOES_NOT_EXIST, valid:true)" ';var SMW_REL_CHECK_EMPTY='smwCheckEmpty="empty'+'? (color:red, showMessage:MUST_NOT_BE_EMPTY, valid:false) '+': (color:white, hideMessage)"';var SMW_REL_CHECK_EMPTY_NEV='smwCheckEmpty="empty'+'? (color:red, showMessage:MUST_NOT_BE_EMPTY, valid:false) '+': (color:white, hideMessage, valid:true)"';var SMW_REL_CHECK_EMPTY_WIE='smwCheckEmpty="empty'+'? (color:orange, showMessage:VALUE_IMPROVES_QUALITY) '+': (color:white, hideMessage)"';var SMW_REL_NO_EMPTY_SELECTION='smwCheckEmpty="empty'+'? (color:red, showMessage:SELECTION_MUST_NOT_BE_EMPTY, valid:false) '+': (color:white, hideMessage, valid:true)"';var SMW_REL_ALL_VALID='smwAllValid="allValid '+'? (show:rel-confirm, hide:rel-invalid) '+': (show:rel-invalid, hide:rel-confirm)"';var SMW_REL_SUB_SUPER_ALL_VALID='smwAllValid="allValid '+'? (call:relToolBar.createSubSuperLinks) '+': (call:relToolBar.createSubSuperLinks)"';var SMW_REL_CHECK_PART_OF_RADIO='smwValid="relToolBar.checkPartOfRadio"';var SMW_REL_HINT_CATEGORY='typeHint = "14" ';var SMW_REL_HINT_PROPERTY='typeHint="100" ';RelationToolBar.prototype={initialize:function(){this.genTB=new GenericToolBar();this.toolbarContainer=null;this.showList=true;},showToolbar:function(){this.relationcontainer.setHeadline(gLanguage.getMessage('PROPERTIES'));this.wtp=new WikiTextParser();this.om=new OntologyModifier();this.fillList(true);},callme:function(event){if(wgAction=="edit"&&stb_control.isToolbarAvailable()){this.relationcontainer=stb_control.createDivContainer(RELATIONCONTAINER,0);this.showToolbar();}},fillList:function(forceShowList){if(forceShowList==true){this.showList=true;}if(!this.showList){return;}this.wtp.initialize();this.relationcontainer.setContent(this.genTB.createList(this.wtp.getRelations(),"relation"));this.relationcontainer.contentChanged();},cancel:function(){this.toolbarContainer.hideSandglass();this.toolbarContainer.release();this.toolbarContainer=null;this.fillList(true);},createToolbar:function(attributes){if(this.toolbarContainer){this.toolbarContainer.release();}this.toolbarContainer=new ContainerToolBar('relation-content',700,this.relationcontainer);var tb=this.toolbarContainer;tb.createContainerBody(attributes);return tb;},addItem:function(){this.wtp.initialize();var name=$("rel-name").value;var value=this.getRelationValue();var text=$("rel-show").value;if(name==""||name==null){alert(gLanguage.getMessage('INPUT_BOX_EMPTY'));return;}this.wtp.addRelation(name,value,text);this.fillList(true);},getRelationValue:function(){var i=0;var value="";while($("rel-value-"+i)!=null){value+=$("rel-value-"+i).value+";";i++;}value=value.substr(0,value.length-1);return value;},newItem:function(){var html;this.wtp.initialize();this.showList=false;var selection=this.wtp.getSelection();var tb=this.createToolbar(SMW_REL_ALL_VALID);tb.append(tb.createText('rel-help_msg',gLanguage.getMessage('ANNOTATE_PROPERTY'),'',true));tb.append(tb.createInput('rel-name',gLanguage.getMessage('NAME'),'','',SMW_REL_CHECK_PROPERTY_UPDATE_SCHEMA+SMW_REL_CHECK_EMPTY+SMW_REL_HINT_PROPERTY,true));tb.append(tb.createText('rel-name-msg',gLanguage.getMessage('ENTER_NAME'),'',true));tb.append(tb.createInput('rel-value-0',gLanguage.getMessage('PAGE'),selection,'',SMW_REL_CHECK_EMPTY_NEV,true));tb.append(tb.createText('rel-value-0-msg',gLanguage.getMessage('ANNO_PAGE_VALUE'),'',true));tb.append(tb.createInput('rel-show',gLanguage.getMessage('SHOW'),'','','',true));var links=[['relToolBar.addItem()',gLanguage.getMessage('ADD'),'rel-confirm',gLanguage.getMessage('INVALID_VALUES'),'rel-invalid'],['relToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('rel-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));setTimeout("$('rel-name').focus();",50);},updateSchema:function(elementID){relToolBar.toolbarContainer.showSandglass(elementID);sajax_do_call('smwfRelationSchemaData',[$('rel-name').value],relToolBar.updateNewItem.bind(relToolBar));},updateNewItem:function(request){relToolBar.toolbarContainer.hideSandglass();if(request.status!=200){return;}var arity=2;var parameterNames=["Page"];if(request.responseText!='noSchemaData'){var schemaData=GeneralXMLTools.createDocumentFromString(request.responseText);arity=parseInt(schemaData.documentElement.getAttribute("arity"));parameterNames=[];for(var i=0,n=schemaData.documentElement.childNodes.length;i<n;i++){parameterNames.push(schemaData.documentElement.childNodes[i].getAttribute("name"));}}var selection=this.wtp.getSelection();var tb=this.toolbarContainer;var i=0;var removeElements=new Array();var found=true;var oldValues=[];while(found){found=false;var elem=$('rel-value-'+i);if(elem){oldValues.push($('rel-value-'+i).value);removeElements.push('rel-value-'+i);found=true;}elem=$('rel-value-'+i+'-msg');if(elem){removeElements.push('rel-value-'+i+'-msg');found=true;}++i;}tb.remove(removeElements);for(var i=0;i<arity-1;i++){insertAfter=(i==0)?($('rel-replace-all')?'rel-replace-all':'rel-name-msg'):'rel-value-'+(i-1)+'-msg';var value=(i==0)?((oldValues.length>0)?oldValues[0]:selection):((oldValues.length>i)?oldValues[i]:'');tb.insert(insertAfter,tb.createInput('rel-value-'+i,parameterNames[i],value,'',SMW_REL_CHECK_EMPTY_NEV,true));tb.insert('rel-value-'+i,tb.createText('rel-value-'+i+'-msg',gLanguage.getMessage('ANNO_PAGE_VALUE'),'',true));selection="";}tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));},CreateSubSup:function(){var html;this.showList=false;var tb=this.createToolbar(SMW_REL_SUB_SUPER_ALL_VALID);tb.append(tb.createText('rel-help-msg',gLanguage.getMessage('DEFINE_SUB_SUPER_PROPERTY'),'',true));tb.append(tb.createInput('rel-subsuper',gLanguage.getMessage('NAME'),'','',SMW_REL_SUB_SUPER_CHECK_PROPERTY+SMW_REL_CHECK_EMPTY,true));tb.append(tb.createText('rel-subsuper-msg',gLanguage.getMessage('ENTER_NAME'),'',true));tb.append(tb.createLink('rel-make-sub-link',[['relToolBar.createSubItem()',gLanguage.getMessage('CREATE_SUB'),'rel-make-sub']],'',false));tb.append(tb.createLink('rel-make-super-link',[['relToolBar.createSuperItem()',gLanguage.getMessage('CREATE_SUPER'),'rel-make-super']],'',false));var links=[['relToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('rel-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));setTimeout("$('rel-subsuper').focus();",50);},createSubSuperLinks:function(elementID){var exists=$("rel-subsuper").getAttribute("propExists");exists=(exists&&exists=='true');var tb=this.toolbarContainer;var title=$("rel-subsuper").value;if(title==''){$('rel-make-sub').hide();$('rel-make-super').hide();return;}var superContent;var sub;if(!exists){sub=gLanguage.getMessage('CREATE_SUB_PROPERTY');superContent=gLanguage.getMessage('CREATE_SUPER_PROPERTY');}else{sub=gLanguage.getMessage('MAKE_SUB_PROPERTY');superContent=gLanguage.getMessage('MAKE_SUPER_PROPERTY');}sub=sub.replace(/\$-title/g,title);superContent=superContent.replace(/\$-title/g,title);if($('rel-make-sub').innerHTML!=sub){var lnk=tb.createLink('rel-make-sub-link',[['relToolBar.createSuperItem('+(exists?'false':'true')+')',sub,'rel-make-sub']],'',true);tb.replace('rel-make-sub-link',lnk);lnk=tb.createLink('rel-make-super-link',[['relToolBar.createSubItem()',superContent,'rel-make-super']],'',true);tb.replace('rel-make-super-link',lnk);}},createSubItem:function(openTargetArticle){if(openTargetArticle==undefined){openTargetArticle=true;}var name=$("rel-subsuper").value;if(name==""||name==null){alert(gLanguage.getMessage('INPUT_BOX_EMPTY'));return;}this.om.createSubProperty(name,"",openTargetArticle);this.fillList(true);},createSuperItem:function(openTargetArticle){if(openTargetArticle==undefined){openTargetArticle=true;}var name=$("rel-subsuper").value;if(name==""||name==null){alert(gLanguage.getMessage('INPUT_BOX_EMPTY'));return;}this.om.createSuperProperty(name,"",openTargetArticle);this.fillList(true);},newRelation:function(){var html;gDataTypes.refresh();this.showList=false;var domain=(wgNamespaceNumber==14)?wgTitle:"";var tb=this.createToolbar(SMW_REL_ALL_VALID);tb.append(tb.createText('rel-help-msg',gLanguage.getMessage('CREATE_NEW_PROPERTY'),'',true));tb.append(tb.createInput('rel-name',gLanguage.getMessage('NAME'),'','',SMW_REL_CHECK_PROPERTY_IIE+SMW_REL_CHECK_EMPTY,true));tb.append(tb.createText('rel-name-msg',gLanguage.getMessage('ENTER_NAME'),'',true));tb.append(tb.createInput('rel-domain',gLanguage.getMessage('DOMAIN'),'','',SMW_REL_CHECK_CATEGORY+SMW_REL_CHECK_EMPTY_WIE,true));tb.append(tb.createText('rel-domain-msg',gLanguage.getMessage('ENTER_DOMAIN'),'',true));tb.append(tb.createInput('rel-range-0',gLanguage.getMessage('RANGE'),'',"relToolBar.removeRangeOrType('rel-range-0')",SMW_REL_CHECK_CATEGORY+SMW_REL_CHECK_EMPTY_WIE,true));tb.append(tb.createText('rel-range-0-msg',gLanguage.getMessage('ENTER_RANGE'),'',true));var links=[['relToolBar.createNewRelation()',gLanguage.getMessage('CREATE'),'rel-confirm',gLanguage.getMessage('INVALID_VALUES'),'rel-invalid'],['relToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('rel-links',links,'',true));links=[['relToolBar.addRangeInput()',gLanguage.getMessage('ADD_RANGE')],['relToolBar.addTypeInput()',gLanguage.getMessage('ADD_TYPE')]];tb.append(tb.createLink('rel-add-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));setTimeout("$('rel-name').focus();",50);},addRangeInput:function(){var i=0;while($('rel-range-'+i)!=null){i++;}var tb=this.toolbarContainer;var insertAfter=(i==0)?'rel-domain-msg':$('rel-range-'+(i-1)+'-msg')?'rel-range-'+(i-1)+'-msg':'rel-range-'+(i-1);tb.insert(insertAfter,tb.createInput('rel-range-'+i,gLanguage.getMessage('RANGE'),'',"relToolBar.removeRangeOrType('rel-range-"+i+"')",SMW_REL_CHECK_CATEGORY+SMW_REL_CHECK_EMPTY_WIE,true));tb.insert('rel-range-'+i,tb.createText('rel-range-'+i+'-msg',gLanguage.getMessage('ENTER_RANGE'),'',true));tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));},addTypeInput:function(){var i=0;while($('rel-range-'+i)!=null){i++;}var tb=this.toolbarContainer;var insertAfter=(i==0)?'rel-domain-msg':$('rel-range-'+(i-1)+'-msg')?'rel-range-'+(i-1)+'-msg':'rel-range-'+(i-1);tb.insert(insertAfter,tb.createDropDown('rel-range-'+i,gLanguage.getMessage('TYPE'),this.getDatatypeOptions(),"relToolBar.removeRangeOrType('rel-range-"+i+"')",0,'isAttributeType="true" '+SMW_REL_NO_EMPTY_SELECTION,true));tb.insert('rel-range-'+i,tb.createText('rel-range-'+i+'-msg',gLanguage.getMessage('ENTER_TYPE'),'',true));tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));},getDatatypeOptions:function(){var options=new Array();var builtinTypes=gDataTypes.getBuiltinTypes();var userTypes=gDataTypes.getUserDefinedTypes();options=builtinTypes.concat([""],userTypes);return options;},removeRangeOrType:function(id){var rangeOrTypeInput=$(id);if(rangeOrTypeInput!=null){var tb=this.toolbarContainer;var rowsAfterRemoved=rangeOrTypeInput.parentNode.parentNode.nextSibling;var idOfValueInput=rangeOrTypeInput.getAttribute('id');var i=parseInt(idOfValueInput.substr(idOfValueInput.length-1,idOfValueInput.length));tb.remove(id);if($(id+'-msg')){tb.remove(id+'-msg');}id=idOfValueInput.substr(0,idOfValueInput.length-1);var obj;while((obj=$(id+ ++i))){var delBtn=obj.up().down('a');if(delBtn){var action=delBtn.getAttribute("href");var regex=new RegExp(id+i);action=action.replace(regex,id+(i-1));delBtn.setAttribute("href",action);}tb.changeID(obj,id+(i-1));if((obj=$(id+i+'-msg'))){tb.changeID(obj,id+(i-1)+'-msg');}}tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));}},createNewRelation:function(){var relName=$("rel-name").value;if(relName==""||relName==null){alert(gLanguage.getMessage('INPUT_BOX_EMPTY'));return;}var i=0;var rangesAndTypes=new Array();while($('rel-range-'+i)!=null){if($('rel-range-'+i).getAttribute("isAttributeType")=="true"){rangesAndTypes.push(gLanguage.getMessage('TYPE')+$('rel-range-'+i).value);}else{rangesAndTypes.push(gLanguage.getMessage('CATEGORY')+$('rel-range-'+i).value);}i++;}this.om.createRelation(relName,gLanguage.getMessage('CREATE_PROPERTY'),$("rel-domain").value,rangesAndTypes);this.fillList(true);},changeItem:function(selindex){this.wtp.initialize();var relName=$("rel-name").value;var value=this.getRelationValue();var text=$("rel-show").value;if(relName==""||relName==null){alert(gLanguage.getMessage('INPUT_BOX_EMPTY'));return;}var annotatedElements=this.wtp.getRelations();if((selindex!=null)&&(selindex>=0)&&(selindex<=annotatedElements.length)){var relation=annotatedElements[selindex];if($("rel-replace-all")&&$("rel-replace-all").down('input').checked==true){var relations=this.wtp.getRelation(relation.getName());for(var i=0,len=relations.length;i<len;i++){relations[i].rename(relName);}editAreaLoader.execCommand(editAreaName,"resync_highlight(true)");}relation.rename(relName);relation.changeValue(value);relation.changeRepresentation(text);}this.fillList(true);},deleteItem:function(selindex){this.wtp.initialize();var annotatedElements=this.wtp.getRelations();if((selindex!=null)&&(selindex>=0)&&(selindex<=annotatedElements.length)){var anno=annotatedElements[selindex];var replText=(anno.getRepresentation()!="")?anno.getRepresentation():(anno.getValue()!=""?anno.getValue():"");anno.remove(replText);}this.fillList(true);},newPart:function(){var html;this.wtp.initialize();var selection=this.wtp.getSelection();this.showList=false;var path=wgArticlePath;var dollarPos=path.indexOf('$1');if(dollarPos>0){path=path.substring(0,dollarPos);}var poLink="<a href='"+wgServer+path+gLanguage.getMessage('PROP_HAS_PART')+"' "+"target='blank'> "+gLanguage.getMessage('HAS_PART')+"</a>";var bsuLink="<a href='"+wgServer+path+gLanguage.getMessage('PROP_HBSU')+"' "+"target='blank'> "+gLanguage.getMessage('HBSU')+"</a>";var tb=this.createToolbar(SMW_REL_ALL_VALID);tb.append(tb.createText('rel-help-msg',gLanguage.getMessage('DEFINE_PART_OF'),'',true));tb.append(tb.createText('rel-help-msg',wgTitle,'',true));tb.append(tb.createRadio('rel-partof','',[poLink,bsuLink],-1,SMW_REL_CHECK_PART_OF_RADIO,true));tb.append(tb.createInput('rel-name',gLanguage.getMessage('OBJECT'),selection,'',SMW_REL_CHECK_EMPTY_NEV,true));tb.append(tb.createText('rel-name-msg','','',true));tb.append(tb.createInput('rel-show',gLanguage.getMessage('SHOW'),'','','',true));var links=[['relToolBar.addPartOfRelation()',gLanguage.getMessage('ADD'),'rel-confirm',gLanguage.getMessage('INVALID_VALUES'),'rel-invalid'],['relToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('rel-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));setTimeout("$('rel-partof').focus();",50);},checkPartOfRadio:function(element){var element=$(element).elements["rel-partof"];if(element[0].checked==true||element[1].checked==true){return true;}return false;},addPartOfRelation:function(){var element=$('rel-partof').elements["rel-partof"];var poType="";if(element[0].checked==true){poType=gLanguage.getMessage('HAS_PART');}else if(element[1].checked==true){poType=gLanguage.getMessage('HBSU');}var obj=$("rel-name").value;if(obj==""){alert(gLanguage.getMessage('NO_OBJECT_FOR_POR'));}var show=$("rel-show").value;this.wtp.initialize();this.wtp.addRelation(poType,obj,show,false);this.fillList(true);},getselectedItem:function(selindex){this.wtp.initialize();var html;var renameAll="";var annotatedElements=this.wtp.getRelations();if(selindex==null||selindex<0||selindex>=annotatedElements.length){return;}this.showList=false;var relation=annotatedElements[selindex];var tb=this.createToolbar(SMW_REL_ALL_VALID);var relations=this.wtp.getRelation(relation.getName());if(relations.length>1){renameAll=tb.createCheckBox('rel-replace-all','',[gLanguage.getMessage('RENAME_ALL_IN_ARTICLE')],[],'',true);}function getSchemaCallback(request){tb.hideSandglass();if(request.status!=200){alert(gLanguage.getMessage('RETRIEVE_SCHEMA_DATA'));return;}var parameterNames=[];if(request.responseText!='noSchemaData'){var schemaData=GeneralXMLTools.createDocumentFromString(request.responseText);parameterNames=[];for(var i=0,n=schemaData.documentElement.childNodes.length;i<n;i++){parameterNames.push(schemaData.documentElement.childNodes[i].getAttribute("name"));}}else{for(var i=0;i<relation.getArity()-1;i++){parameterNames.push("Value");}}var valueInputs=new Array();for(var i=0;i<relation.getArity()-1;i++){var parName=(parameterNames.length>i)?parameterNames[i]:"Page";var typeCheck='smwCheckType="'+parName.toLowerCase()+': valid'+'? (color: lightgreen, hideMessage, valid:true)'+': (color: red, showMessage:INVALID_FORMAT_OF_VALUE, valid:false)" ';var obj=tb.createInput('rel-value-'+i,parName,relation.getSplitValues()[i],'',typeCheck,true);valueInputs.push(obj);obj=tb.createText('rel-value-'+i+'-msg','','',true);valueInputs.push(obj);}tb.append(tb.createInput('rel-name',gLanguage.getMessage('NAME'),relation.getName(),'',SMW_REL_CHECK_PROPERTY_UPDATE_SCHEMA+SMW_REL_CHECK_EMPTY,true));tb.append(tb.createText('rel-name-msg','','',true));if(renameAll!=''){tb.append(renameAll);}tb.append(valueInputs);tb.append(tb.createInput('rel-show',gLanguage.getMessage('SHOW'),relation.getRepresentation(),'','',true));var links=[['relToolBar.changeItem('+selindex+')',gLanguage.getMessage('CHANGE'),'rel-confirm',gLanguage.getMessage('INVALID_VALUES'),'rel-invalid'],['relToolBar.deleteItem('+selindex+')',gLanguage.getMessage('DELETE')],['relToolBar.cancel()',gLanguage.getMessage('CANCEL')]];tb.append(tb.createLink('rel-links',links,'',true));tb.finishCreation();gSTBEventActions.initialCheck($("relation-content-box"));setTimeout("$('rel-name').focus();",50);};tb.append(tb.createText('rel-help-msg',gLanguage.getMessage('CHANGE_PROPERTY'),'',true));if(relation.getName().strip()!=""){this.toolbarContainer.showSandglass('rel-help-msg');sajax_do_call('smwfRelationSchemaData',[relation.getName()],getSchemaCallback.bind(this));}}};var relToolBar=new RelationToolBar();Event.observe(window,'load',relToolBar.callme.bindAsEventListener(relToolBar)); 

// SMW_Properties.js
var DOMAIN_HINT="Has domain hint";var RANGE_HINT="Has range hint";var HAS_TYPE="has type";var MAX_CARDINALITY="Has max cardinality";var MIN_CARDINALITY="Has min cardinality";var INVERSE_OF="Is inverse of";var TRANSITIVE_RELATION="Transitive relations";var SYMMETRICAL_RELATION="Symmetrical relations";var SMW_PRP_ALL_VALID='smwAllValid="allValid '+'? (show:prop-confirm, hide:prop-invalid) '+': (show:prop-invalid, hide:prop-confirm)"';var SMW_PRP_CHECK_CATEGORY='smwCheckType="category: exists '+'? (color: lightgreen, hideMessage, valid:true) '+': (color: orange, showMessage:CATEGORY_DOES_NOT_EXIST, valid:true)" ';var SMW_PRP_CHECK_PROPERTY='smwCheckType="property: exists '+'? (color: lightgreen, hideMessage, valid:true) '+': (color: orange, showMessage:PROPERTY_DOES_NOT_EXIST, valid:true)" ';var SMW_PRP_CHECK_INTEGER='smwCheckType="integer: valid '+'? (color: lightgreen, hideMessage, valid:true) '+': (color: red, showMessage:INVALID_FORMAT_OF_VALUE, valid:false)" ';var SMW_PRP_HINT_CATEGORY='typeHint = "14" ';var SMW_PRP_HINT_PROPERTY='typeHint="102" ';var SMW_PRP_CHECK_EMPTY='smwCheckEmpty="empty'+'? (color:red, showMessage:MUST_NOT_BE_EMPTY, valid:false) '+': (color:white, hideMessage)"';var SMW_PRP_CHECK_EMPTY_WIE='smwCheckEmpty="empty'+'? (color:orange, showMessage:VALUE_IMPROVES_QUALITY) '+': (color:white, hideMessage)"';var SMW_PRP_CHECK_EMPTY_VIE='smwCheckEmpty="empty'+'? (color:white, hideMessage, valid:true) '+': ()"';var SMW_PRP_NO_EMPTY_SELECTION='smwCheckEmpty="empty'+'? (color:red, showMessage:SELECTION_MUST_NOT_BE_EMPTY, valid:false) '+': (color:white, hideMessage, valid:true)"';var PRP_NARY_CHANGE_LINKS=[['propToolBar.addType()',gLanguage.getMessage('ADD_TYPE'),'prp-add-type-lnk'],['propToolBar.addRange()',gLanguage.getMessage('ADD_RANGE'),'prp-add-range-lnk']];var PRP_APPLY_LINK=[['propToolBar.apply()','Apply','prop-confirm',gLanguage.getMessage('INVALID_VALUES'),'prop-invalid']];var PropertiesToolBar=Class.create();PropertiesToolBar.prototype={initialize:function(){this.genTB=new GenericToolBar();this.toolbarContainer=null;this.pendingIndicator=null;this.isRelation=true;this.isNAry=false;this.numOfParams=0;this.prpNAry=0;},showToolbar:function(request){if(this.propertiescontainer==null){return;}this.propertiescontainer.setHeadline(gLanguage.getMessage('PROPERTY_PROPERTIES'));this.wtp=new WikiTextParser();this.om=new OntologyModifier();this.createContent();},callme:function(event){if(wgAction=="edit"&&(wgNamespaceNumber==100||wgNamespaceNumber==102)&&stb_control.isToolbarAvailable()){this.propertiescontainer=stb_control.createDivContainer(PROPERTIESCONTAINER,0);setTimeout("propToolBar.showToolbar();",1);}},createContent:function(){if(this.propertiescontainer==null){return;}this.wtp.initialize();var type=this.wtp.getRelation(HAS_TYPE);var domain=this.wtp.getRelation(DOMAIN_HINT);var range=this.wtp.getRelation(RANGE_HINT);var maxCard=this.wtp.getRelation(MAX_CARDINALITY);var minCard=this.wtp.getRelation(MIN_CARDINALITY);var inverse=this.wtp.getRelation(INVERSE_OF);var transitive=this.wtp.getCategory(TRANSITIVE_RELATION);var symmetric=this.wtp.getCategory(SYMMETRICAL_RELATION);var changed=this.hasAnnotationChanged([type,domain,range,maxCard,minCard,inverse],[transitive,symmetric]);if(!changed){return;}if(this.toolbarContainer){this.toolbarContainer.release();}this.toolbarContainer=new ContainerToolBar('properties-content',800,this.propertiescontainer);var tb=this.toolbarContainer;tb.createContainerBody(SMW_PRP_ALL_VALID);if(type){type=type[0].getValue();type=type.charAt(5).toLowerCase()+type.substring(6);}else{type="page";}this.isRelation=(type=="page");if(domain==null){domain="";}else{domain=domain[0].getValue();if(domain.indexOf(gLanguage.getMessage('CATEGORY'))==0){domain=domain.substring(9);}}if(range==null){range="";}else{range=range[0].getValue();if(range.indexOf(gLanguage.getMessage('CATEGORY'))==0){range=range.substring(9);}}if(maxCard==null){maxCard="";}else{maxCard=maxCard[0].getValue();}if(minCard==null){minCard="";}else{minCard=minCard[0].getValue();}if(inverse==null){inverse="";}else{inverse=inverse[0].getValue();if(inverse.indexOf(gLanguage.getMessage('PROPERTY'))==0){inverse=inverse.substring(9);}}transitive=(transitive!=null)?"checked":"";symmetric=(symmetric!=null)?"checked":"";var tb=this.toolbarContainer;tb.append(tb.createInput('prp-domain',gLanguage.getMessage('DOMAIN'),domain,'',SMW_PRP_CHECK_CATEGORY+SMW_PRP_CHECK_EMPTY_WIE+SMW_PRP_HINT_CATEGORY,true));tb.append(tb.createText('prp-domain-msg','','',true));tb.append(tb.createInput('prp-range',gLanguage.getMessage('RANGE'),range,'',SMW_PRP_CHECK_CATEGORY+SMW_PRP_CHECK_EMPTY_WIE+SMW_PRP_HINT_CATEGORY,true));tb.append(tb.createText('prp-range-msg','','',true));tb.append(tb.createInput('prp-inverse-of',gLanguage.getMessage('INVERSE_OF'),inverse,'',SMW_PRP_CHECK_PROPERTY+SMW_PRP_HINT_PROPERTY+SMW_PRP_CHECK_EMPTY_VIE,true));tb.append(tb.createText('prp-inverse-of-msg','','',true));tb.append(this.createTypeSelector("prp-attr-type","prpSelection",false,type,'','smwChanged="(call:propToolBar.attrTypeChanged,call:propToolBar.enableWidgets)"'+SMW_PRP_NO_EMPTY_SELECTION));tb.append(tb.createInput('prp-min-card',gLanguage.getMessage('MIN_CARD'),minCard,'',SMW_PRP_CHECK_INTEGER+SMW_PRP_CHECK_EMPTY_VIE,true));tb.append(tb.createText('prp-min-card-msg','','',true));tb.append(tb.createInput('prp-max-card',gLanguage.getMessage('MAX_CARD'),maxCard,'',SMW_PRP_CHECK_INTEGER+SMW_PRP_CHECK_EMPTY_VIE,true));tb.append(tb.createText('prp-max-card-msg','','',true));tb.append(tb.createCheckBox('prp-transitive','',[gLanguage.getMessage('TRANSITIVE')],[transitive=='checked'?0: -1],'name="transitive"',true));tb.append(tb.createCheckBox('prp-symmetric','',[gLanguage.getMessage('SYMMETRIC')],[symmetric=='checked'?0: -1],'name="symmetric"',true));this.prpNAry=0;this.numOfParams=0;this.isNAry=false;var types=this.wtp.getRelation(HAS_TYPE);if(types){types=types[0];this.isNAry=(type.indexOf(';')>0);}if(this.isNAry){types=types.getSplitValues();var ranges=this.wtp.getRelation(RANGE_HINT);var rc=0;for(var i=0,num=types.length;i<num;++i){if(types[i]==gLanguage.getMessage('TYPE_PAGE')){var r="";if(ranges&&rc<ranges.length){r=ranges[rc++].getValue();}if(r.indexOf(gLanguage.getMessage('CATEGORY'))==0){r=r.substring(9);}tb.append(tb.createInput('prp-nary-'+i,gLanguage.getMessage('RANGE'),r,'propToolBar.removeRangeOrType(\'prp-nary-'+i+'\')',SMW_PRP_CHECK_CATEGORY+SMW_PRP_CHECK_EMPTY+SMW_PRP_HINT_CATEGORY,true));tb.append(tb.createText('prp-nary-'+i+'-msg','','',true));this.prpNAry++;this.numOfParams++;}else{var t=types[i];if(t.indexOf(gLanguage.getMessage('TYPE'))==0){t=t.substring(5);tb.append(this.createTypeSelector("prp-nary-"+i,"prpNaryType"+i,true,t,"propToolBar.removeRangeOrType('prp-nary-"+i+"')",SMW_PRP_NO_EMPTY_SELECTION));this.prpNAry++;this.numOfParams++;}}}}tb.append(tb.createLink('prp-change-links',PRP_NARY_CHANGE_LINKS,'',true));tb.append(tb.createLink('prp-links',PRP_APPLY_LINK,'',true));tb.finishCreation();this.enableWidgets();gSTBEventActions.initialCheck($("properties-content-box"));setTimeout("$('prp-domain').focus();",50);},hasAnnotationChanged:function(relations,categories){var changed=false;if(!this.relValues){changed=true;this.relValues=new Array(relations.length);this.catValues=new Array(categories.length);}for(var i=0;i<relations.length;i++){if(!relations[i]&&this.relValues[i]){changed=true;this.relValues[i]=null;}else if(relations[i]){var value=relations[i][0].annotation;if(this.relValues[i]!=value){this.relValues[i]=value;changed=true;}}}for(var i=0;i<categories.length;i++){if(!categories[i]&&this.catValues[i]){changed=true;this.catValues[i]=false;}else if(categories[i]&& !this.catValues[i]){this.catValues[i]=true;changed=true;}}return changed;},addType:function(){var insertAfter=(this.numOfParams==0)?'prp-symmetric':"prp-nary-"+(this.prpNAry-1)+'-msg';this.toolbarContainer.insert(insertAfter,this.createTypeSelector("prp-nary-"+this.prpNAry,"prpNaryType"+this.prpNAry,true,"","propToolBar.removeRangeOrType('prp-nary-"+this.prpNAry+"')",SMW_PRP_NO_EMPTY_SELECTION));this.prpNAry++;this.numOfParams++;this.toolbarContainer.finishCreation();this.enableWidgets();gSTBEventActions.initialCheck($("properties-content-box"));},addRange:function(){var insertAfter=(this.numOfParams==0)?'prp-symmetric':"prp-nary-"+(this.prpNAry-1)+'-msg';var tb=this.toolbarContainer;tb.insert(insertAfter,tb.createInput('prp-nary-'+this.prpNAry,gLanguage.getMessage('RANGE'),"",'propToolBar.removeRangeOrType(\'prp-nary-'+this.prpNAry+'\')',SMW_PRP_CHECK_CATEGORY+SMW_PRP_CHECK_EMPTY+SMW_PRP_HINT_CATEGORY,true));tb.insert('prp-nary-'+this.prpNAry,tb.createText('prp-nary-'+this.prpNAry+'-msg','','',true));this.prpNAry++;this.numOfParams++;this.toolbarContainer.finishCreation();this.enableWidgets();gSTBEventActions.initialCheck($("properties-content-box"));},removeRangeOrType:function(domID){this.toolbarContainer.remove(domID);this.toolbarContainer.remove(domID+'-msg');this.numOfParams--;if(domID=='prp-nary-'+(this.prpNAry-1)){while(this.prpNAry>0){--this.prpNAry;if($('prp-nary-'+this.prpNAry)){this.prpNAry++;break;}}}if(this.numOfParams==0){this.prpNAry=0;this.isRelation=true;this.isNAry=false;var selector=$('prp-attr-type');var options=selector.options;for(var i=0;i<options.length;i++){if(options[i].value=='page'){selector.selectedIndex=i;break;}}this.enableWidgets();}this.toolbarContainer.finishCreation();this.enableWidgets();gSTBEventActions.initialCheck($("properties-content-box"));},attrTypeChanged:function(target){target=$(target);if(target.id=='prp-attr-type'){this.isNAry=target.value=='n-ary';this.isRelation=target.value=='page';}},createTypeSelector:function(id,name,onlyTypes,type,deleteAction,attributes){var closure=function(){var origTypeString=type;if(type){type=type.toLowerCase();if(type.indexOf(';')>0){type='n-ary';}}var typeFound=false;var builtinTypes=gDataTypes.getBuiltinTypes();var userTypes=gDataTypes.getUserDefinedTypes();var allTypes=builtinTypes.concat([""],onlyTypes?[]:[gLanguage.getMessage('PAGE_TYPE'),gLanguage.getMessage('NARY_TYPE'),""],userTypes);var selection=$(id);if(selection){selection.length=allTypes.length;}var selIdx= -1;for(var i=0;i<allTypes.length;i++){var lcTypeName=allTypes[i].toLowerCase();if(type==lcTypeName){typeFound=true;if(selection){selection.options[i]=new Option(allTypes[i],allTypes[i],true,true);}selIdx=i;}else{if(selection){selection.options[i]=new Option(allTypes[i],allTypes[i],false,false);}}}if(type&&type!=gLanguage.getMessage('NARY_TYPE')&& !typeFound){if(selection){selection.options[i]=new Option(origTypeString,origTypeString,true,true);}selIdx=allTypes.length;allTypes[allTypes.length]=origTypeString;}gSTBEventActions.initialCheck($(id).up());propToolBar.toolbarContainer.finishCreation();return[allTypes,selIdx];};var sel=[[gLanguage.getMessage('RETRIEVING_DATATYPES')],0];if(gDataTypes.getUserDefinedTypes()==null||gDataTypes.getBuiltinTypes()==null|| !$(id)){gDataTypes.refresh(closure);}else{sel=closure();}if(!deleteAction){deleteAction="";}if(!attributes){attributes="";}var dropDown=this.toolbarContainer.createDropDown(id,gLanguage.getMessage('TYPE'),sel[0],deleteAction,sel[1],attributes+' name="'+name+'"',true);dropDown+=this.toolbarContainer.createText(id+'-msg','','',true);return dropDown;},enableWidgets:function(){var tb=propToolBar.toolbarContainer;if(propToolBar.isRelation&& !propToolBar.isNAry){$("prp-range").enable();$("prp-inverse-of").enable();$("prp-transitive").enable();$("prp-symmetric").enable();}else{$("prp-range").disable();$("prp-inverse-of").disable();$("prp-transitive").disable();$("prp-symmetric").disable();}if(propToolBar.isNAry){$('prp-add-type-lnk').show();$('prp-add-range-lnk').show();$('prp-min-card').disable();$('prp-max-card').disable();}else{$('prp-add-type-lnk').hide();$('prp-add-range-lnk').hide();$('prp-min-card').enable();$('prp-max-card').enable();}for(var i=0;i<propToolBar.prpNAry;i++){var obj=$('prp-nary-'+i);if(obj){if(propToolBar.isNAry){obj.enable();}else{obj.disable();}}}},cancel:function(){this.toolbarContainer.hideSandglass();this.createContent();},apply:function(){this.wtp.initialize();var domain=$("prp-domain").value;var range=this.isRelation?$("prp-range").value:null;var attrType=$("prp-attr-type").value;var inverse=this.isRelation?$("prp-inverse-of").value:null;var minCard=this.isNAry?null:$("prp-min-card").value;var maxCard=this.isNAry?null:$("prp-max-card").value;var transitive=this.isRelation?$("prp-transitive"):null;var symmetric=this.isRelation?$("prp-symmetric"):null;domain=(domain!=null&&domain!="")?gLanguage.getMessage('CATEGORY')+domain:null;range=(range!=null&&range!="")?gLanguage.getMessage('CATEGORY')+range:null;attrType=(attrType!=null&&attrType!="")?gLanguage.getMessage('TYPE')+attrType:null;inverse=(inverse!=null&&inverse!="")?gLanguage.getMessage('PROPERTY')+inverse:null;minCard=(minCard!=null&&minCard!="")?minCard:null;maxCard=(maxCard!=null&&maxCard!="")?maxCard:null;var domainAnno=this.wtp.getRelation(DOMAIN_HINT);var rangeAnno=this.wtp.getRelation(RANGE_HINT);var attrTypeAnno=this.wtp.getRelation(HAS_TYPE);var maxCardAnno=this.wtp.getRelation(MAX_CARDINALITY);var minCardAnno=this.wtp.getRelation(MIN_CARDINALITY);var inverseAnno=this.wtp.getRelation(INVERSE_OF);var transitiveAnno=this.wtp.getCategory(TRANSITIVE_RELATION);var symmetricAnno=this.wtp.getCategory(SYMMETRICAL_RELATION);if(domainAnno!=null){if(domain==null){domainAnno[0].remove("");}else{domainAnno[0].changeValue(domain);}}if(rangeAnno!=null){if(range==null){rangeAnno[0].remove("");}else{rangeAnno[0].changeValue(range);}}if(attrTypeAnno!=null){if(attrType==null){attrTypeAnno[0].remove("");}else{attrTypeAnno[0].changeValue(attrType);}}if(maxCardAnno!=null){if(maxCard==null){maxCardAnno[0].remove("");}else{maxCardAnno[0].changeValue(maxCard);}}if(minCardAnno!=null){if(minCard==null){minCardAnno[0].remove("");}else{minCardAnno[0].changeValue(minCard);}}if(inverseAnno!=null){if(inverse==null){inverseAnno[0].remove("");}else{inverseAnno[0].changeValue(inverse);}}if(transitiveAnno!=null&&(transitive==null|| !transitive.down('input').checked)){transitiveAnno.remove("");}if(symmetricAnno!=null&&(symmetric==null|| !symmetric.down('input').checked)){symmetricAnno.remove("");}if(domainAnno==null&&domain!=null){this.wtp.addRelation(DOMAIN_HINT,domain,null,true);}if(rangeAnno==null&&range!=null){this.wtp.addRelation(RANGE_HINT,range,null,true);}if(attrTypeAnno==null&&attrType!=null){this.wtp.addRelation(HAS_TYPE,attrType,null,true);}if(maxCardAnno==null&&maxCard!=null){this.wtp.addRelation(MAX_CARDINALITY,maxCard,null,true);}if(minCardAnno==null&&minCard!=null){this.wtp.addRelation(MIN_CARDINALITY,minCard,null,true);}if(inverseAnno==null&&inverse!=null){this.wtp.addRelation(INVERSE_OF,inverse,null,true);}if(transitive!=null&&transitive.down('input').checked&&transitiveAnno==null){this.wtp.addCategory(TRANSITIVE_RELATION,true);}if(symmetric!=null&&symmetric.down('input').checked&&symmetricAnno==null){this.wtp.addCategory(SYMMETRICAL_RELATION,true);}if(this.isNAry){rangeAnno=this.wtp.getRelation(RANGE_HINT);if(rangeAnno){for(var i=0,num=rangeAnno.length;i<num;i++){rangeAnno[i].remove("");}}var typeString="";for(var i=0;i<this.prpNAry;i++){var obj=$('prp-nary-'+i);if(obj){if(obj.tagName&&obj.tagName=="SELECT"){typeString+=gLanguage.getMessage('TYPE')+obj.value+";";}else{var r=gLanguage.getMessage('CATEGORY')+obj.value;typeString+=gLanguage.getMessage('TYPE_PAGE')+';';this.wtp.addRelation(RANGE_HINT,r,null,true);}}}if(typeString!=""){typeString=typeString.substring(0,typeString.length-1);attrTypeAnno=this.wtp.getRelation(HAS_TYPE);if(attrTypeAnno!=null){attrTypeAnno[0].changeValue(typeString);}else{this.wtp.addRelation(HAS_TYPE,typeString,null,true);}}}editAreaLoader.execCommand(editAreaName,"resync_highlight(true)");this.createContent();this.refreshOtherTabs();},refreshOtherTabs:function(){relToolBar.fillList();catToolBar.fillList();}};var propToolBar=new PropertiesToolBar();Event.observe(window,'load',propToolBar.callme.bindAsEventListener(propToolBar)); 

// SMW_Refresh.js
var RefreshSemanticToolBar=Class.create();RefreshSemanticToolBar.prototype={initialize:function(){this.userIsTyping=false;this.contentChanged=false;this.wtp=null;},register:function(event){if(wgAction=="edit"&&stb_control.isToolbarAvailable()){Event.observe('wpTextbox1','change',this.changed.bind(this));Event.observe('wpTextbox1','keypress',this.setUserIsTyping.bind(this));this.registerTimer();this.editboxtext="";}},changed:function(){this.contentChanged=true;},refresh:function(){if(this.userIsTyping){this.contentChanged=true;this.userIsTyping=false;}else if(this.contentChanged){this.contentChanged=false;this.refreshToolBar();}},registerTimer:function(){this.periodicalTimer=new PeriodicalExecuter(this.refresh.bind(this),3);},deregisterTimer:function(){this.periodicalTime?this.periodicalTimer.stop():"";},setUserIsTyping:function(){this.userIsTyping=true;},refreshToolBar:function(){if(window.catToolBar){catToolBar.fillList()}if(window.relToolBar){relToolBar.fillList()}if(window.propToolBar){propToolBar.createContent();}var saveButton=$('wpSave');if(saveButton){if(!this.wtp){this.wtp=new WikiTextParser();}this.wtp.initialize();this.wtp.parseAnnotations();var error=this.wtp.getError();if(error==WTP_NO_ERROR){saveButton.enable();if($('wpSaveWarning')){$('wpSaveWarning').remove();}}else{if(!$('wpSaveWarning')){saveButton.disable();new Insertion.Before(saveButton,'<div id="wpSaveWarning" '+'style="background-color:#ee0000;'+'color:white;'+'font-weight:bold;'+'text-align:left;">'+gLanguage.getMessage('UNMATCHED_BRACKETS')+'</div>');}}}}};var refreshSTB=new RefreshSemanticToolBar();Event.observe(window,'load',refreshSTB.register.bindAsEventListener(refreshSTB));

// SMW_FactboxType.js
function factboxTypeChanged(select,title){$('typeloader').show();var type=select.options[select.options.selectedIndex].value;sajax_do_call('smwgNewAttributeWithType',[title,type],refreshAfterTypeChange);};function refreshAfterTypeChange(request){window.location.href=location.href;}

// CombinedSearch.js
var CombinedSearchContributor=Class.create();CombinedSearchContributor.prototype={initialize:function(){this.queryPlaceholder=document.createElement("div");this.queryPlaceholder.setAttribute("id","queryPlaceholder");this.queryPlaceholder.innerHTML=gLanguage.getMessage('ADD_COMB_SEARCH_RES');this.pendingElement=null;this.tripleSearchPendingElement=null;},registerContributor:function(){if(!stb_control.isToolbarAvailable())return;if(wgCanonicalSpecialPageName!='Search'||wgCanonicalNamespace!='Special'){return;}this.comsrchontainer=stb_control.createDivContainer(COMBINEDSEARCHCONTAINER,0);this.comsrchontainer.setHeadline(gLanguage.getMessage('COMBINED_SEARCH'));this.comsrchontainer.setContent('<div id="csFoundEntities"></div>');this.comsrchontainer.contentChanged();var searchTerm=GeneralBrowserTools.getURLParameter("search");if($('stb_cont8-headline')==null)return;$("bodyContent").insertBefore(this.queryPlaceholder,$("bodyContent").firstChild);this.pendingElement=new OBPendingIndicator($('stb_cont8-headline'));this.tripleSearchPendingElement=new OBPendingIndicator($('queryPlaceholder'));if(searchTerm!=undefined&&searchTerm.strip()!=''){this.pendingElement.show();sajax_do_call('smwfCSDispatcher',[searchTerm],this.smwfCombinedSearchCallback.bind(this,"csFoundEntities"));this.tripleSearchPendingElement.show();sajax_do_call('smwfCSSearchForTriples',[searchTerm],this.smwfTripleSearchCallback.bind(this,"queryPlaceholder"));}},smwfTripleSearchCallback:function(containerID,request){this.tripleSearchPendingElement.hide();$(containerID).innerHTML=request.responseText;},smwfCombinedSearchCallback:function(containerID,request){this.pendingElement.hide();$(containerID).innerHTML=request.responseText;this.comsrchontainer.contentChanged();},searchForAttributeValues:function(parts){this.pendingElement.show($('cbsrch'));sajax_do_call('smwfCSAskForAttributeValues',[parts],this.smwfCombinedSearchCallback.bind(this,"queryPlaceholder"));}};var csContributor=new CombinedSearchContributor();Event.observe(window,'load',csContributor.registerContributor.bind(csContributor)); 

// obSemToolContribution.js
var OBSemanticToolbarContributor=Class.create();OBSemanticToolbarContributor.prototype={initialize:function(){this.textArea=null;this.l1=this.selectionListener.bindAsEventListener(this);this.l2=this.selectionListener.bindAsEventListener(this);this.l3=this.selectionListener.bindAsEventListener(this);},registerContributor:function(){if(!stb_control.isToolbarAvailable()||wgAction!='edit')return;this.comsrchontainer=stb_control.createDivContainer(CBSRCHCONTAINER,0);this.comsrchontainer.setHeadline(gLanguage.getMessage('ONTOLOGY_BROWSER'));this.comsrchontainer.setContent('<button type="button" disabled="true" '+'id="openEntityInOB" name="navigateToOB" '+'onclick="obContributor.navigateToOB(event)">'+gLanguage.getMessage('MARK_A_WORD')+'</button>');this.comsrchontainer.contentChanged();this.activateTextArea("wpTextbox1");},activateTextArea:function(id){if(this.textArea){Event.stopObserving(this.textArea,'select',this.l1);Event.stopObserving(this.textArea,'mouseup',this.l2);Event.stopObserving(this.textArea,'keyup',this.l3);}this.textArea=$(id);if(this.textArea){Event.observe(this.textArea,'select',this.l1);Event.observe(this.textArea,'mouseup',this.l2);Event.observe(this.textArea,'keyup',this.l3);if($("openEntityInOB")!=null)Field.disable("openEntityInOB");}},selectionListener:function(event){if($("openEntityInOB")==null)return;if(!GeneralBrowserTools.isTextSelected(this.textArea)){Field.disable("openEntityInOB");$("openEntityInOB").innerHTML=""+gLanguage.getMessage('MARK_A_WORD');this.textArea.focus();}else{Field.enable("openEntityInOB");$("openEntityInOB").innerHTML=""+gLanguage.getMessage('OPEN_IN_OB');this.textArea.focus();}},navigateToOB:function(event){var selectedText=GeneralBrowserTools.getSelectedText(this.textArea);if(selectedText==''){return;}var localURL=selectedText.split(":");if(localURL.length==1){var queryString='searchTerm='+localURL[0];}else{var queryString='ns='+localURL[0]+'&title='+localURL[1];}var ontoBrowserSpecialPage=wgArticlePath.replace(/\$1/,'Special:OntologyBrowser?'+queryString);window.open(wgServer+ontoBrowserSpecialPage,"");}};var obContributor=new OBSemanticToolbarContributor();Event.observe(window,'load',obContributor.registerContributor.bind(obContributor)); 

