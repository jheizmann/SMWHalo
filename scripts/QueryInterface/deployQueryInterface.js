
/* The MIT License
*
* Copyright (c) <year> <copyright holders>
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
*/


/*  Copyright 2007, ontoprise GmbH
*  This file is part of the halo-Extension.
*
*   The halo-Extension is free software; you can redistribute it and/or modify
*   it under the terms of the GNU General Public License as published by
*   the Free Software Foundation; either version 3 of the License, or
*   (at your option) any later version.
*
*   The halo-Extension is distributed in the hope that it will be useful,
*   but WITHOUT ANY WARRANTY; without even the implied warranty of
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*   GNU General Public License for more details.
*
*   You should have received a copy of the GNU General Public License
*   along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/


/* WICK License

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 
Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
Neither the name of the Christopher T. Holland, nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/
 
// treeviewQI.js
// under GPL-License; (c) 2003-2004 Jean-Michel Garnier (garnierjm@yahoo.fr)
 function toggle(node){var nextDIV=node.nextSibling;while(nextDIV.nodeName!="DIV"){nextDIV=nextDIV.nextSibling;}if(nextDIV.style.display=='none'){if(node.childNodes.length>0){if(node.childNodes.item(0).nodeName=="IMG"){node.childNodes.item(0).src=getImgDirectory(node.childNodes.item(0).src)+"minus.gif";}}nextDIV.style.display='block';}else{if(node.childNodes.length>0){if(node.childNodes.item(0).nodeName=="IMG"){node.childNodes.item(0).src=getImgDirectory(node.childNodes.item(0).src)+"plus.gif";}}nextDIV.style.display='none';}};function toggle2(node,folderCode){selectFolder(folderCode);};function getImgDirectory(source){return source.substring(0,source.lastIndexOf('/')+1);};function stringExtract(st,position,separator){var array;var result=new String('');var s=new String(st);if(s!=''){array=s.split(separator);result=array[position];}return result;};function jsTrim(value){var result="";for(i=0;i<value.length;i++){if(value.charAt(i)!=' '){result+=value.charAt(i);}}return result;};function findObj(n,d){var p,i,x;if(!d)d=document;if((p=n.indexOf("?"))>0&&parent.frames.length){d=parent.frames[n.substring(p+1)].document;n=n.substring(0,p);}if(!(x=d[n])&&d.all)x=d.all[n];for(i=0;!x&&i<d.forms.length;i++)x=d.forms[i][n];for(i=0;!x&&d.layers&&i<d.layers.length;i++)x=findObj(n,d.layers[i].document);return x;};function isInSelectInput(v,select_input){for(var i=0;i<select_input.options.length;i++){if(select_input.options[i].value==v){return true;}}return false;};function selectOption(v_value,select_input){var i,nb_item;nb_item=select_input.options.length;for(i=0;i<nb_item;i++){if(select_input.options[i].value==v_value)select_input.options[i].selected=true;}};function selectRemoveSelectedOption(select_input){for(var i=0;i<select_input.options.length;i++){if(select_input.options[i].selected){select_input.options[i]=null;}}select_input.selectedIndex= -1;};function selectRemoveAll(select_input){var linesNumber=select_input.options.length;for(i=0;i<linesNumber;i++){select_input.options[0]=null;}select_input.selectedIndex= -1;};function buildXMLSource(xmlSource_name){var obj,file_extension;obj=new ActiveXObject("Msxml2.FreeThreadedDOMDocument");obj.async=false;obj.resolveExternals=false;file_extension=stringExtract(xmlSource_name,1,".");if(file_extension=="xml"||file_extension=="xslt"){obj.load(xmlSource_name);}else{obj.loadXML(xmlSource_name);}return obj;};function transform(xmlSource,xsltSource){var xslt;var xslProc,paramName,paramValue;xslt=new ActiveXObject("Msxml2.XSLTemplate");xslt.stylesheet=xsltSource;xslProc=xslt.createProcessor();xslProc.input=xmlSource;if(arguments.length>2&&arguments.length%2==0){for(var i=0;i<Math.floor((arguments.length)/2)-1;i++){paramName=arguments[2*i+2];paramValue=arguments[2*i+3];xslProc.addParameter(paramName,paramValue);}}xslProc.transform();return xslProc.output;};function BrowserDetectLite(){var ua=navigator.userAgent.toLowerCase();this.isGecko=(ua.indexOf('gecko')!= -1);this.isMozilla=(this.isGecko&&ua.indexOf("gecko/")+14==ua.length);this.isNS=((this.isGecko)?(ua.indexOf('netscape')!= -1):((ua.indexOf('mozilla')!= -1)&&(ua.indexOf('spoofer')== -1)&&(ua.indexOf('compatible')== -1)&&(ua.indexOf('opera')== -1)&&(ua.indexOf('webtv')== -1)&&(ua.indexOf('hotjava')== -1)));this.isIE=((ua.indexOf("msie")!= -1)&&(ua.indexOf("opera")== -1)&&(ua.indexOf("webtv")== -1));this.isOpera=(ua.indexOf("opera")!= -1);this.isKonqueror=(ua.indexOf("konqueror")!= -1);this.isIcab=(ua.indexOf("icab")!= -1);this.isAol=(ua.indexOf("aol")!= -1);this.isWebtv=(ua.indexOf("webtv")!= -1);this.isIECompatible=((ua.indexOf("msie")!= -1)&& !this.isIE);this.isNSCompatible=((ua.indexOf("mozilla")!= -1)&& !this.isNS&& !this.isMozilla);this.versionMinor=parseFloat(navigator.appVersion);if(this.isNS&&this.isGecko){this.versionMinor=parseFloat(ua.substring(ua.lastIndexOf('/')+1));}else if(this.isIE&&this.versionMinor>=4){this.versionMinor=parseFloat(ua.substring(ua.indexOf('msie ')+5));}else if(this.isMozilla){this.versionMinor=parseFloat(ua.substring(ua.indexOf('rv:')+3));}else if(this.isOpera){if(ua.indexOf('opera/')!= -1){this.versionMinor=parseFloat(ua.substring(ua.indexOf('opera/')+6));}else{this.versionMinor=parseFloat(ua.substring(ua.indexOf('opera ')+6));}}else if(this.isKonqueror){this.versionMinor=parseFloat(ua.substring(ua.indexOf('konqueror/')+10));}else if(this.isIcab){if(ua.indexOf('icab/')!= -1){this.versionMinor=parseFloat(ua.substring(ua.indexOf('icab/')+6));}else{this.versionMinor=parseFloat(ua.substring(ua.indexOf('icab ')+6));}}else if(this.isWebtv){this.versionMinor=parseFloat(ua.substring(ua.indexOf('webtv/')+6));}this.versionMajor=parseInt(this.versionMinor);this.geckoVersion=((this.isGecko)?ua.substring((ua.lastIndexOf('gecko/')+6),(ua.lastIndexOf('gecko/')+14)): -1);this.isDOM1=(document.getElementById);this.isDOM2Event=(document.addEventListener&&document.removeEventListener);this.mode=document.compatMode?document.compatMode:'BackCompat';this.isWin=(ua.indexOf('win')!= -1);this.isWin32=(this.isWin&&(ua.indexOf('95')!= -1||ua.indexOf('98')!= -1||ua.indexOf('nt')!= -1||ua.indexOf('win32')!= -1||ua.indexOf('32bit')!= -1||ua.indexOf('xp')!= -1));this.isMac=(ua.indexOf('mac')!= -1);this.isUnix=(ua.indexOf('unix')!= -1||ua.indexOf('linux')!= -1||ua.indexOf('sunos')!= -1||ua.indexOf('bsd')!= -1||ua.indexOf('x11')!= -1);this.isNS4x=(this.isNS&&this.versionMajor==4);this.isNS40x=(this.isNS4x&&this.versionMinor<4.5);this.isNS47x=(this.isNS4x&&this.versionMinor>=4.7);this.isNS4up=(this.isNS&&this.versionMinor>=4);this.isNS6x=(this.isNS&&this.versionMajor==6);this.isNS6up=(this.isNS&&this.versionMajor>=6);this.isNS7x=(this.isNS&&this.versionMajor==7);this.isNS7up=(this.isNS&&this.versionMajor>=7);this.isIE4x=(this.isIE&&this.versionMajor==4);this.isIE4up=(this.isIE&&this.versionMajor>=4);this.isIE5x=(this.isIE&&this.versionMajor==5);this.isIE55=(this.isIE&&this.versionMinor==5.5);this.isIE5up=(this.isIE&&this.versionMajor>=5);this.isIE6x=(this.isIE&&this.versionMajor==6);this.isIE6up=(this.isIE&&this.versionMajor>=6);this.isIE4xMac=(this.isIE4x&&this.isMac);} 

// queryTree.js
// under GPL-License; Copyright (c) 2007 Ontoprise GmbH
var xslStylesheet;var myDOM;var xmldoc;function updateQueryTree(xmltext){if(OB_bd.isKonqueror||OB_bd.isSafari){alert(gLanguage.getMessage('KS_NOT_SUPPORTED'));return;}var xmldoc=GeneralXMLTools.createDocumentFromString(xmltext);if(OB_bd.isGeckoOrOpera){var QI_xsltProcessor_gecko=new XSLTProcessor();var myXMLHTTPRequest=new XMLHttpRequest();myXMLHTTPRequest.open("GET",wgServer+wgScriptPath+"/extensions/SMWHalo/skins/QueryInterface/treeview.xslt",false);myXMLHTTPRequest.send(null);var xslRef=myXMLHTTPRequest.responseXML;QI_xsltProcessor_gecko.importStylesheet(xslRef);QI_xsltProcessor_gecko.setParameter(null,"param-img-directory",wgServer+wgScriptPath+"/extensions/SMWHalo/skins/QueryInterface/images/");var fragment=QI_xsltProcessor_gecko.transformToFragment(xmldoc,document);var oldtree=document.getElementById("treeanchor").firstChild;if(oldtree){document.getElementById("treeanchor").removeChild(oldtree);}document.getElementById("treeanchor").appendChild(fragment);}else if(OB_bd.isIE){var xsl=new ActiveXObject("MSXML2.FreeThreadedDOMDocument");xsl.async=false;xsl.load(wgServer+wgScriptPath+"/extensions/SMWHalo/skins/QueryInterface/treeview.xslt");var template=new ActiveXObject("Msxml2.XSLTemplate");template.stylesheet=xsl;var QI_xsltProcessor_ie=template.createProcessor();QI_xsltProcessor_ie.addParameter("param-img-directory",wgServer+wgScriptPath+"/extensions/SMWHalo/skins/QueryInterface/images/");QI_xsltProcessor_ie.input=xmldoc;QI_xsltProcessor_ie.transform();var oldtree=document.getElementById("treeanchor").firstChild;if(oldtree){$("treeanchor").removeChild(oldtree);}$("treeanchor").innerHTML=QI_xsltProcessor_ie.output;}};function selectLeaf(title,code){var id=code.substring(8,code.indexOf('-'));if(code.indexOf("category")==0){selectFolder("categories"+id);}else if(code.indexOf("instance")==0){selectFolder("instances"+id);}else if(code.indexOf("property")==0){selectFolder("properties"+id);}else if(code.indexOf("subquery")==0){id=code.substring(8,code.length);qihelper.setActiveQuery(id);}};function selectFolder(folderCode){var id=null;if(folderCode.indexOf("categories")==0){id=folderCode.substring(10,folderCode.length);qihelper.loadCategoryDialogue(id);}else if(folderCode.indexOf("instances")==0){id=folderCode.substring(9,folderCode.length);qihelper.loadInstanceDialogue(id);}else if(folderCode.indexOf("properties")==0){id=folderCode.substring(10,folderCode.length);qihelper.loadPropertyDialogue(id);}}

// Query.js
// under GPL-License; Copyright (c) 2007 Ontoprise GmbH
var Query=Class.create();Query.prototype={initialize:function(id,parent,name){this.id=id;this.parent=parent;this.name=name;this.hasSubquery=false;this.categories=Array();this.instances=Array();this.properties=Array();this.subqueryIds=Array();},addCategoryGroup:function(cat,oldid){if(oldid==null)this.categories.push(cat);else this.categories[oldid]=cat;},addInstanceGroup:function(ins,oldid){if(oldid==null)this.instances.push(ins);else this.instances[oldid]=ins;},addPropertyGroup:function(pgroup,subIds,oldid){if(oldid==null)this.properties.push(pgroup);else this.properties[oldid]=pgroup;if(subIds.length>0){this.hasSubquery=true;for(var i=0;i<subIds.length;i++){this.subqueryIds.push(subIds[i]);}}},hasSubqueries:function(){return this.hasSubquery;},updateTreeXML:function(){var treexml='<?xml version="1.0" encoding="UTF-8"?>';treexml+='<treeview title=" Query"><folder title=" '+this.name+'" code="root" expanded="true" img="question.gif">';for(var i=0;i<this.categories.length;i++){treexml+='<folder title="'+gLanguage.getMessage('QI_CATEGORIES')+'" code="categories'+i+'" expanded="true" img="category.gif">';for(var j=0;j<this.categories[i].length;j++){treexml+='<leaf title=" '+this.categories[i][j]+'" code="category'+i+'-'+j+'" img="blue_ball.gif"/>';}treexml+='</folder>';}for(var i=0;i<this.instances.length;i++){treexml+='<folder title="'+gLanguage.getMessage('QI_INSTANCES')+'" code="instances'+i+'" expanded="true" img="instance.gif">';for(var j=0;j<this.instances[i].length;j++){treexml+='<leaf title=" '+this.instances[i][j]+'" code="instance'+i+'-'+j+'" img="red_ball.gif"/>';}treexml+='</folder>';}for(var i=0;i<this.properties.length;i++){treexml+='<folder title=" '+this.properties[i].getName()+'" code="properties'+i+'" expanded="true" img="property.gif">';propvalues=this.properties[i].getValues();for(var j=0;j<propvalues.length;j++){if(propvalues[j][0]=="subquery")treexml+='<leaf title=" '+gLanguage.getMessage('QI_SUBQUERY')+' '+propvalues[j][2]+'" code="subquery'+propvalues[j][2]+'" img="subquery.png" class="treesub"/>';else{var res="";switch(propvalues[j][1]){case "<=":res="&lt;=";break;case ">=":res="&gt;=";break;default:res=propvalues[j][1];break;}treexml+='<leaf title=" '+propvalues[j][0]+" "+res+" "+propvalues[j][2]+'" code="property'+i+'-'+j+'" img="yellow_ball.gif"/>';}}treexml+='</folder>';}treexml+='</folder></treeview>';updateQueryTree(treexml);},getAskText:function(){var asktext="";for(var i=0;i<this.categories.length;i++){asktext+="[[Category:";for(var j=0;j<this.categories[i].length;j++){asktext+=this.categories[i][j];if(j<this.categories[i].length-1){asktext+="||";}}asktext+="]]";}for(var i=0;i<this.instances.length;i++){asktext+="[[";for(var j=0;j<this.instances[i].length;j++){asktext+=this.instances[i][j];if(j<this.instances[i].length-1){asktext+="||";}}asktext+="]]";}for(var i=0;i<this.properties.length;i++){if(this.properties[i].isShown()){asktext+="[["+this.properties[i].getName()+":=*]]";asktext+="[["+this.properties[i].getName()+":=+]]";}asktext+="[["+this.properties[i].getName()+":=";if(this.properties[i].getArity()>2){var vals=this.properties[i].getValues();for(var j=0;j<vals.length;j++){if(j!=0)asktext+=";";if(vals[j][1]!="=")asktext+=vals[j][1].substring(0,1);asktext+=vals[j][2];}}else{var vals=this.properties[i].getValues();for(var j=0;j<vals.length;j++){if(j!=0)asktext+="||";if(vals[j][1]!="=")asktext+=vals[j][1].substring(0,1);if(vals[j][0]=="subquery")asktext+="Subquery:"+vals[j][2]+":";else asktext+=vals[j][2];}}asktext+="]]";}return asktext;},isEmpty:function(){if(this.categories.length==0&&this.instances.length==0&&this.properties.length==0){return true;}else{return false;}},getName:function(){return this.name;},getSubqueryIds:function(){return this.subqueryIds;},getParent:function(){return this.parent;},getCategoryGroup:function(id){return this.categories[id];},getInstanceGroup:function(id){return this.instances[id];},getPropertyGroup:function(id){return this.properties[id];},getAllProperties:function(){return this.properties;},removeCategoryGroup:function(id){if(id<this.categories.length-1)this.categories[id]=this.categories.pop();else this.categories.pop();},removeInstanceGroup:function(id){if(id<this.instances.length-1)this.instances[id]=this.instances.pop();else this.instances.pop();},removePropertyGroup:function(id){if(id<this.properties.length-1){this.properties[id]=this.properties.pop();}else{this.properties.pop();}}};

// QIHelper.js
// under GPL-License; Copyright (c) 2007 Ontoprise GmbH
var qihelper=null;var QIHelper=Class.create();QIHelper.prototype={initialize:function(){this.imgpath=wgScriptPath+'/extensions/SMWHalo/skins/QueryInterface/images/';this.numTypes=new Array();this.getNumericDatatypes();this.queries=Array();this.activeQuery=null;this.activeQueryId=null;this.nextQueryId=0;this.activeInputs=0;this.activeDialogue=null;this.propname=null;this.proparity=null;this.propIsEnum=false;this.enumValues=null;this.loadedFromId=null;this.addQuery(null,gLanguage.getMessage('QI_MAIN_QUERY_NAME'));this.setActiveQuery(0);this.updateColumnPreview();this.pendingElement=null;},switchtcp:function(){if($("tcp_boxcontent").style.display=="none"){$("tcp_boxcontent").style.display="";$("tcptitle-link").removeClassName("plusminus");$("tcptitle-link").addClassName("minusplus");}else{$("tcp_boxcontent").style.display="none";$("tcptitle-link").removeClassName("minusplus");$("tcptitle-link").addClassName("plusminus");}},switchlayout:function(){if($("layoutcontent").style.display=="none"){$("layoutcontent").style.display="";$("layouttitle-link").removeClassName("plusminus");$("layouttitle-link").addClassName("minusplus");}else{$("layoutcontent").style.display="none";$("layouttitle-link").removeClassName("minusplus");$("layouttitle-link").addClassName("plusminus");}},getNumericDatatypes:function(){sajax_do_call('smwfQIAccess',["getNumericTypes","dummy"],this.setNumericDatatypes.bind(this));},setNumericDatatypes:function(request){var types=request.responseText.split(",");for(var i=0;i<types.length;i++){var tmp=types[i].replace(/^\s+|\s+$/g,'');this.numTypes[tmp]=true;}},addQuery:function(parent,name){this.queries.push(new Query(this.nextQueryId,parent,name));this.nextQueryId++;},setActiveQuery:function(id){this.activeQuery=this.queries[id];this.activeQuery.updateTreeXML();this.activeQueryId=id;this.emptyDialogue();this.updateBreadcrumbs(id);},resetQuery:function(){$('shade').style.display="";$('resetdialogue').style.display="";},doReset:function(){if(window.smwhgLogger){smwhgLogger.log("Reset Query","info","query_reset");}this.emptyDialogue();this.initialize();$('shade').style.display="none";$('resetdialogue').style.display="none";},previewQuery:function(){if(window.smwhgLogger){smwhgLogger.log("Preview Query","info","query_preview");}$('shade').toggle();if(this.pendingElement)this.pendingElement.hide();this.pendingElement=new OBPendingIndicator($('shade'));this.pendingElement.show();if(!this.queries[0].isEmpty()){var ask=this.recurseQuery(0);var params=ask+",";params+=$('layout_format').value+',';params+=$('layout_link').value+',';params+=$('layout_intro').value==""?",":$('layout_intro').value+',';params+=$('layout_sort').value==gLanguage.getMessage('QI_ARTICLE_TITLE')?",":$('layout_sort').value+',';params+=$('layout_limit').value==""?"50,":$('layout_limit').value+',';params+=$('layout_label').value==""?",":$('layout_label').value+',';params+=$('layout_order').value=="ascending"?'ascending,':'descending,';params+=$('layout_default').value==""?',':$('layout_default').value;params+=$('layout_headers').checked?'show':'hide';sajax_do_call('smwfQIAccess',["getQueryResult",params],this.openPreview.bind(this));}else{var request=Array();request.responseText=gLanguage.getMessage('QI_EMPTY_QUERY');this.openPreview(request);}},openPreview:function(request){this.pendingElement.hide();$('fullpreviewbox').toggle();$('fullpreview').innerHTML=request.responseText;},updateBreadcrumbs:function(id){var nav=Array();while(this.queries[id].getParent()!=null){nav.unshift(id);id=this.queries[id].getParent();}nav.unshift(id);var html="";for(var i=0;i<nav.length;i++){if(i>0)html+="&gt;";html+='<span class="qibutton" onclick="qihelper.setActiveQuery('+nav[i]+')">';html+=this.queries[nav[i]].getName()+'</span>';}html+="<hr/>";$('treeviewbreadcrumbs').innerHTML=html;},updateColumnPreview:function(){var columns=new Array();columns.push(gLanguage.getMessage('QI_ARTICLE_TITLE'));var tmparr=this.queries[0].getAllProperties();for(var i=0;i<tmparr.length;i++){if(tmparr[i].isShown()){columns.push(tmparr[i].getName());}}var tcp_html='<table id="tcp" summary="Preview of table columns"><tr>';$('layout_sort').innerHTML="";for(var i=0;i<columns.length;i++){tcp_html+="<td>"+columns[i]+"</td>";$('layout_sort').options[$('layout_sort').length]=new Option(columns[i],columns[i]);}tcp_html+="</tr></table>";$('tcpcontent').innerHTML=tcp_html;},getFullAsk:function(){var asktext=this.recurseQuery(0);var starttag="<ask ";starttag+='format="'+$('layout_format').value+'" ';starttag+=$('layout_link').value=="subject"?"":('link="'+$('layout_link').value+'" ');starttag+=$('layout_intro').value==""?"":('intro="'+$('layout_intro').value+'" ');starttag+=$('layout_sort').value==gLanguage.getMessage('QI_ARTICLE_TITLE')?"":('sort="'+$('layout_sort').value+'" ');starttag+=$('layout_limit').value==""?'limit="20"':('limit="'+$('layout_limit').value+'" ');starttag+=$('layout_label').value==""?"":('mainlabel="'+$('layout_label').value+'" ');starttag+=$('layout_order').value=="ascending"?'order="ascending" ':'order="descending" ';starttag+=$('layout_headers').checked?'':'headers="hide" ';starttag+=$('layout_default').value==""?'':'default="'+$('layout_default').value+'" ';starttag+=">";return starttag+asktext+"</ask>";},recurseQuery:function(id){var sq=this.queries[id].getSubqueryIds();if(sq.length==0)return this.queries[id].getAskText();else{var tmptext=this.queries[id].getAskText();for(var i=0;i<sq.length;i++){var regex=null;eval('regex = /Subquery:'+sq[i]+':/g');tmptext=tmptext.replace(regex,'<q>'+this.recurseQuery(sq[i])+'</q>');}return tmptext;}},newCategoryDialogue:function(reset){$('qidelete').style.display="none";autoCompleter.deregisterAllInputs();if(reset)this.loadedFromId=null;this.activeDialogue="category";for(var i=0,n=$('dialoguecontent').rows.length;i<n;i++)$('dialoguecontent').deleteRow(0);var newrow=$('dialoguecontent').insertRow(-1);var cell=newrow.insertCell(0);cell.innerHTML=gLanguage.getMessage('CATEGORY');cell=newrow.insertCell(1);cell.innerHTML='<input type="text" id="input0" class="wickEnabled general-forms" typehint="14" autocomplete="OFF"/>';cell=newrow.insertCell(2);cell.innerHTML='<img src="'+this.imgpath+'add.png" alt="addCategoryInput" onclick="qihelper.addDialogueInput()"/>';this.activeInputs=1;$('dialoguebuttons').style.display="";autoCompleter.registerAllInputs();if(reset)$('input0').focus();},newInstanceDialogue:function(reset){$('qidelete').style.display="none";autoCompleter.deregisterAllInputs();if(reset)this.loadedFromId=null;this.activeDialogue="instance";for(var i=0,n=$('dialoguecontent').rows.length;i<n;i++)$('dialoguecontent').deleteRow(0);var newrow=$('dialoguecontent').insertRow(-1);var cell=newrow.insertCell(0);cell.innerHTML=gLanguage.getMessage('QI_INSTANCE');cell=newrow.insertCell(1);cell.innerHTML='<input type="text" id="input0" class="wickEnabled general-forms" typehint="0" autocomplete="OFF"/>';cell=newrow.insertCell(2);cell.innerHTML='<img src="'+this.imgpath+'add.png" alt="addInstanceInput" onclick="qihelper.addDialogueInput()"/>';this.activeInputs=1;$('dialoguebuttons').style.display="";autoCompleter.registerAllInputs();if(reset)$('input0').focus();},newPropertyDialogue:function(reset){$('qidelete').style.display="none";autoCompleter.deregisterAllInputs();if(reset)this.loadedFromId=null;this.activeDialogue="property";this.propname="";for(var i=0,n=$('dialoguecontent').rows.length;i<n;i++)$('dialoguecontent').deleteRow(0);var newrow=$('dialoguecontent').insertRow(-1);var cell=newrow.insertCell(0);cell.innerHTML=gLanguage.getMessage('QI_PROPERTYNAME');cell=newrow.insertCell(1);cell=newrow.insertCell(2);cell.innerHTML='<input type="text" id="input0" class="wickEnabled general-forms" typehint="102" autocomplete="OFF" onblur="qihelper.getPropertyInformation()"/>';newrow=$('dialoguecontent').insertRow(-1);cell=newrow.insertCell(0);cell.innerHTML=gLanguage.getMessage('QI_SHOW_PROPERTY');cell=newrow.insertCell(1);cell=newrow.insertCell(2);if(this.activeQueryId==0)cell.innerHTML='<input type="checkbox" id="input1">';else cell.innerHTML='<input type="checkbox" disabled="disabled" id="input1">';newrow=$('dialoguecontent').insertRow(-1);cell=newrow.insertCell(0);cell.id="mainlabel";cell.innerHTML=gLanguage.getMessage('QI_PAGE');cell=newrow.insertCell(1);cell.id="restricionSelector";cell.innerHTML=this.createRestrictionSelector("=",true);cell=newrow.insertCell(2);cell.innerHTML='<input class="wickEnabled general-forms" typehint="0" autocomplete="OFF" type="text" id="input2"/>';cell=newrow.insertCell(3);cell.innerHTML='<img src="'+this.imgpath+'add.png" alt="addPropertyInput" onclick="qihelper.addDialogueInput()"/>';cell=newrow.insertCell(4);cell.className="subquerycell";cell.innerHTML='&nbsp;'+gLanguage.getMessage('QI_USE_SUBQUERY')+'<input type="checkbox" id="usesub" onclick="qihelper.useSub(this.checked)"/>';this.activeInputs=3;$('dialoguebuttons').style.display="";this.proparity=2;autoCompleter.registerAllInputs();if(reset)$('input0').focus();},emptyDialogue:function(){this.activeDialogue=null;this.loadedFromId=null;this.propIsEnum=false;this.enumValues=null;this.propname=null;this.proparity=null;for(var i=0,n=$('dialoguecontent').rows.length;i<n;i++)$('dialoguecontent').deleteRow(0);$('dialoguebuttons').style.display="none";$('qistatus').innerHTML="";$('qidelete').style.display="none";this.activeInputs=0;},addDialogueInput:function(){autoCompleter.deregisterAllInputs();var delimg=wgScriptPath+'/extensions/SemanticMediaWiki/skins/QueryInterface/images/delete.png';var newrow=$('dialoguecontent').insertRow(-1);newrow.id="row"+newrow.rowIndex;var cell=newrow.insertCell(0);cell.innerHTML=gLanguage.getMessage('QI_OR');cell=newrow.insertCell(1);var param=$('mainlabel')?$('mainlabel').innerHTML:"";if(this.activeDialogue=="category")cell.innerHTML='<input class="wickEnabled general-forms" typehint="14" autocomplete="OFF" type="text" id="input'+this.activeInputs+'"/>';else if(this.activeDialogue=="instance")cell.innerHTML='<input class="wickEnabled general-forms" typehint="0" autocomplete="OFF" type="text" id="input'+this.activeInputs+'"/>';else if(param==gLanguage.getMessage('QI_PAGE')){cell.innerHTML=this.createRestrictionSelector("=",true);cell=newrow.insertCell(2);cell.innerHTML='<input class="wickEnabled general-forms" typehint="0" autocomplete="OFF" type="text" id="input'+this.activeInputs+'"/>';}else{if(this.numTypes[param.toLowerCase()])cell.innerHTML=this.createRestrictionSelector("=",false);else cell.innerHTML=this.createRestrictionSelector("=",true);cell=newrow.insertCell(2);if(this.propIsEnum){var tmphtml='<select id="input'+this.activeInputs+'" style="width:100%">';for(var i=0;i<this.enumValues.length;i++){tmphtml+='<option value="'+this.enumValues[i]+'">'+this.enumValues[i]+'</option>';}tmphtml+='</select>';cell.innerHTML=tmphtml;}else{cell.innerHTML='<input type="text" id="input'+this.activeInputs+'"/>';}}cell=newrow.insertCell(-1);cell.innerHTML='<img src="'+this.imgpath+'delete.png" alt="deleteInput" onclick="qihelper.removeInput('+newrow.rowIndex+')"/>';$('input'+this.activeInputs).focus();this.activeInputs++;autoCompleter.registerAllInputs();},removeInput:function(index){$('dialoguecontent').removeChild($('row'+index));this.activeInputs--;},getPropertyInformation:function(){var propname=$('input0').value;if(propname!=""&&propname!=this.propname){this.propname=propname;if(this.pendingElement)this.pendingElement.hide();this.pendingElement=new OBPendingIndicator($('input2'));this.pendingElement.show();sajax_do_call('smwfQIAccess',["getPropertyInformation",propname],this.adaptDialogueToProperty.bind(this));}},adaptDialogueToProperty:function(request){this.propIsEnum=false;if(this.activeDialogue!=null){var oldval=$('input2').value;var oldcheck=$('usesub')?$('usesub').checked:false;for(var i=3,n=$('dialoguecontent').rows.length;i<n;i++){$('dialoguecontent').deleteRow(3);}var arity=2;this.proparity=2;var parameterNames=[gLanguage.getMessage('QI_PAGE')];var possibleValues=new Array();if(request.status==200){var schemaData=GeneralXMLTools.createDocumentFromString(request.responseText);arity=parseInt(schemaData.documentElement.getAttribute("arity"));this.proparity=arity;parameterNames=[];for(var i=0,n=schemaData.documentElement.childNodes.length;i<n;i++){parameterNames.push(schemaData.documentElement.childNodes[i].getAttribute("name"));for(var j=0,m=schemaData.documentElement.childNodes[i].childNodes.length;j<m;j++){possibleValues.push(schemaData.documentElement.childNodes[i].childNodes[j].getAttribute("value"));}}}if(arity==2){$('mainlabel').innerHTML=parameterNames[0];$('dialoguecontent').rows[2].cells[2].innerHTML='<input class="wickEnabled general-forms" typehint="0" autocomplete="OFF" type="text" id="input2"/>';if(this.numTypes[parameterNames[0].toLowerCase()]){$('restricionSelector').innerHTML=this.createRestrictionSelector("=",false);autoCompleter.deregisterAllInputs();$('dialoguecontent').rows[2].cells[2].firstChild.className="";autoCompleter.registerAllInputs();}else $('restricionSelector').innerHTML=this.createRestrictionSelector("=",true);if(parameterNames[0]==gLanguage.getMessage('QI_PAGE')){autoCompleter.deregisterAllInputs();$('dialoguecontent').rows[2].cells[2].firstChild.className="wickEnabled";autoCompleter.registerAllInputs();}$('dialoguecontent').rows[2].cells[3].innerHTML='<img src="'+this.imgpath+'add.png" alt="addPropertyInput" onclick="qihelper.addDialogueInput()"/>';if(parameterNames[0]==gLanguage.getMessage('QI_PAGE')){$('dialoguecontent').rows[2].cells[4].innerHTML='&nbsp;'+gLanguage.getMessage('QI_USE_SUBQUERY')+'<input type="checkbox" id="usesub" onclick="qihelper.useSub(this.checked)"/>';$('dialoguecontent').rows[2].cells[4].className="subquerycell";$('usesub').checked=oldcheck;this.activeInputs=3;}else{$('dialoguecontent').rows[2].cells[4].innerHTML="";$('dialoguecontent').rows[2].cells[4].className="";this.activeInputs=3;}if(possibleValues.length>0){this.propIsEnum=true;this.enumValues=new Array();autoCompleter.deregisterAllInputs();var option='<select id="input2" style="width:100%">';for(var i=0;i<possibleValues.length;i++){this.enumValues.push(possibleValues[i]);option+='<option value="'+possibleValues[i]+'">'+possibleValues[i]+'</option>';}option+="</select>";$('dialoguecontent').rows[2].cells[2].innerHTML=option;autoCompleter.registerAllInputs();}}else{this.activeInputs=3;$('dialoguecontent').rows[2].cells[3].innerHTML="";$('dialoguecontent').rows[2].cells[4].innerHTML="";$('dialoguecontent').rows[2].cells[4].className="";$('mainlabel').innerHTML=parameterNames[0];if(this.numTypes[parameterNames[0].toLowerCase()]){$('restricionSelector').innerHTML=this.createRestrictionSelector("=",false);autoCompleter.deregisterAllInputs();$('dialoguecontent').rows[2].cells[2].firstChild.className="";autoCompleter.registerAllInputs();}else $('restricionSelector').innerHTML=this.createRestrictionSelector("=",true);for(var i=1;i<parameterNames.length;i++){var newrow=$('dialoguecontent').insertRow(-1);var cell=newrow.insertCell(0);cell.innerHTML=parameterNames[i];cell=newrow.insertCell(1);if(this.numTypes[parameterNames[i].toLowerCase()])cell.innerHTML=this.createRestrictionSelector("=",false);else cell.innerHTML=this.createRestrictionSelector("=",true);cell=newrow.insertCell(2);if(parameterNames[i]==gLanguage.getMessage('QI_PAGE'))cell.innerHTML='<input class="wickEnabled general-forms" typehint="0" autocomplete="OFF" type="text" id="input'+this.activeInputs+'"/>';else cell.innerHTML='<input type="text" id="input'+this.activeInputs+'"/>';this.activeInputs++;}}}this.pendingElement.hide();},loadCategoryDialogue:function(id){this.newCategoryDialogue(false);this.loadedFromId=id;var cats=this.activeQuery.getCategoryGroup(id);$('input0').value=cats[0];for(var i=1;i<cats.length;i++){this.addDialogueInput();$('input'+i).value=cats[i];}$('qidelete').style.display="";},loadInstanceDialogue:function(id){this.newInstanceDialogue(false);this.loadedFromId=id;var ins=this.activeQuery.getInstanceGroup(id);$('input0').value=ins[0];for(var i=1;i<ins.length;i++){this.addDialogueInput();$('input'+i).value=ins[i];}$('qidelete').style.display="";},loadPropertyDialogue:function(id){this.newPropertyDialogue(false);this.loadedFromId=id;var prop=this.activeQuery.getPropertyGroup(id);var vals=prop.getValues();this.proparity=prop.getArity();$('input0').value=prop.getName();$('input1').checked=prop.isShown();$('mainlabel').innerHTML=(vals[0][0]=="subquery"?gLanguage.getMessage('QI_PAGE'):vals[0][0]);if($('mainlabel').innerHTML!=gLanguage.getMessage('QI_PAGE')){$('dialoguecontent').rows[2].cells[4].innerHTML="";$('dialoguecontent').rows[2].cells[4].className="";}var disabled=true;if(this.numTypes[vals[0][0].toLowerCase()]){disabled=false;$('dialoguecontent').rows[2].cells[1].innerHTML=this.createRestrictionSelector(vals[0][1],disabled);autoCompleter.deregisterAllInputs();$('dialoguecontent').rows[2].cells[2].firstChild.className="";autoCompleter.registerAllInputs();}if(vals[0][0]=="subquery"){this.useSub(true);$('usesub').checked=true;}else{if(!prop.isEnumeration())$('input2').value=vals[0][2];else{var tmphtml='<select id="input2" style="width:100%">';this.enumValues=prop.getEnumValues();for(var i=0;i<this.enumValues.length;i++){tmphtml+='<option value="'+this.enumValues[i]+'" '+(this.enumValues[i]==vals[0][2]?'selected="selected"':'')+'>'+this.enumValues[i]+'</option>';}tmphtml+='</select>';$('dialoguecontent').rows[2].cells[2].innerHTML=tmphtml;}}if(prop.getArity()==2){if(!prop.isEnumeration()){for(var i=1;i<vals.length;i++){this.addDialogueInput();$('input'+(i+2)).value=vals[i][2];$('dialoguecontent').rows[i+2].cells[1].innerHTML=this.createRestrictionSelector(vals[i][1],disabled);}}else{this.enumValues=prop.getEnumValues();for(var i=1;i<vals.length;i++){this.addDialogueInput();var tmphtml='<select id="input'+(i+2)+'" style="width:100%">';for(var j=0;j<this.enumValues.length;j++){tmphtml+='<option value="'+this.enumValues[j]+'" '+(this.enumValues[j]==vals[i][2]?'selected="selected"':'')+'>'+this.enumValues[j]+'</option>';}tmphtml+='</select>';$('dialoguecontent').rows[i+2].cells[2].innerHTML=tmphtml;$('dialoguecontent').rows[i+2].cells[1].innerHTML=this.createRestrictionSelector(vals[i][1],disabled);}}}else{autoCompleter.deregisterAllInputs();$('dialoguecontent').rows[2].cells[3].innerHTML="";$('dialoguecontent').rows[2].cells[4].innerHTML="";$('dialoguecontent').rows[2].cells[4].className="";for(var i=1;i<vals.length;i++){var row=$('dialoguecontent').insertRow(-1);var cell=row.insertCell(0);cell.innerHTML=vals[i][0];cell=row.insertCell(1);if(this.numTypes[vals[i][0].toLowerCase()])cell.innerHTML=this.createRestrictionSelector(vals[i][1],false);else cell.innerHTML=this.createRestrictionSelector(vals[i][1],true);cell=row.insertCell(2);if(vals[i][0]==gLanguage.getMessage('QI_PAGE'))cell.innerHTML='<input type="text" class="wickEnabled general-forms" typehint="0" autocomplete="OFF" id="input'+(i+2)+'" value="'+vals[i][2]+'"/>';else cell.innerHTML='<input type="text" id="input'+(i+2)+'" value="'+vals[i][2]+'"/>';}autoCompleter.registerAllInputs();}$('qidelete').style.display="";},deleteActivePart:function(){switch(this.activeDialogue){case "category":if(window.smwhgLogger){var logstr="Remove category "+this.activeQuery.getCategoryGroup(this.loadedFromId).join(",")+" from query";smwhgLogger.log(logstr,"info","query_category_removed");}this.activeQuery.removeCategoryGroup(this.loadedFromId);break;case "instance":if(window.smwhgLogger){var logstr="Remove instance "+this.activeQuery.getInstanceGroup(this.loadedFromId).join(",")+" from query";smwhgLogger.log(logstr,"info","query_instance_removed");}this.activeQuery.removeInstanceGroup(this.loadedFromId);break;case "property":var pgroup=this.activeQuery.getPropertyGroup(this.loadedFromId);if(window.smwhgLogger){var logstr="Remove property "+pgroup.getName()+" from query";smwhgLogger.log(logstr,"info","query_property_removed");}if(pgroup.getValues()[0][0]=="subquery"){if(window.smwhgLogger){var logstr="Remove subquery (property: "+pgroup.getName()+") from query";smwhgLogger.log(logstr,"info","query_subquery_removed");}this.deleteSubqueries(pgroup.getValues()[0][2])}this.activeQuery.removePropertyGroup(this.loadedFromId);break;}this.emptyDialogue();this.activeQuery.updateTreeXML();this.updateColumnPreview();},deleteSubqueries:function(id){if(this.queries[id].hasSubqueries()){for(var i=0;i<this.queries[id].getSubqueryIds().length;i++){this.deleteSubqueries(this.queries[id].getSubqueryIds()[i]);}}this.queries[id]=null;},createRestrictionSelector:function(option,disabled){var html=disabled?'<select disabled="disabled">':'<select>';switch(option){case "=":html+='<option value="=" selected="selected">=</option><option value="&lt;=">&lt;=</option><option value="&gt;=">&gt;=</option><option value="!=">!=</option></select>';break;case "<=":html+='<option value="=">=</option><option value="&lt;=" selected="selected">&lt;=</option><option value="&gt;=">&gt;=</option><option value="!=">!=</option></select>';break;case ">=":html+='<option value="=">=</option><option value="&lt;=">&lt;=</option><option value="&gt;=" selected="selected">&gt;=</option><option value="!=">!=</option></select>';break;case "!=":html+='<option value="=">=</option><option value="&lt;=">&lt;=</option><option value="&gt;=">&gt;=</option><option value="!=" selected="selected">!=</option></select>';break;}return html;},useSub:function(checked){if(checked){$('input2').value="";$('input2').disabled=true;$('input2').style.background="#DDDDDD";}else{$('input2').disabled=false;$('input2').style.background="#FFFFFF";}},add:function(){if(this.activeDialogue=="category"){this.addCategoryGroup();}else if(this.activeDialogue=="instance"){this.addInstanceGroup();}else{this.addPropertyGroup();}this.activeQuery.updateTreeXML();this.loadedFromID=null;},addCategoryGroup:function(){var tmpcat=Array();var allinputs=true;for(var i=0;i<this.activeInputs;i++){var tmpid="input"+i;tmpcat.push($(tmpid).value);if($(tmpid).value=="")allinputs=false;}if(!allinputs)$('qistatus').innerHTML=gLanguage.getMessage('QI_ENTER_CATEGORY');else{if(window.smwhgLogger){var logstr="Add category "+tmpcat.join(",")+" to query";smwhgLogger.log(logstr,"info","query_category_added");}this.activeQuery.addCategoryGroup(tmpcat,this.loadedFromId);this.emptyDialogue();}},addInstanceGroup:function(){var tmpins=Array();var allinputs=true;for(var i=0;i<this.activeInputs;i++){var tmpid="input"+i;tmpins.push($(tmpid).value);if($(tmpid).value=="")allinputs=false;}if(!allinputs)$('qistatus').innerHTML=gLanguage.getMessage('QI_ENTER_INSTANCE');else{if(window.smwhgLogger){var logstr="Add instance "+tmpins.join(",")+" to query";smwhgLogger.log(logstr,"info","query_instance_added");}this.activeQuery.addInstanceGroup(tmpins,this.loadedFromId);this.emptyDialogue();}},addPropertyGroup:function(){var pname=$('input0').value;var subqueryIds=Array();if(pname==""){$('qistatus').innerHTML=gLanguage.getMessage('QI_ENTER_PROPERTY_NAME');}else{var pshow=$('input1').checked;var arity=this.proparity;var pgroup=new PropertyGroup(pname,arity,pshow,this.propIsEnum,this.enumValues);for(var i=2;i<$('dialoguecontent').rows.length;i++){var paramvalue=$('input'+i).value;paramvalue=paramvalue==""?"*":paramvalue;var paramname=$('dialoguecontent').rows[i].cells[0].innerHTML;if(paramname==gLanguage.getMessage('QI_PAGE')&&arity==2&&$('usesub').checked){paramname="subquery";paramvalue=this.nextQueryId;subqueryIds.push(this.nextQueryId);this.addQuery(this.activeQueryId,pname);if(window.smwhgLogger){var logstr="Add subquery to query, property '"+pname+"'";smwhgLogger.log(logstr,"info","query_subquery_added");}}var restriction=$('dialoguecontent').rows[i].cells[1].firstChild.value;pgroup.addValue(paramname,restriction,paramvalue);}if(window.smwhgLogger){var logstr="Add property "+pname+" to query";smwhgLogger.log(logstr,"info","query_property_added");}this.activeQuery.addPropertyGroup(pgroup,subqueryIds,this.loadedFromId);this.emptyDialogue();this.updateColumnPreview();}},copyToClipboard:function(){if(this.queries[0].isEmpty()){alert(gLanguage.getMessage('QI_EMPTY_QUERY'));}else{if(window.smwhgLogger){smwhgLogger.log("Copy query to clipboard","info","query_copied");}var text=this.getFullAsk();if(window.clipboardData){window.clipboardData.setData("Text",text);alert(gLanguage.getMessage('QI_CLIPBOARD_SUCCESS'));}else if(window.netscape){netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');var clip=Components.classes['@mozilla.org/widget/clipboard;1'].createInstance(Components.interfaces.nsIClipboard);if(!clip){alert(gLanguage.getMessage('QI_CLIPBOARD_FAIL'));return;}var trans=Components.classes['@mozilla.org/widget/transferable;1'].createInstance(Components.interfaces.nsITransferable);if(!trans){alert(gLanguage.getMessage('QI_CLIPBOARD_FAIL'));return;}trans.addDataFlavor('text/unicode');var str=new Object();var len=new Object();var str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);str.data=text;trans.setTransferData("text/unicode",str,text.length*2);var clipid=Components.interfaces.nsIClipboard;if(!clip){alert(gLanguage.getMessage('QI_CLIPBOARD_FAIL'));return;}clip.setData(trans,null,clipid.kGlobalClipboard);alert(gLanguage.getMessage('QI_CLIPBOARD_SUCCESS'));}else{alert(gLanguage.getMessage('QI_CLIPBOARD_FAIL'));}}},showLoadDialogue:function(){sajax_do_call('smwfQIAccess',["loadQuery","Query:SaveTestQ"],this.loadQuery.bind(this));},loadQuery:function(request){alert(request.responseText);},showSaveDialogue:function(){$('shade').toggle();$('savedialogue').toggle();},doSave:function(){if(!this.queries[0].isEmpty()){if(this.pendingElement)this.pendingElement.hide();this.pendingElement=new OBPendingIndicator($('savedialogue'));this.pendingElement.show();var params=$('saveName').value+",";params+=this.getFullAsk();sajax_do_call('smwfQIAccess',["saveQuery",params],this.saveDone.bind(this));}else{var request=Array();request.responseText="empty";this.saveDone(request);}},saveDone:function(request){this.pendingElement.hide();if(request.responseText=="empty"){alert(gLanguage.getMessage('QI_EMPTY_QUERY'));$('shade').toggle();$('savedialogue').toggle();$('saveName').value="";}else if(request.responseText=="exists"){alert(gLanguage.getMessage('QI_QUERY_EXISTS'));$('saveName').value="";}else if(request.responseText=="true"){alert(gLanguage.getMessage('QI_QUERY_SAVED'));$('shade').toggle();$('savedialogue').toggle();$('saveName').value="";}else{alert(gLanguage.getMessage('QI_SAVE_ERROR'));$('shade').toggle();$('savedialogue').toggle();}},exportToXLS:function(){if(!this.queries[0].isEmpty()){var ask=this.recurseQuery(0);var params=ask+",";params+=$('layout_format').value+',';params+=$('layout_link').value+',';params+=$('layout_intro').value==""?",":$('layout_intro').value+',';params+=$('layout_sort').value==gLanguage.getMessage('QI_ARTICLE_TITLE')?",":$('layout_sort').value+',';params+=$('layout_limit').value==""?"50,":$('layout_limit').value+',';params+=$('layout_label').value==""?",":$('layout_label').value+',';params+=$('layout_order').value=="ascending"?'ascending,':'descending,';params+=$('layout_default').value==""?',':$('layout_default').value;params+=$('layout_headers').checked?'show':'hide';sajax_do_call('smwfQIAccess',["getQueryResult",params],this.initializeDownload.bind(this));}else{var request=Array();request.responseText=gLanguage.getMessage('QI_EMPTY_QUERY');this.openPreview(request);}},initializeDownload:function(request){encodedHtml=escape(request.responseText);encodedHtml=encodedHtml.replace(/\//g,"%2F");encodedHtml=encodedHtml.replace(/\?/g,"%3F");encodedHtml=encodedHtml.replace(/=/g,"%3D");encodedHtml=encodedHtml.replace(/&/g,"%26");encodedHtml=encodedHtml.replace(/@/g,"%40");var url=wgServer+wgScriptPath+"/extensions/SMWHalo/specials/SMWQueryInterface/SMW_QIExport.php?q="+encodedHtml;window.open(url,"Download",'height=1,width=1');}};var PropertyGroup=Class.create();PropertyGroup.prototype={initialize:function(name,arity,show,isEnum,enumValues){this.name=name;this.arity=arity;this.show=show;this.isEnum=isEnum;this.enumValues=enumValues;this.values=Array();},addValue:function(name,restriction,value){this.values[this.values.length]=new Array(name,restriction,value);},getName:function(){return this.name;},getArity:function(){return this.arity;},isShown:function(){return this.show;},getValues:function(){return this.values;},isEnumeration:function(){return this.isEnum;},getEnumValues:function(){return this.enumValues;}};Event.observe(window,'load',initialize_qi);function initialize_qi(){qihelper=new QIHelper();} 

